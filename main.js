/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin-
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// src/main.ts
var main_exports = {};
__export(main_exports, {
  default: () => DataCardsPlugin
});
module.exports = __toCommonJS(main_exports);
var import_obsidian3 = require("obsidian");

// src/models/settings.ts
var DEFAULT_SETTINGS = {
  // Preset settings
  preset: "grid",
  // Image settings
  imageProperty: "cover",
  imageHeight: "200px",
  imageFit: "cover",
  // Content settings
  properties: "all",
  exclude: [],
  scrollableProperties: false,
  // Default to non-scrollable for most presets
  contentHeight: "200px",
  // Default height for scrollable content
  // Display settings
  showLabels: true,
  cardSpacing: 16,
  enableShadows: true,
  propertiesAlign: "left",
  // Default to left alignment
  titleAlign: "left",
  // Default to left alignment
  fontSize: "default",
  // Default font size
  // Formatting settings
  defaultDateFormat: "YYYY-MM-DD",
  propertyFormatters: {},
  // Mobile settings
  mobileColumns: 1,
  mobilePreset: "grid",
  mobileImageHeight: "150px",
  mobileScrollableProperties: true,
  // Default to scrollable on mobile
  mobileContentHeight: "150px",
  // Default height for mobile scrollable content
  forceMobileMode: false,
  // Disabled by default
  // Performance settings
  enableLazyLoading: false,
  // Update settings
  enableDynamicUpdates: false,
  // Disabled by default to avoid performance issues
  // Debug settings
  debugMode: false
  // Disabled by default
};

// src/ui/settings-tab.ts
var import_obsidian = require("obsidian");
var DataCardsSettingTab = class extends import_obsidian.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.plugin = plugin;
  }
  display() {
    const { containerEl } = this;
    containerEl.empty();
    containerEl.createEl("h2", { text: "DataCards Settings" });
    containerEl.createEl("h3", { text: "Preset Settings" });
    new import_obsidian.Setting(containerEl).setName("Default Preset").setDesc("Choose the default preset for cards").addDropdown((dropdown) => dropdown.addOption("grid", "Grid (balanced, 3 columns)").addOption("portrait", "Portrait (optimized for book covers, 3 columns)").addOption("square", "Square (1:1 cards with minimal text, 4 columns)").addOption("compact", "Compact (side-by-side layout, 4 columns)").addOption("dense", "Dense (maximum density, 6 columns)").setValue(this.plugin.settings.preset).onChange(async (value) => {
      this.plugin.settings.preset = value;
      await this.plugin.saveSettings();
    }));
    containerEl.createEl("h3", { text: "Image Settings" });
    new import_obsidian.Setting(containerEl).setName("Default Image Property").setDesc("The frontmatter property to use for images").addText((text) => text.setPlaceholder("cover").setValue(this.plugin.settings.imageProperty).onChange(async (value) => {
      this.plugin.settings.imageProperty = value;
      await this.plugin.saveSettings();
    }));
    containerEl.createEl("h3", { text: "Display Settings" });
    new import_obsidian.Setting(containerEl).setName("Show Property Labels").setDesc("Show labels for properties").addToggle((toggle) => toggle.setValue(this.plugin.settings.showLabels).onChange(async (value) => {
      this.plugin.settings.showLabels = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(containerEl).setName("Card Spacing").setDesc("Space between cards (in pixels)").addSlider((slider) => slider.setLimits(0, 32, 4).setValue(this.plugin.settings.cardSpacing).setDynamicTooltip().onChange(async (value) => {
      this.plugin.settings.cardSpacing = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(containerEl).setName("Enable Card Shadows").setDesc("Add subtle shadows to cards for a more three-dimensional appearance").addToggle((toggle) => toggle.setValue(this.plugin.settings.enableShadows).onChange(async (value) => {
      this.plugin.settings.enableShadows = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(containerEl).setName("Properties Alignment").setDesc("Text alignment for properties and their labels").addDropdown((dropdown) => dropdown.addOption("left", "Left").addOption("center", "Center").addOption("right", "Right").setValue(this.plugin.settings.propertiesAlign).onChange(async (value) => {
      this.plugin.settings.propertiesAlign = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(containerEl).setName("Title Alignment").setDesc("Text alignment for the title (filename)").addDropdown((dropdown) => dropdown.addOption("left", "Left").addOption("center", "Center").addOption("right", "Right").setValue(this.plugin.settings.titleAlign).onChange(async (value) => {
      this.plugin.settings.titleAlign = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(containerEl).setName("Font Size").setDesc("Text size for all card elements (properties, labels, and title)").addDropdown((dropdown) => dropdown.addOption("larger", "Larger (120%)").addOption("large", "Large (110%)").addOption("default", "Default (100%)").addOption("small", "Small (90% - similar to dense preset)").addOption("smaller", "Smaller (80%)").setValue(this.plugin.settings.fontSize).onChange(async (value) => {
      this.plugin.settings.fontSize = value;
      await this.plugin.saveSettings();
    }));
    containerEl.createEl("h3", { text: "Card Content Settings" });
    new import_obsidian.Setting(containerEl).setName("Scrollable Properties").setDesc("Enable scrolling for card properties when they exceed the content height (Note: Square and Compact presets are scrollable by default)").addToggle((toggle) => toggle.setValue(this.plugin.settings.scrollableProperties).onChange(async (value) => {
      this.plugin.settings.scrollableProperties = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(containerEl).setName("Content Height").setDesc("Height of the scrollable content area (e.g., 200px)").addText((text) => text.setPlaceholder("200px").setValue(this.plugin.settings.contentHeight).onChange(async (value) => {
      this.plugin.settings.contentHeight = value || "200px";
      await this.plugin.saveSettings();
    }));
    containerEl.createEl("h3", { text: "Formatting Settings" });
    new import_obsidian.Setting(containerEl).setName("Default Date Format").setDesc("Format for displaying dates (YYYY = year, MM = month, DD = day)").addText((text) => text.setPlaceholder("YYYY-MM-DD").setValue(this.plugin.settings.defaultDateFormat).onChange(async (value) => {
      this.plugin.settings.defaultDateFormat = value || "YYYY-MM-DD";
      await this.plugin.saveSettings();
    }));
    containerEl.createEl("h3", { text: "Mobile Settings" });
    new import_obsidian.Setting(containerEl).setName("Mobile Preset").setDesc("Preset to use on mobile devices (all presets default to 1 column on mobile)").addDropdown((dropdown) => dropdown.addOption("grid", "Grid (balanced)").addOption("portrait", "Portrait (optimized for book covers)").addOption("square", "Square (1:1 cards with minimal text)").addOption("compact", "Compact (side-by-side layout)").addOption("dense", "Dense (maximum density)").setValue(this.plugin.settings.mobilePreset).onChange(async (value) => {
      this.plugin.settings.mobilePreset = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(containerEl).setName("Mobile Scrollable Properties").setDesc("Enable scrolling for card properties on mobile devices").addToggle((toggle) => toggle.setValue(this.plugin.settings.mobileScrollableProperties).onChange(async (value) => {
      this.plugin.settings.mobileScrollableProperties = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(containerEl).setName("Mobile Content Height").setDesc("Height of the scrollable content area on mobile devices").addText((text) => text.setPlaceholder("150px").setValue(this.plugin.settings.mobileContentHeight).onChange(async (value) => {
      this.plugin.settings.mobileContentHeight = value || "150px";
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(containerEl).setName("Force Mobile Mode").setDesc("Force the plugin to use mobile settings even on desktop (for testing)").addToggle((toggle) => toggle.setValue(this.plugin.settings.forceMobileMode).onChange(async (value) => {
      this.plugin.settings.forceMobileMode = value;
      await this.plugin.saveSettings();
    }));
    containerEl.createEl("h3", { text: "Performance Settings" });
    new import_obsidian.Setting(containerEl).setName("Enable Lazy Loading").setDesc("Only load images when they become visible (improves performance with many cards)").addToggle((toggle) => toggle.setValue(this.plugin.settings.enableLazyLoading).onChange(async (value) => {
      this.plugin.settings.enableLazyLoading = value;
      await this.plugin.saveSettings();
    }));
    containerEl.createEl("h3", { text: "Update Settings" });
    new import_obsidian.Setting(containerEl).setName("Enable Dynamic Updates").setDesc("Automatically update DataCards when properties change (may impact performance)").addToggle((toggle) => toggle.setValue(this.plugin.settings.enableDynamicUpdates).onChange(async (value) => {
      this.plugin.settings.enableDynamicUpdates = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(containerEl).setName("Per-Card Dynamic Updates").setDesc('Individual cards can override the global setting with "dynamicUpdate: true/false" in their settings').setDisabled(true);
    containerEl.createEl("h3", { text: "Developer Settings" });
    new import_obsidian.Setting(containerEl).setName("Debug Mode").setDesc("Enable debug logging (only use during development or troubleshooting)").addToggle((toggle) => toggle.setValue(this.plugin.settings.debugMode).onChange(async (value) => {
      this.plugin.settings.debugMode = value;
      await this.plugin.saveSettings();
    }));
    containerEl.createEl("h3", { text: "Help" });
    const helpText = containerEl.createEl("div");
    helpText.innerHTML = `
      <p><strong>Basic Usage:</strong><br>
      Use the <code>datacards</code> code block to create card layouts from Dataview queries.</p>
      
      <p><strong>Example:</strong></p>
      <pre><code>
\`\`\`datacards
TABLE title, author, rating, cover FROM #books
SORT rating DESC

// Settings
preset: grid
imageFit: contain
defaultDateFormat: YYYY
\`\`\`
      </code></pre>
      
      <p><strong>Important:</strong> You must explicitly include all properties you want to display in your Dataview query (including the image property).</p>
      
      <p><strong>Image Support:</strong><br>
      The plugin supports external URLs, vault images, and wiki links:<br>
      <code>cover: https://example.com/image.jpg</code> or <code>cover: [[path/to/image.jpg]]</code></p>     
    
      <p><strong>Tip:</strong> Data Cards works best with the Editor-Setting "Readable line length" disabled. </p><br>
      
      <p><a href="https://github.com/Sophokles187/data-cards" target="_blank" rel="noopener">View complete documentation and examples on GitHub</a></p>
    `;
  }
};

// src/utils/logger.ts
var Logger = class {
  /**
   * Enable or disable debug mode
   * When disabled, debug logs won't be shown
   * 
   * @param enabled Whether debug mode should be enabled
   */
  static setDebugMode(enabled) {
    this.debugMode = enabled;
  }
  /**
   * Log an error message
   * These are always shown regardless of debug mode
   * 
   * @param message The error message
   * @param args Additional arguments to log
   */
  static error(message, ...args) {
    console.error(`[DataCards] ${message}`, ...args);
  }
  /**
   * Log a warning message
   * These are always shown regardless of debug mode
   * 
   * @param message The warning message
   * @param args Additional arguments to log
   */
  static warn(message, ...args) {
    console.warn(`[DataCards] ${message}`, ...args);
  }
  /**
   * Log a debug message
   * These are only shown when debug mode is enabled
   * 
   * @param message The debug message
   * @param args Additional arguments to log
   */
  static debug(message, ...args) {
    if (this.debugMode) {
      console.log(`[DataCards] ${message}`, ...args);
    }
  }
};
Logger.debugMode = false;

// src/services/parser.ts
var ParserService = class {
  /**
   * Parse a datacards code block content
   * Separates the query from the settings section
   * 
   * @param source The content of the datacards code block
   * @returns An object containing the query and settings
   */
  parseDataCardsBlock(source) {
    Logger.debug("Parsing datacards block");
    const separatorRegex = /\n-{3,}\n|\n\/\/\s*Settings.*|\n\/\*\s*Settings\s*\*\/.*/;
    const separatorMatch = source.match(separatorRegex);
    const startsWithSettingsRegex = /^\/\/\s*Settings.*/;
    const startsWithSettingsMatch = source.match(startsWithSettingsRegex);
    let query;
    let settingsText;
    if (separatorMatch && separatorMatch.index !== void 0) {
      Logger.debug("Found settings separator at index:", separatorMatch.index);
      query = source.substring(0, separatorMatch.index).trim();
      settingsText = source.substring(separatorMatch.index + separatorMatch[0].length).trim();
    } else if (startsWithSettingsMatch) {
      Logger.debug("Block starts with settings marker");
      query = "";
      settingsText = source.substring(startsWithSettingsMatch[0].length).trim();
    } else {
      Logger.debug("No settings separator found");
      query = source.trim();
      settingsText = "";
    }
    Logger.debug("Extracted query:", query);
    query = this.ensureQueryType(query);
    const settings = this.parseSettings(settingsText);
    const columnAliases = this.extractColumnAliases(query);
    if (columnAliases.length > 0) {
      settings.columnAliases = columnAliases;
      Logger.debug("Extracted column aliases:", columnAliases);
    }
    return { query, settings };
  }
  /**
   * Extract column aliases from a Dataview query
   * Handles both simple aliases (field as "Alias") and complex expressions
   * 
   * @param query The Dataview query
   * @returns Array of column aliases
   */
  extractColumnAliases(query) {
    const aliases = [];
    if (!query.trim().toUpperCase().startsWith("TABLE")) {
      return aliases;
    }
    try {
      const tableMatch = query.match(/TABLE\s+(without\s+id\s+)?([\s\S]*?)(?:\s+FROM|\s+WHERE|\s+SORT|\s+GROUP BY|\s+LIMIT|\s+FLATTEN|$)/i);
      if (!tableMatch || !tableMatch[2]) {
        return aliases;
      }
      const columnsText = tableMatch[2].trim();
      Logger.debug("Extracted columns text:", columnsText);
      if (!columnsText) {
        return aliases;
      }
      const columns = this.splitColumnsPreservingExpressions(columnsText);
      for (const column of columns) {
        const asMatch = column.match(/^(.*?)\s+as\s+(?:"([^"]+)"|'([^']+)'|([^\s,]+))$/i);
        if (asMatch) {
          const expression = asMatch[1].trim();
          const alias = asMatch[2] || asMatch[3] || asMatch[4];
          let original = expression;
          if (/^[a-zA-Z0-9_.-]+$/.test(expression)) {
            original = expression;
          } else {
            const fieldMatch = expression.match(/\(\s*".*?"\s*\+\s*([a-zA-Z0-9_.-]+)\s*\+\s*".*?"\s*\)/);
            if (fieldMatch && fieldMatch[1]) {
              original = fieldMatch[1];
              Logger.debug(`Extracted field name from complex expression: ${original}`);
            }
          }
          aliases.push({
            original,
            alias,
            expression
          });
          Logger.debug(`Found column alias: ${original} as "${alias}"`);
        }
      }
    } catch (error) {
      Logger.error("Error extracting column aliases:", error);
    }
    return aliases;
  }
  /**
   * Split a comma-separated list of columns while preserving expressions
   * This handles nested parentheses and quotes
   * 
   * @param columnsText The text containing comma-separated columns
   * @returns Array of column expressions
   */
  splitColumnsPreservingExpressions(columnsText) {
    const columns = [];
    let currentColumn = "";
    let parenDepth = 0;
    let inDoubleQuote = false;
    let inSingleQuote = false;
    for (let i = 0; i < columnsText.length; i++) {
      const char = columnsText[i];
      if (char === '"' && !inSingleQuote) {
        inDoubleQuote = !inDoubleQuote;
      } else if (char === "'" && !inDoubleQuote) {
        inSingleQuote = !inSingleQuote;
      }
      if (!inDoubleQuote && !inSingleQuote) {
        if (char === "(") {
          parenDepth++;
        } else if (char === ")") {
          parenDepth--;
        }
      }
      if (char === "," && parenDepth === 0 && !inDoubleQuote && !inSingleQuote) {
        columns.push(currentColumn.trim());
        currentColumn = "";
        continue;
      }
      currentColumn += char;
    }
    if (currentColumn.trim()) {
      columns.push(currentColumn.trim());
    }
    return columns;
  }
  /**
   * Ensure the query has a type (TABLE, LIST, TASK, CALENDAR)
   * If no type is specified, add TABLE as the default
   * 
   * @param query The Dataview query
   * @returns The query with a type
   */
  ensureQueryType(query) {
    const hasType = /\b(TABLE|LIST|TASK|CALENDAR)\b/i.test(query);
    if (!hasType) {
      const lines = query.split("\n");
      let firstNonCommentLine = -1;
      for (let i = 0; i < lines.length; i++) {
        const line = lines[i].trim();
        if (line && !line.startsWith("//") && !line.startsWith("/*")) {
          firstNonCommentLine = i;
          break;
        }
      }
      if (firstNonCommentLine >= 0) {
        const settings = this.parseSettings(lines.slice(firstNonCommentLine + 1).join("\n"));
        let propertiesToInclude = "";
        const propertiesToIncludeArray = [];
        if (settings.imageProperty) {
          propertiesToIncludeArray.push(settings.imageProperty);
        }
        propertiesToInclude = "";
        Logger.debug("Using simple TABLE query without property list");
        if (propertiesToInclude.trim() === "") {
          lines[firstNonCommentLine] = "TABLE " + lines[firstNonCommentLine];
        } else {
          lines[firstNonCommentLine] = "TABLE" + propertiesToInclude + " " + lines[firstNonCommentLine];
        }
        return lines.join("\n");
      } else {
        return "TABLE " + query;
      }
    }
    return query;
  }
  /**
   * Parse the settings section of a datacards code block
   * 
   * @param settingsText The settings text to parse
   * @returns The parsed settings object
   */
  parseSettings(settingsText) {
    if (!settingsText) {
      return {};
    }
    const settings = {};
    const lines = settingsText.split("\n");
    Logger.debug("Parsing settings from text");
    for (const line of lines) {
      if (line.trim().startsWith("//") || line.trim().startsWith("/*") || !line.trim()) {
        continue;
      }
      const match = line.match(/^\s*([a-zA-Z0-9_]+)\s*:\s*(.+)\s*$/);
      if (match) {
        const [, key, value] = match;
        Logger.debug(`Found setting: ${key} = ${value}`);
        if (key === "properties" && value.trim().startsWith("[") && value.trim().endsWith("]")) {
          Logger.debug("Detected properties array");
          const arrayContent = value.substring(1, value.length - 1).trim();
          if (arrayContent) {
            const properties = arrayContent.split(",").map((item) => item.trim());
            settings[key] = properties;
          } else {
            settings[key] = [];
          }
        } else {
          if (key === "defaultDateFormat") {
            settings[key] = value.trim();
          } else if (key === "dynamicUpdate") {
            settings[key] = this.parseValue(value.trim());
            Logger.debug(`Parsed dynamicUpdate setting: ${settings[key]}`);
          } else {
            settings[key] = this.parseValue(value.trim());
          }
        }
      }
    }
    return settings;
  }
  /**
   * Parse a value from the settings section
   * 
   * @param value The value to parse
   * @returns The parsed value
   */
  parseValue(value) {
    Logger.debug("Parsing value:", value);
    try {
      const jsonValue = JSON.parse(value);
      return jsonValue;
    } catch (e) {
    }
    if (value.startsWith("[") && value.endsWith("]")) {
      Logger.debug("Detected array syntax");
      const arrayContent = value.substring(1, value.length - 1).trim();
      if (arrayContent) {
        const items = arrayContent.split(",").map((item) => {
          const trimmedItem = item.trim();
          return trimmedItem;
        });
        return items;
      }
      return [];
    }
    if (/^-?\d+(\.\d+)?$/.test(value)) {
      return Number(value);
    }
    if (value.toLowerCase() === "true") return true;
    if (value.toLowerCase() === "false") return false;
    return value;
  }
};

// src/services/renderer.ts
var import_obsidian2 = require("obsidian");
var RendererService = class {
  constructor(app, pluginSettings) {
    // Store the current settings for use in formatting methods
    this.currentSettings = null;
    this.app = app;
    this.pluginSettings = pluginSettings;
  }
  /**
   * Update the plugin settings reference
   * 
   * @param settings The updated plugin settings
   */
  updateSettings(settings) {
    this.pluginSettings = settings;
  }
  /**
   * Check if the current device is mobile or if mobile mode is forced
   * 
   * @returns True if the device is mobile or if mobile mode is forced, false otherwise
   */
  isMobileDevice() {
    return import_obsidian2.Platform.isMobile || this.pluginSettings.forceMobileMode;
  }
  /**
   * Render Dataview query results as cards
   * 
   * @param container The container element to render into
   * @param results The Dataview query results
   * @param blockSettings The settings for this specific block
   */
  renderCards(container, results, blockSettings) {
    const isMobile = this.isMobileDevice();
    Logger.debug("Is mobile device:", isMobile);
    let settings = { ...this.pluginSettings };
    Logger.debug("Initial settings from plugin:", {
      preset: settings.preset,
      imageHeight: settings.imageHeight,
      mobileColumns: settings.mobileColumns,
      mobilePreset: settings.mobilePreset,
      mobileImageHeight: settings.mobileImageHeight
    });
    settings = { ...settings, ...blockSettings };
    Logger.debug("After applying block settings:", {
      preset: settings.preset,
      imageHeight: settings.imageHeight,
      mobileColumns: settings.mobileColumns,
      mobilePreset: settings.mobilePreset,
      mobileImageHeight: settings.mobileImageHeight
    });
    if (isMobile) {
      Logger.debug("Applying mobile settings...");
      Logger.debug(`Using mobile columns: ${settings.mobileColumns}`);
      if (settings.mobilePreset !== void 0) {
        Logger.debug(`Overriding preset: ${settings.preset} with mobilePreset: ${settings.mobilePreset}`);
        settings.preset = settings.mobilePreset;
      }
      if (settings.mobileImageHeight !== void 0) {
        Logger.debug(`Overriding imageHeight: ${settings.imageHeight} with mobileImageHeight: ${settings.mobileImageHeight}`);
        settings.imageHeight = settings.mobileImageHeight;
      }
      Logger.debug("Final settings after applying mobile settings:", {
        preset: settings.preset,
        imageHeight: settings.imageHeight
      });
    }
    this.currentSettings = settings;
    const cardsContainer = container.createEl("div", {
      cls: "datacards-container"
    });
    cardsContainer.addClass(`datacards-preset-${settings.preset}`);
    if (!settings.enableShadows) {
      cardsContainer.addClass("datacards-no-shadows");
    }
    if (settings.fontSize && settings.fontSize !== "default") {
      cardsContainer.addClass(`datacards-font-${settings.fontSize}`);
      Logger.debug(`Applied font size class: datacards-font-${settings.fontSize}`);
    } else if (settings.preset === "dense" && (!settings.fontSize || settings.fontSize === "default")) {
      cardsContainer.addClass("datacards-font-small");
      Logger.debug("Applied small font size for dense preset");
    }
    cardsContainer.style.setProperty("--card-gap", `${settings.cardSpacing}px`);
    let columnsToUse;
    if (isMobile) {
      columnsToUse = settings.mobileColumns;
    } else {
      let recommendedColumns = 3;
      if (settings.preset === "dense") {
        recommendedColumns = 6;
      } else if (settings.preset === "compact") {
        recommendedColumns = 4;
      } else if (settings.preset === "square") {
        recommendedColumns = 4;
      } else if (settings.preset === "portrait") {
        recommendedColumns = 3;
      }
      columnsToUse = blockSettings.columns !== void 0 ? blockSettings.columns : recommendedColumns;
    }
    Logger.debug(`Using ${columnsToUse} columns`);
    cardsContainer.style.setProperty("--card-columns", columnsToUse.toString(), "important");
    let imageHeight;
    if (blockSettings.imageHeight !== void 0) {
      imageHeight = settings.imageHeight;
    } else {
      if (settings.preset === "portrait") {
        imageHeight = "350px";
      } else if (settings.preset === "square") {
        imageHeight = "200px";
      } else if (settings.preset === "compact") {
        imageHeight = "200px";
      } else if (settings.preset === "dense") {
        imageHeight = "120px";
      } else {
        imageHeight = "200px";
      }
    }
    if (typeof imageHeight === "number" || /^\d+$/.test(imageHeight)) {
      imageHeight = `${imageHeight}px`;
    }
    cardsContainer.style.setProperty("--image-height", imageHeight);
    if (blockSettings.imageFit !== void 0) {
      cardsContainer.style.setProperty("--image-fit", settings.imageFit);
    } else {
      const defaultFit = settings.preset === "portrait" ? "contain" : "cover";
      cardsContainer.style.setProperty("--image-fit", defaultFit);
    }
    if (results && results.values && Array.isArray(results.values)) {
      Logger.debug("Detected table-like results with values array");
      this.renderTableResults(cardsContainer, results, settings);
    } else if (results && Array.isArray(results)) {
      Logger.debug("Detected array results");
      this.renderArrayResults(cardsContainer, results, settings);
    } else if (results && typeof results === "object") {
      Logger.debug("Detected object results");
      this.renderObjectResults(cardsContainer, results, settings);
    } else {
      Logger.debug("No valid results detected");
      this.renderError(cardsContainer, "No results or unsupported result type");
    }
  }
  /**
   * Render an error message
   * 
   * @param container The container element
   * @param message The error message
   */
  renderError(container, message) {
    const errorEl = container.createEl("div", {
      cls: "datacards-error",
      text: message
    });
  }
  /**
   * Render table-like Dataview results
   * 
   * @param container The container element
   * @param results The Dataview table results
   * @param settings The merged settings
   */
  renderTableResults(container, results, settings) {
    const { values, headers } = results;
    Logger.debug("Rendering table results:");
    Logger.debug("- Headers:", headers);
    Logger.debug("- Number of rows:", values.length);
    values.forEach((row, rowIndex) => {
      Logger.debug(`Processing row ${rowIndex}`);
      const card = this.createCardElement(container);
      if (settings.imageProperty && headers.includes(settings.imageProperty)) {
        const imageIndex = headers.indexOf(settings.imageProperty);
        const imageValue = row[imageIndex];
        Logger.debug(`Image property '${settings.imageProperty}' value:`, imageValue);
        if (imageValue) {
          this.addImageToCard(card, imageValue);
        }
      } else if (settings.imageProperty) {
        Logger.debug(`Image property '${settings.imageProperty}' not found in headers:`, headers);
      }
      const contentEl = card.createEl("div", { cls: "datacards-content" });
      if (headers.includes("File") || headers.includes("file")) {
        const fileIndex = headers.findIndex((h) => h.toLowerCase() === "file");
        if (fileIndex >= 0) {
          const fileValue = row[fileIndex];
          Logger.debug("File property value:", fileValue);
          const filePropertyEl = contentEl.createEl("div", {
            cls: "datacards-property datacards-file-property-container"
          });
          this.formatFileProperty(filePropertyEl, fileValue);
        }
      }
      const propertiesContainer = contentEl.createEl("div", {
        cls: "datacards-properties-container"
      });
      const shouldScroll = this.shouldUseScrollableProperties(settings);
      if (shouldScroll) {
        propertiesContainer.addClass("datacards-scrollable-properties");
        const contentHeight = this.getContentHeight(settings);
        propertiesContainer.style.setProperty("--content-height", contentHeight);
      }
      let propertiesToShow = [];
      if (settings.properties === "all") {
        propertiesToShow = [...headers];
        Logger.debug("Using all headers as properties:", propertiesToShow);
      } else if (Array.isArray(settings.properties)) {
        propertiesToShow = [...settings.properties];
        Logger.debug("Using specified properties:", propertiesToShow);
      } else {
        Logger.debug("No properties specified, using empty array");
      }
      let filteredProperties = propertiesToShow.filter(
        (prop) => !settings.exclude.includes(prop) && prop !== settings.imageProperty && prop.toLowerCase() !== "file"
        // Exclude file property here, we already added it separately
      );
      Logger.debug("Filtered properties (after excluding file):", filteredProperties);
      filteredProperties.forEach((property) => {
        Logger.debug(`Checking property '${property}' in headers:`, headers.includes(property));
        if (headers.includes(property)) {
          const propIndex = headers.indexOf(property);
          const propValue = row[propIndex];
          console.log(`Property '${property}' value:`, propValue);
          console.log(`Property '${property}' type:`, typeof propValue);
          if (typeof propValue === "string" && propValue.includes("[[") && propValue.includes("]]")) {
            console.log(`Found wiki link in property '${property}':`, propValue);
            const propertyEl = propertiesContainer.createEl("div", {
              cls: "datacards-property"
            });
            if (settings.showLabels) {
              propertyEl.createEl("div", {
                cls: "datacards-property-label",
                text: property
              });
            }
            const valueEl = propertyEl.createEl("div", {
              cls: "datacards-property-value"
            });
            const wikiLinkMatch = propValue.match(/\[\[([^\]|]+)(?:\|([^\]]+))?\]\]/);
            if (wikiLinkMatch) {
              const path = wikiLinkMatch[1];
              const displayText = wikiLinkMatch[2] || this.getCleanFilename(path);
              console.log(`Creating direct link for wiki link: path="${path}", display="${displayText}"`);
              const link = valueEl.createEl("a", {
                cls: "internal-link",
                text: displayText,
                attr: {
                  href: path,
                  "data-href": path,
                  "data-type": "link"
                }
              });
              this.app.workspace.trigger("hover-link", {
                event: new MouseEvent("mouseover"),
                source: "preview",
                hoverEl: link,
                targetEl: link,
                linktext: path
              });
            } else {
              valueEl.setText(propValue);
            }
          } else {
            this.addPropertyToCard(propertiesContainer, property, propValue, settings);
          }
        } else {
          Logger.debug(`Property '${property}' not found in headers`);
        }
      });
      if (filteredProperties.length === 0 && !headers.some((h) => h.toLowerCase() === "file")) {
        Logger.debug("No properties were added to the card");
        contentEl.createEl("div", {
          cls: "datacards-property",
          text: "No properties to display"
        });
      }
    });
  }
  /**
   * Render array Dataview results
   * 
   * @param container The container element
   * @param results The Dataview array results
   * @param settings The merged settings
   */
  renderArrayResults(container, results, settings) {
    results.forEach((item) => {
      const card = this.createCardElement(container);
      if (settings.imageProperty && item[settings.imageProperty]) {
        this.addImageToCard(card, item[settings.imageProperty]);
      }
      const contentEl = card.createEl("div", { cls: "datacards-content" });
      if ("file" in item) {
        const filePropertyEl = contentEl.createEl("div", {
          cls: "datacards-property datacards-file-property-container"
        });
        this.formatFileProperty(filePropertyEl, item["file"]);
      }
      const propertiesContainer = contentEl.createEl("div", {
        cls: "datacards-properties-container"
      });
      const shouldScroll = this.shouldUseScrollableProperties(settings);
      if (shouldScroll) {
        propertiesContainer.addClass("datacards-scrollable-properties");
        const contentHeight = this.getContentHeight(settings);
        propertiesContainer.style.setProperty("--content-height", contentHeight);
      }
      const allProperties = Object.keys(item);
      const propertiesToShow = settings.properties === "all" ? allProperties : Array.isArray(settings.properties) ? settings.properties : [];
      const filteredProperties = propertiesToShow.filter(
        (prop) => !settings.exclude.includes(prop) && prop !== settings.imageProperty && prop.toLowerCase() !== "file"
      );
      filteredProperties.forEach((property) => {
        if (property in item) {
          this.addPropertyToCard(propertiesContainer, property, item[property], settings);
        }
      });
    });
  }
  /**
   * Render object Dataview results
   * 
   * @param container The container element
   * @param results The Dataview object results
   * @param settings The merged settings
   */
  renderObjectResults(container, results, settings) {
    const card = this.createCardElement(container);
    if (settings.imageProperty && results[settings.imageProperty]) {
      this.addImageToCard(card, results[settings.imageProperty]);
    }
    const contentEl = card.createEl("div", { cls: "datacards-content" });
    if ("file" in results) {
      const filePropertyEl = contentEl.createEl("div", {
        cls: "datacards-property datacards-file-property-container"
      });
      this.formatFileProperty(filePropertyEl, results["file"]);
    }
    const propertiesContainer = contentEl.createEl("div", {
      cls: "datacards-properties-container"
    });
    const shouldScroll = this.shouldUseScrollableProperties(settings);
    if (shouldScroll) {
      propertiesContainer.addClass("datacards-scrollable-properties");
      const contentHeight = this.getContentHeight(settings);
      propertiesContainer.style.setProperty("--content-height", contentHeight);
    }
    const allProperties = Object.keys(results);
    const propertiesToShow = settings.properties === "all" ? allProperties : Array.isArray(settings.properties) ? settings.properties : [];
    const filteredProperties = propertiesToShow.filter(
      (prop) => !settings.exclude.includes(prop) && prop !== settings.imageProperty && prop.toLowerCase() !== "file"
    );
    filteredProperties.forEach((property) => {
      if (property in results) {
        this.addPropertyToCard(propertiesContainer, property, results[property], settings);
      }
    });
  }
  /**
   * Create a card element
   * 
   * @param container The container to add the card to
   * @returns The created card element
   */
  createCardElement(container) {
    return container.createEl("div", {
      cls: "datacards-card"
    });
  }
  /**
   * Add an image to a card
   * 
   * @param card The card element
   * @param imageValue The image value (path, URL, or Link object)
   */
  addImageToCard(card, imageValue) {
    var _a;
    const imageContainer = card.createEl("div", {
      cls: "datacards-image-container"
    });
    let imagePath;
    if (typeof imageValue === "object" && imageValue !== null) {
      Logger.debug("Image value is an object:", imageValue);
      if ("path" in imageValue) {
        imagePath = imageValue.path;
        Logger.debug("Extracted path from Link object:", imagePath);
      } else {
        imagePath = String(imageValue);
        Logger.debug("Converted object to string:", imagePath);
      }
    } else {
      imagePath = String(imageValue);
      Logger.debug("Image value is a string:", imagePath);
    }
    imagePath = this.extractImageSource(imagePath);
    Logger.debug("After image source extraction:", imagePath);
    const placeholder = imageContainer.createEl("div", {
      cls: "datacards-image-placeholder",
      text: "Loading image..."
    });
    if ((_a = this.currentSettings) == null ? void 0 : _a.enableLazyLoading) {
      this.lazyLoadImage(imageContainer, placeholder, imagePath);
    } else {
      this.loadImage(imageContainer, placeholder, imagePath);
    }
  }
  /**
   * Extract an image source from a string if present
   * This helps with handling expressions that result in wiki links or URLs
   * 
   * @param value The string value that might contain a wiki link or URL
   * @returns The wiki link or URL if found, otherwise the original string
   */
  extractImageSource(value) {
    if (!value || typeof value !== "string") {
      return String(value || "");
    }
    const markdownImageMatch = value.match(/!\[(.*?)\]\((.*?)\)/);
    if (markdownImageMatch) {
      const url = markdownImageMatch[2];
      Logger.debug("Extracted URL from markdown image syntax:", url);
      const cleanUrl = url.replace(/['",.;:]+$/, "");
      return cleanUrl;
    }
    const wikiLinkMatch = value.match(/\[\[(.*?)\]\]/);
    if (wikiLinkMatch) {
      const wikiLink = `[[${wikiLinkMatch[1]}]]`;
      Logger.debug("Extracted wiki link:", wikiLink);
      return wikiLink;
    }
    const urlMatch = value.match(/(https?:\/\/[^\s"'<>[\]{}]+)/);
    if (urlMatch) {
      const url = urlMatch[1];
      Logger.debug("Extracted URL:", url);
      const cleanUrl = url.replace(/['",.;:]+$/, "");
      return cleanUrl;
    }
    return value;
  }
  /**
   * Lazy load an image using Intersection Observer
   * 
   * @param imageContainer The container element for the image
   * @param placeholder The placeholder element
   * @param imagePath The path to the image
   */
  lazyLoadImage(imageContainer, placeholder, imagePath) {
    Logger.debug("Lazy loading image:", imagePath);
    const observer = new IntersectionObserver((entries, observer2) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          Logger.debug("Image container is now visible, loading image:", imagePath);
          this.loadImage(imageContainer, placeholder, imagePath);
          observer2.disconnect();
        }
      });
    }, {
      rootMargin: "100px",
      // Start loading when image is 100px from viewport
      threshold: 0.1
      // Trigger when at least 10% of the element is visible
    });
    observer.observe(imageContainer);
  }
  /**
   * Load an image immediately
   * 
   * @param imageContainer The container element for the image
   * @param placeholder The placeholder element
   * @param imagePath The path to the image
   */
  loadImage(imageContainer, placeholder, imagePath) {
    const markdownImageMatch = imagePath.match(/!\[(.*?)\]\((.*?)\)/);
    if (markdownImageMatch) {
      const imageUrl = markdownImageMatch[2];
      Logger.debug("Extracted URL from markdown image syntax:", imageUrl);
      this.loadImage(imageContainer, placeholder, imageUrl);
      return;
    }
    if (imagePath.startsWith("http") || imagePath.startsWith("https")) {
      Logger.debug("Handling as external URL:", imagePath);
      const cleanUrl = imagePath.replace(/['",.;:]+$/, "");
      Logger.debug("Cleaned URL:", cleanUrl);
      this.loadExternalImage(imageContainer, placeholder, cleanUrl);
    } else if (imagePath.startsWith("[[") && imagePath.endsWith("]]")) {
      Logger.debug("Handling as wiki link");
      const linkText = imagePath.substring(2, imagePath.length - 2);
      let path = linkText;
      if (linkText.includes("|")) {
        const parts = linkText.split("|");
        path = parts[0];
      }
      try {
        const abstractFile = this.app.vault.getAbstractFileByPath(path);
        if (abstractFile && "stat" in abstractFile) {
          Logger.debug("Found file in vault:", abstractFile);
          const file = abstractFile;
          const resourcePath = this.app.vault.getResourcePath(file);
          Logger.debug("Resource path:", resourcePath);
          const img = imageContainer.createEl("img", {
            cls: "datacards-image",
            attr: { src: resourcePath }
          });
          img.onload = () => {
            placeholder.remove();
            img.addClass("loaded");
          };
          img.onerror = () => {
            placeholder.setText("Image not found");
          };
        } else {
          Logger.debug("File not found in vault or not a file:", path);
          placeholder.setText("Image not found");
        }
      } catch (error) {
        Logger.error("Error loading image:", error);
        placeholder.setText("Error loading image");
      }
    } else {
      Logger.debug("Handling as local path");
      try {
        const abstractFile = this.app.vault.getAbstractFileByPath(imagePath);
        if (abstractFile && "stat" in abstractFile) {
          Logger.debug("Found file in vault:", abstractFile);
          const file = abstractFile;
          const resourcePath = this.app.vault.getResourcePath(file);
          Logger.debug("Resource path:", resourcePath);
          const img = imageContainer.createEl("img", {
            cls: "datacards-image",
            attr: { src: resourcePath }
          });
          img.onload = () => {
            placeholder.remove();
            img.addClass("loaded");
          };
          img.onerror = () => {
            placeholder.setText("Image not found");
          };
        } else {
          Logger.debug("File not found in vault:", imagePath);
          placeholder.setText("Image not found");
        }
      } catch (error) {
        Logger.error("Error loading image:", error);
        placeholder.setText("Error loading image");
      }
    }
  }
  /**
   * Load an external image with multiple fallback approaches
   * 
   * @param imageContainer The container element for the image
   * @param placeholder The placeholder element
   * @param url The URL of the image
   */
  loadExternalImage(imageContainer, placeholder, url) {
    Logger.debug("Loading external image with URL:", url);
    const img = imageContainer.createEl("img", {
      cls: "datacards-image",
      attr: {
        src: url,
        // Add crossorigin attribute to help with CORS issues
        crossorigin: "anonymous"
      }
    });
    img.onload = () => {
      Logger.debug("External image loaded successfully:", url);
      placeholder.remove();
      img.addClass("loaded");
    };
    img.onerror = (error) => {
      Logger.error("Failed to load external image with crossorigin attribute:", url, error);
      Logger.debug("Trying again without crossorigin attribute");
      img.removeAttribute("crossorigin");
      img.onload = () => {
        Logger.debug("External image loaded successfully without crossorigin:", url);
        placeholder.remove();
        img.addClass("loaded");
      };
      img.onerror = (secondError) => {
        Logger.error("Failed to load external image without crossorigin:", url, secondError);
        const proxyUrl = `https://images.weserv.nl/?url=${encodeURIComponent(url)}`;
        Logger.debug("Trying with image proxy service:", proxyUrl);
        img.src = proxyUrl;
        img.onload = () => {
          Logger.debug("External image loaded successfully via proxy:", proxyUrl);
          placeholder.remove();
          img.addClass("loaded");
        };
        img.onerror = (thirdError) => {
          Logger.error("All attempts to load image failed:", url, thirdError);
          placeholder.setText("Image not found - URL: " + url);
          try {
            const testImg = document.createElement("img");
            testImg.style.display = "none";
            testImg.src = url;
            document.body.appendChild(testImg);
            setTimeout(() => {
              if (document.body.contains(testImg)) {
                document.body.removeChild(testImg);
              }
            }, 3e3);
          } catch (e) {
            Logger.error("Error during final test:", e);
          }
        };
      };
    };
  }
  /**
   * Add a property to a card
   * 
   * @param contentEl The content element to add the property to
   * @param propertyName The name of the property
   * @param propertyValue The value of the property
   * @param settings The settings
   */
  addPropertyToCard(contentEl, propertyName, propertyValue, settings) {
    Logger.debug(`Adding property to card: ${propertyName} = ${propertyValue}`);
    Logger.debug(`Property type: ${typeof propertyValue}`);
    const propertyEl = contentEl.createEl("div", {
      cls: "datacards-property"
    });
    if (settings.propertiesAlign) {
      propertyEl.addClass(`datacards-text-${settings.propertiesAlign}`);
    }
    let displayName = propertyName;
    if (settings.columnAliases) {
      const aliasEntry = settings.columnAliases.find((a) => a.original === propertyName);
      if (aliasEntry) {
        displayName = aliasEntry.alias;
        Logger.debug(`Using alias "${displayName}" for property "${propertyName}"`);
      }
    }
    if (settings.showLabels) {
      const labelEl = propertyEl.createEl("div", {
        cls: "datacards-property-label",
        text: displayName
      });
      if (settings.propertiesAlign) {
        labelEl.addClass(`datacards-text-${settings.propertiesAlign}`);
      }
    }
    if (propertyName.toLowerCase() === "file") {
      this.formatFileProperty(propertyEl, propertyValue);
    } else {
      const formatter = settings.propertyFormatters[propertyName];
      if (formatter) {
        this.formatPropertyWithCustomFormatter(propertyEl, propertyValue, formatter);
      } else {
        this.formatPropertyByType(propertyEl, propertyValue);
      }
    }
  }
  /**
   * Format a property value using a custom formatter
   * 
   * @param propertyEl The property element
   * @param value The property value
   * @param formatter The formatter configuration
   */
  formatPropertyWithCustomFormatter(propertyEl, value, formatter) {
    const valueEl = propertyEl.createEl("div", {
      cls: "datacards-property-value"
    });
    switch (formatter.type) {
      case "stars":
        this.formatAsStars(valueEl, value, formatter.options);
        break;
      case "badge":
        this.formatAsBadge(valueEl, value, formatter.options);
        break;
      case "progress":
        this.formatAsProgress(valueEl, value, formatter.options);
        break;
      case "date":
        this.formatAsDate(valueEl, value, formatter.options);
        break;
      case "tags":
        this.formatAsTags(valueEl, value, formatter.options);
        break;
      default:
        valueEl.setText(String(value));
    }
  }
  /**
   * Format a property value based on its type
   * 
   * @param propertyEl The property element
   * @param value The property value
   */
  formatPropertyByType(propertyEl, value) {
    Logger.debug("formatPropertyByType called with value:", value);
    Logger.debug("Value type:", typeof value);
    if (typeof value === "string") {
      Logger.debug("String value length:", value.length);
      Logger.debug("String value exact content:", JSON.stringify(value));
    }
    const valueEl = propertyEl.createEl("div", {
      cls: "datacards-property-value"
    });
    if (propertyEl.hasClass("datacards-text-left")) {
      valueEl.addClass("datacards-text-left");
    } else if (propertyEl.hasClass("datacards-text-center")) {
      valueEl.addClass("datacards-text-center");
    } else if (propertyEl.hasClass("datacards-text-right")) {
      valueEl.addClass("datacards-text-right");
    }
    if (value === null || value === void 0) {
      valueEl.setText("");
    } else if (Array.isArray(value)) {
      valueEl.setText(value.join(", "));
    } else if (typeof value === "boolean") {
      const checkbox = valueEl.createEl("input", {
        attr: {
          type: "checkbox",
          checked: value ? "checked" : "",
          disabled: "disabled"
        }
      });
    } else if (typeof value === "number") {
      valueEl.setText(value.toString());
    } else if (value instanceof Date) {
      this.formatAsDate(valueEl, value);
    } else if (typeof value === "string") {
      const isIsoDate = /^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3}[+-]\d{2}:\d{2}$/.test(value) || /^\d{4}-\d{2}-\d{2}$/.test(value);
      if (isIsoDate) {
        const date = new Date(value);
        if (!isNaN(date.getTime())) {
          this.formatAsDate(valueEl, date);
          return;
        }
      }
      const extractedValue = this.extractImageSource(value);
      if (extractedValue !== value) {
        this.formatPropertyByType(propertyEl, extractedValue);
        return;
      }
      if (typeof value === "string" && value.includes("[[") && value.includes("|") && value.includes("]]")) {
        const match = value.match(/\[\[.*\|(.*?)\]\]/);
        if (match && match[1]) {
          valueEl.setText(match[1]);
          return;
        }
      }
      if (value.includes("[[") && value.includes("]]")) {
        console.log("DATACARDS DEBUG: Found wiki link in property value:", value);
        Logger.debug("Found wiki link in property value:", value);
        const wikiLinkRegex = /\[\[([^\]|]+)(?:\|([^\]]+))?\]\]/;
        const wikiLinkMatch = value.match(wikiLinkRegex);
        if (wikiLinkMatch) {
          console.log("DATACARDS DEBUG: Wiki link match:", wikiLinkMatch);
          Logger.debug("Wiki link match:", wikiLinkMatch);
          const path = wikiLinkMatch[1];
          const displayText = wikiLinkMatch[2] || this.getCleanFilename(path);
          console.log(`DATACARDS DEBUG: Wiki link path: "${path}", display text: "${displayText}"`);
          Logger.debug(`Wiki link path: "${path}", display text: "${displayText}"`);
          console.log("DATACARDS DEBUG: Creating link element for wiki link");
          const link = valueEl.createEl("a", {
            cls: "internal-link datacards-file-link",
            text: displayText,
            attr: {
              href: path,
              "data-href": path,
              "data-type": "link"
            }
          });
          console.log("DATACARDS DEBUG: Link element created:", link);
          this.app.workspace.trigger("hover-link", {
            event: new MouseEvent("mouseover"),
            source: "preview",
            hoverEl: link,
            targetEl: link,
            linktext: path
          });
          return;
        }
      }
      const markdownImageMatch = value.match(/!\[(.*?)\]\((.*?)\)/);
      if (markdownImageMatch) {
        Logger.debug("Found markdown image in property value");
        const imageUrl = markdownImageMatch[2];
        const altText = markdownImageMatch[1];
        valueEl.addClass("loading");
        const img = valueEl.createEl("img", {
          cls: "datacards-property-image loading",
          attr: {
            src: imageUrl,
            alt: altText || "Image",
            crossorigin: "anonymous"
            // Add crossorigin attribute to help with CORS issues
          }
        });
        img.onload = () => {
          Logger.debug("Property image loaded successfully:", imageUrl);
          img.removeClass("loading");
        };
        img.onerror = () => {
          Logger.error("Failed to load property image:", imageUrl);
          img.remove();
          valueEl.removeClass("loading");
          valueEl.addClass("image-error");
          valueEl.setText("Image not found: " + imageUrl);
        };
        return;
      }
      if (value.startsWith("[[") && value.endsWith("]]")) {
        console.log("DATACARDS DEBUG: Processing wiki link that starts and ends with [[]]:", value);
        Logger.debug("Processing wiki link that starts and ends with [[]]:", value);
        const wikiLinkRegex = /\[\[([^\]|]+)(?:\|([^\]]+))?\]\]/;
        const wikiLinkMatch = value.match(wikiLinkRegex);
        if (wikiLinkMatch) {
          const path = wikiLinkMatch[1];
          const displayText = wikiLinkMatch[2] || this.getCleanFilename(path);
          console.log(`DATACARDS DEBUG: Wiki link path: "${path}", display text: "${displayText}"`);
          Logger.debug(`Wiki link path: "${path}", display text: "${displayText}"`);
          console.log("DATACARDS DEBUG: Creating link element for wiki link (direct match)");
          const link = valueEl.createEl("a", {
            cls: "internal-link datacards-file-link",
            text: displayText,
            attr: {
              href: path,
              "data-href": path,
              "data-type": "link"
            }
          });
          console.log("DATACARDS DEBUG: Link element created (direct match):", link);
          this.app.workspace.trigger("hover-link", {
            event: new MouseEvent("mouseover"),
            source: "preview",
            hoverEl: link,
            targetEl: link,
            linktext: path
          });
        } else {
          const linkText = value.substring(2, value.length - 2);
          let displayText = linkText;
          let path = linkText;
          if (linkText.includes("|")) {
            const parts = linkText.split("|");
            path = parts[0];
            displayText = parts[1];
          } else {
            displayText = this.getCleanFilename(path);
          }
          Logger.debug(`Fallback wiki link path: "${path}", display text: "${displayText}"`);
          const link = valueEl.createEl("a", {
            cls: "internal-link datacards-file-link",
            text: displayText,
            attr: {
              href: path,
              "data-href": path,
              "data-type": "link"
            }
          });
          this.app.workspace.trigger("hover-link", {
            event: new MouseEvent("mouseover"),
            source: "preview",
            hoverEl: link,
            targetEl: link,
            linktext: path
          });
        }
      } else if (value.startsWith("#")) {
        const tag = valueEl.createEl("a", {
          cls: "datacards-tag tag-link",
          text: value,
          attr: {
            href: value,
            "data-href": value,
            "data-type": "tag"
          }
        });
      } else if (/<[ubia]>|<\/[ubia]>|<span|<div|<p>|<\/p>|<br>|<hr>/.test(value)) {
        console.log("DATACARDS DEBUG: Rendering HTML content:", value);
        valueEl.innerHTML = value;
      } else {
        valueEl.setText(value);
      }
    } else if (typeof value === "object" && value !== null) {
      if ("path" in value && "type" in value && value.type === "file") {
        console.log("Handling Dataview Link object:", value);
        const path = value.path;
        const displayText = value.display || this.getCleanFilename(path);
        console.log(`Creating link from Dataview Link object: path="${path}", display="${displayText}"`);
        const link = valueEl.createEl("a", {
          cls: "internal-link",
          text: displayText,
          attr: {
            href: path,
            "data-href": path,
            "data-type": "link"
          }
        });
        this.app.workspace.trigger("hover-link", {
          event: new MouseEvent("mouseover"),
          source: "preview",
          hoverEl: link,
          targetEl: link,
          linktext: path
        });
        return;
      }
      if ("ts" in value && typeof value.ts === "number") {
        const date = new Date(value.ts);
        if (!isNaN(date.getTime())) {
          this.formatAsDate(valueEl, date);
          return;
        }
      }
      valueEl.setText(String(value));
    } else {
      valueEl.setText(String(value));
    }
  }
  /**
   * Format a value as stars (for ratings)
   * 
   * @param container The container element
   * @param value The value to format
   * @param options Formatting options
   */
  formatAsStars(container, value, options) {
    const maxStars = (options == null ? void 0 : options.max) || 5;
    const starFull = "\u2605";
    const starEmpty = "\u2606";
    const starsContainer = container.createEl("div", {
      cls: "datacards-stars"
    });
    const numStars = Math.min(Math.max(0, value), maxStars);
    for (let i = 0; i < numStars; i++) {
      starsContainer.createEl("span", {
        cls: "datacards-star datacards-star-full",
        text: starFull
      });
    }
    for (let i = numStars; i < maxStars; i++) {
      starsContainer.createEl("span", {
        cls: "datacards-star datacards-star-empty",
        text: starEmpty
      });
    }
  }
  /**
   * Format a value as a badge
   * 
   * @param container The container element
   * @param value The value to format
   * @param options Formatting options
   */
  formatAsBadge(container, value, options) {
    const badge = container.createEl("span", {
      cls: "datacards-badge",
      text: value
    });
    if (options == null ? void 0 : options.color) {
      badge.style.backgroundColor = options.color;
    }
  }
  /**
   * Format a value as a progress bar
   * 
   * @param container The container element
   * @param value The value to format
   * @param options Formatting options
   */
  formatAsProgress(container, value, options) {
    const max = (options == null ? void 0 : options.max) || 100;
    const percentage = Math.min(Math.max(0, value), max) / max * 100;
    const progressContainer = container.createEl("div", {
      cls: "datacards-progress-container"
    });
    const progressBar = progressContainer.createEl("div", {
      cls: "datacards-progress-bar"
    });
    progressBar.style.width = `${percentage}%`;
    if (options == null ? void 0 : options.showText) {
      progressContainer.createEl("span", {
        cls: "datacards-progress-text",
        text: `${Math.round(percentage)}%`
      });
    }
  }
  /**
   * Format a value as a date
   * 
   * @param container The container element
   * @param value The value to format
   * @param options Formatting options
   */
  formatAsDate(container, value, options) {
    const date = typeof value === "string" ? new Date(value) : value;
    if (isNaN(date.getTime())) {
      container.setText(String(value));
      return;
    }
    const format = (options == null ? void 0 : options.format) || (this.currentSettings ? this.currentSettings.defaultDateFormat : DEFAULT_SETTINGS.defaultDateFormat);
    const year = date.getFullYear();
    const month = (date.getMonth() + 1).toString().padStart(2, "0");
    const day = date.getDate().toString().padStart(2, "0");
    let formattedDate = format.replace("YYYY", year.toString()).replace("MM", month).replace("DD", day);
    container.setText(formattedDate);
  }
  /**
   * Format a file property as a clickable link
   * Special handling for the file property which is always a link to the note
   * 
   * @param propertyEl The property element
   * @param value The file property value
   */
  formatFileProperty(propertyEl, value) {
    var _a;
    const valueEl = propertyEl.createEl("div", {
      cls: "datacards-property-value datacards-file-property"
    });
    if ((_a = this.currentSettings) == null ? void 0 : _a.titleAlign) {
      valueEl.addClass(`datacards-text-${this.currentSettings.titleAlign}`);
    } else {
      if (propertyEl.hasClass("datacards-text-left")) {
        valueEl.addClass("datacards-text-left");
      } else if (propertyEl.hasClass("datacards-text-center")) {
        valueEl.addClass("datacards-text-center");
      } else if (propertyEl.hasClass("datacards-text-right")) {
        valueEl.addClass("datacards-text-right");
      }
    }
    if (value === null || value === void 0) {
      valueEl.setText("");
      return;
    }
    let stringValue;
    if (typeof value === "object" && value !== null) {
      if ("path" in value) {
        stringValue = value.path;
      } else if ("link" in value) {
        stringValue = value.link;
      } else {
        stringValue = String(value);
      }
    } else {
      stringValue = String(value);
    }
    stringValue = this.extractImageSource(stringValue);
    Logger.debug("File property after image source extraction:", stringValue);
    if (typeof value === "string" && value.includes("[[") && value.includes("|") && value.includes("]]")) {
      console.log("DATACARDS DEBUG: Found wiki link with pipe character:", value);
      const match = value.match(/\[\[.*\|(.*?)\]\]/);
      if (match && match[1]) {
        console.log("DATACARDS DEBUG: Extracted display text:", match[1]);
        const fullMatch = value.match(/\[\[(.*?)\|(.*?)\]\]/);
        if (fullMatch) {
          const path = fullMatch[1];
          const displayText = fullMatch[2];
          console.log(`DATACARDS DEBUG: Creating link from pipe syntax - path: "${path}", display: "${displayText}"`);
          const link = valueEl.createEl("a", {
            cls: "internal-link datacards-file-link",
            text: displayText,
            attr: {
              href: path,
              "data-href": path,
              "data-type": "link"
            }
          });
          console.log("DATACARDS DEBUG: Created link element for pipe syntax:", link);
          this.app.workspace.trigger("hover-link", {
            event: new MouseEvent("mouseover"),
            source: "preview",
            hoverEl: link,
            targetEl: link,
            linktext: path
          });
          return;
        } else {
          console.log("DATACARDS DEBUG: Fallback to text only for pipe syntax");
          valueEl.setText(match[1]);
          return;
        }
      }
    }
    if (stringValue.includes("[[") && stringValue.includes("]]")) {
      Logger.debug("Found wiki link in file property:", stringValue);
      const wikiLinkMatch = stringValue.match(/\[\[([^\]]+)\]\]/);
      if (wikiLinkMatch) {
        const linkText = wikiLinkMatch[1];
        let displayText = linkText;
        let path = linkText;
        if (linkText.includes("|")) {
          const parts = linkText.split("|");
          path = parts[0];
          displayText = parts[1];
        } else {
          displayText = this.getCleanFilename(path);
        }
        const link = valueEl.createEl("a", {
          cls: "internal-link datacards-file-link",
          text: displayText,
          attr: {
            href: path,
            "data-href": path,
            "data-type": "link"
          }
        });
        return;
      }
    } else if (stringValue.startsWith("[[") && stringValue.endsWith("]]")) {
      const linkText = stringValue.substring(2, stringValue.length - 2);
      let displayText = linkText;
      let path = linkText;
      if (linkText.includes("|")) {
        const parts = linkText.split("|");
        path = parts[0];
        displayText = parts[1];
      } else {
        displayText = this.getCleanFilename(path);
      }
      const link = valueEl.createEl("a", {
        cls: "internal-link datacards-file-link",
        text: displayText,
        attr: {
          href: path,
          "data-href": path,
          "data-type": "link"
        }
      });
    } else {
      const displayText = this.getCleanFilename(stringValue);
      const link = valueEl.createEl("a", {
        cls: "internal-link datacards-file-link",
        text: displayText,
        attr: {
          href: stringValue,
          "data-href": stringValue,
          "data-type": "link"
        }
      });
    }
  }
  /**
   * Extract just the filename without path and extension
   * 
   * @param path The file path
   * @returns The clean filename
   */
  getCleanFilename(path) {
    let filename = path;
    if (filename.includes("/")) {
      filename = filename.split("/").pop() || filename;
    }
    if (filename.endsWith(".md")) {
      filename = filename.substring(0, filename.length - 3);
    }
    return filename;
  }
  /**
   * Format a value as tags
   * 
   * @param container The container element
   * @param value The value to format
   * @param options Formatting options
   */
  formatAsTags(container, value, options) {
    const tagsContainer = container.createEl("div", {
      cls: "datacards-tags-container"
    });
    const tags = Array.isArray(value) ? value : [value];
    tags.forEach((tag) => {
      const tagText = tag.startsWith("#") ? tag : `#${tag}`;
      const tagEl = tagsContainer.createEl("a", {
        cls: "datacards-tag tag-link",
        text: tagText,
        attr: {
          href: tagText,
          "data-href": tagText,
          "data-type": "tag"
        }
      });
    });
  }
  /**
   * Determine if properties should be scrollable based on settings precedence
   * 
   * @param settings The merged settings
   * @returns True if properties should be scrollable, false otherwise
   */
  shouldUseScrollableProperties(settings) {
    let shouldScroll = false;
    if (settings.preset === "square" || settings.preset === "compact") {
      shouldScroll = true;
    }
    if (this.pluginSettings.scrollableProperties !== void 0) {
      shouldScroll = this.pluginSettings.scrollableProperties;
    }
    const isMobile = this.isMobileDevice();
    if (isMobile && this.pluginSettings.mobileScrollableProperties !== void 0) {
      shouldScroll = this.pluginSettings.mobileScrollableProperties;
    }
    if (settings.scrollableProperties !== void 0) {
      shouldScroll = settings.scrollableProperties;
    }
    return shouldScroll;
  }
  /**
   * Get the content height based on settings precedence
   * 
   * @param settings The merged settings
   * @returns The content height as a string (e.g., '200px')
   */
  getContentHeight(settings) {
    let contentHeight = "200px";
    if (this.pluginSettings.contentHeight) {
      contentHeight = this.pluginSettings.contentHeight;
    }
    const isMobile = this.isMobileDevice();
    if (isMobile && this.pluginSettings.mobileContentHeight) {
      contentHeight = this.pluginSettings.mobileContentHeight;
    }
    if (settings.contentHeight) {
      contentHeight = settings.contentHeight;
    }
    return contentHeight;
  }
};

// src/utils/dataview-api.ts
var DataviewApiUtil = class {
  constructor(plugin) {
    this.plugin = plugin;
  }
  /**
   * Check if Dataview plugin is installed and enabled
   */
  isDataviewEnabled() {
    return this.plugin.app.plugins.plugins.dataview !== void 0;
  }
  /**
   * Get the Dataview API
   * @returns The Dataview API or null if not available
   */
  getDataviewApi() {
    if (!this.isDataviewEnabled()) {
      return null;
    }
    return this.plugin.app.plugins.plugins.dataview.api;
  }
  /**
   * Execute a Dataview query
   * @param query The Dataview query string
   * @param sourcePath The source file path
   * @param container The container element for rendering
   * @returns The query result or null if Dataview is not available
   */
  async executeQuery(query, sourcePath, container) {
    const api = this.getDataviewApi();
    if (!api) {
      return null;
    }
    try {
      return await api.query(query, sourcePath, container);
    } catch (error) {
      Logger.error("Error executing Dataview query:", error);
      throw error;
    }
  }
  /**
   * Wait for Dataview to complete indexing
   * @returns A promise that resolves to true if Dataview is ready, false if timed out
   */
  async waitForDataviewReady() {
    const api = this.getDataviewApi();
    if (!api) return false;
    if (api.index && api.index.initialized) {
      Logger.debug("Dataview index is already initialized");
      return true;
    }
    Logger.debug("Waiting for Dataview index to be ready...");
    return new Promise((resolve) => {
      const app = this.plugin.app;
      const eventRef = app.metadataCache.on("dataview:index-ready", () => {
        Logger.debug("Dataview index is now ready");
        app.metadataCache.offref(eventRef);
        resolve(true);
      });
      setTimeout(() => {
        Logger.warn("Timed out waiting for Dataview index");
        app.metadataCache.offref(eventRef);
        resolve(false);
      }, 5e3);
    });
  }
  /**
   * Execute a Dataview query safely, returning an object indicating success or failure
   * @param query The Dataview query string
   * @param sourcePath The source file path
   * @param container The container element for rendering
   * @param retryCount Optional retry count for internal use
   * @returns An object with the query result or error
   */
  async executeSafeQuery(query, sourcePath, container, retryCount = 0) {
    const api = this.getDataviewApi();
    if (!api) {
      Logger.error("Dataview API not found. Make sure Dataview plugin is enabled.");
      return { successful: false, value: "Dataview plugin is not enabled" };
    }
    if (!query || query.trim() === "") {
      Logger.error("Empty Dataview query");
      return { successful: false, value: "Empty query" };
    }
    Logger.debug("Executing Dataview query:", query);
    Logger.debug("Source path:", sourcePath);
    try {
      if (typeof api.query === "function") {
        Logger.debug("Using api.query method");
        try {
          const result = await api.query(query, sourcePath, container);
          Logger.debug("Direct query result type:", typeof result);
          if (result === void 0 || result === null) {
            Logger.error("Direct query returned undefined or null");
            return { successful: false, value: "No results returned" };
          }
          if (result && typeof result === "object") {
            if ("values" in result && Array.isArray(result.values)) {
              Logger.debug("Result contains a values array with length:", result.values.length);
            }
            if ("headers" in result && Array.isArray(result.headers)) {
              Logger.debug("Result contains headers:", result.headers);
            }
          }
          if (result && typeof result === "object" && "values" in result && Array.isArray(result.values) && result.values.length === 0 && retryCount < 3) {
            Logger.debug(`Empty result, retrying (attempt ${retryCount + 1}/3)...`);
            return new Promise((resolve) => {
              setTimeout(async () => {
                const retryResult = await this.executeSafeQuery(query, sourcePath, container, retryCount + 1);
                resolve(retryResult);
              }, 500);
            });
          }
          return { successful: true, value: result };
        } catch (queryError) {
          Logger.error("Error in direct query:", queryError);
          return {
            successful: false,
            value: queryError ? queryError.message || String(queryError) : "Error in query execution"
          };
        }
      } else {
        Logger.error("Dataview API query method not found.");
        return { successful: false, value: "Incompatible Dataview API version" };
      }
    } catch (error) {
      Logger.error("Error executing Dataview query:", error);
      return {
        successful: false,
        value: error ? error.message || String(error) : "Unknown error"
      };
    }
  }
};

// src/main.ts
var DataCardsPlugin = class extends import_obsidian3.Plugin {
  constructor() {
    super(...arguments);
    this.isRefreshing = false;
    this.lastActiveElement = null;
    this.refreshDebounceTimeout = 2500;
    /**
     * Debounced refresh function to avoid multiple refreshes in quick succession
     * This helps prevent input field focus loss when typing quickly
     */
    this.debouncedRefresh = (0, import_obsidian3.debounce)((file) => {
      this.refreshAffectedDataCards(file);
    }, this.refreshDebounceTimeout);
  }
  // ms to wait before refreshing (1.5 seconds)
  async onload() {
    await this.loadSettings();
    Logger.setDebugMode(this.settings.debugMode);
    this.parserService = new ParserService();
    this.rendererService = new RendererService(this.app, this.settings);
    this.dataviewApiUtil = new DataviewApiUtil(this);
    this.registerMarkdownCodeBlockProcessor("datacards", this.processDataCardsBlock.bind(this));
    this.addSettingTab(new DataCardsSettingTab(this.app, this));
    this.addCommand({
      id: "refresh-datacards",
      name: "Refresh all DataCards",
      callback: () => {
        this.refreshAllDataCards(true);
      }
    });
    this.registerDataviewEvents();
    Logger.debug("DataCards plugin loaded");
  }
  /**
   * Register event listeners for Dataview events
   */
  registerDataviewEvents() {
    this.app.workspace.onLayoutReady(() => {
      if (!this.dataviewApiUtil.isDataviewEnabled()) {
        Logger.warn("Dataview plugin is not enabled, cannot register for metadata change events");
        return;
      }
      this.registerEvent(
        // @ts-ignore - Dataview adds custom events to metadataCache
        this.app.metadataCache.on("dataview:metadata-change", (type, file) => {
          this.handleMetadataChange(type, file);
        })
      );
      Logger.debug("Registered for Dataview metadata change events");
    });
  }
  /**
   * Handle Dataview metadata changes
   * 
   * @param type The type of change
   * @param file The file that changed
   */
  handleMetadataChange(type, file) {
    if (!this.settings.enableDynamicUpdates) {
      Logger.debug("Dynamic updates are disabled globally, ignoring metadata change");
      return;
    }
    Logger.debug(`Dataview metadata changed: ${type} for file ${file == null ? void 0 : file.path}`);
    this.debouncedRefresh(file);
  }
  /**
   * Refresh DataCards that might be affected by changes to a specific file
   * 
   * @param file The file that changed
   */
  refreshAffectedDataCards(file) {
    if (!file) return;
    this.lastActiveElement = document.activeElement;
    this.refreshAllDataCards(false);
  }
  onunload() {
    Logger.debug("DataCards plugin unloaded");
  }
  async loadSettings() {
    this.settings = Object.assign({}, DEFAULT_SETTINGS, await this.loadData());
  }
  async saveSettings() {
    await this.saveData(this.settings);
    Logger.setDebugMode(this.settings.debugMode);
    this.rendererService.updateSettings(this.settings);
    this.refreshAllDataCards(true);
  }
  /**
   * Process a datacards code block
   * 
   * @param source The content of the code block
   * @param el The HTML element to render into
   * @param ctx The markdown post processor context
   */
  async processDataCardsBlock(source, el, ctx) {
    Logger.debug("Processing DataCards block");
    if (!this.dataviewApiUtil.isDataviewEnabled()) {
      Logger.error("Dataview plugin is not enabled");
      el.createEl("div", {
        cls: "datacards-error",
        text: "Dataview plugin is required but not enabled"
      });
      return;
    }
    const isDataviewReady = await this.dataviewApiUtil.waitForDataviewReady();
    if (!isDataviewReady) {
      Logger.warn("Timed out waiting for Dataview to be ready");
    }
    try {
      const { query, settings } = this.parserService.parseDataCardsBlock(source);
      Logger.debug("Parsed query:", query);
      Logger.debug("Parsed settings:", settings);
      const sourcePath = ctx.sourcePath;
      const dataviewContainer = document.createElement("div");
      dataviewContainer.style.display = "none";
      document.body.appendChild(dataviewContainer);
      try {
        Logger.debug("Executing Dataview query");
        const result = await this.dataviewApiUtil.executeSafeQuery(query, sourcePath, dataviewContainer);
        document.body.removeChild(dataviewContainer);
        if (!result) {
          Logger.error("Result is undefined or null");
          el.createEl("div", {
            cls: "datacards-error",
            text: "Error executing Dataview query: undefined result"
          });
          return;
        }
        if (!result.successful) {
          const errorMessage = `Error executing Dataview query: ${result.value || "unknown error"}`;
          Logger.error(errorMessage);
          el.createEl("div", {
            cls: "datacards-error",
            text: errorMessage
          });
          return;
        }
        if (result.value && typeof result.value === "object" && "successful" in result.value && result.value.successful === false) {
          const errorMessage = `Error executing Dataview query: ${result.value.error || "unknown error"}`;
          Logger.error(errorMessage);
          el.createEl("div", {
            cls: "datacards-error",
            text: errorMessage
          });
          return;
        }
        if (result.value === void 0 || result.value === null) {
          Logger.error("Dataview returned null or undefined value");
          el.createEl("div", {
            cls: "datacards-error",
            text: "Dataview returned no results. Make sure your query is correct and returns data."
          });
          return;
        }
        if (Array.isArray(result.value) && result.value.length === 0) {
          Logger.debug("Dataview returned empty array");
          el.createEl("div", {
            cls: "datacards-info",
            text: "No files match your query criteria."
          });
          return;
        }
        if (result.value.values && Array.isArray(result.value.values) && result.value.values.length === 0) {
          Logger.debug("Dataview returned empty table");
          el.createEl("div", {
            cls: "datacards-info",
            text: "No files match your query criteria."
          });
          return;
        }
        let dataToRender = result.value;
        if (dataToRender && typeof dataToRender === "object" && "successful" in dataToRender && "value" in dataToRender) {
          Logger.debug("Unwrapping nested result structure");
          dataToRender = dataToRender.value;
        }
        if (settings.dynamicUpdate !== void 0) {
          Logger.debug(`Card has dynamicUpdate setting: ${settings.dynamicUpdate}`);
        }
        this.rendererService.renderCards(el, dataToRender, settings);
      } catch (queryError) {
        Logger.error("Error executing Dataview query:", queryError);
        if (document.body.contains(dataviewContainer)) {
          document.body.removeChild(dataviewContainer);
        }
        el.createEl("div", {
          cls: "datacards-error",
          text: `Error executing Dataview query: ${queryError.message || String(queryError)}`
        });
      }
    } catch (error) {
      Logger.error("DataCards error:", error);
      el.createEl("div", {
        cls: "datacards-error",
        text: `Error processing DataCards block: ${error.message || String(error)}`
      });
    }
  }
  /**
   * Refresh all datacards blocks in the current view
   * 
   * @param showNotification Whether to show a notification after refreshing
   */
  refreshAllDataCards(showNotification = true) {
    if (this.isRefreshing) return;
    this.isRefreshing = true;
    const activeView = this.app.workspace.getActiveViewOfType(import_obsidian3.MarkdownView);
    if (activeView) {
      activeView.previewMode.rerender(true);
      if (showNotification) {
        new import_obsidian3.Notice("DataCards refreshed", 2e3);
      }
      setTimeout(() => {
        if (this.lastActiveElement && document.body.contains(this.lastActiveElement)) {
          this.lastActiveElement.focus();
        }
        this.isRefreshing = false;
      }, 50);
    } else {
      if (showNotification) {
        new import_obsidian3.Notice("No active markdown view to refresh", 2e3);
      }
      this.isRefreshing = false;
    }
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsic3JjL21haW4udHMiLCAic3JjL21vZGVscy9zZXR0aW5ncy50cyIsICJzcmMvdWkvc2V0dGluZ3MtdGFiLnRzIiwgInNyYy91dGlscy9sb2dnZXIudHMiLCAic3JjL3NlcnZpY2VzL3BhcnNlci50cyIsICJzcmMvc2VydmljZXMvcmVuZGVyZXIudHMiLCAic3JjL3V0aWxzL2RhdGF2aWV3LWFwaS50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiLypcbiAqIERhdGFDYXJkcyBmb3IgT2JzaWRpYW5cbiAqIENvcHlyaWdodCAoQykgMjAyNSBTb3Bob2tsZXMxODdcbiAqIFxuICogVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbiAqIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5XG4gKiB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvclxuICogKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi5cbiAqIFxuICogVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG4gKiBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuICogTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuICogR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cbiAqIFxuICogWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2VcbiAqIGFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHBzOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi5cbiAqL1xuXG5pbXBvcnQgeyBQbHVnaW4sIE1hcmtkb3duUG9zdFByb2Nlc3NvckNvbnRleHQsIE1hcmtkb3duVmlldywgTm90aWNlLCBkZWJvdW5jZSB9IGZyb20gJ29ic2lkaWFuJztcbmltcG9ydCB7IERhdGFDYXJkc1NldHRpbmdzLCBERUZBVUxUX1NFVFRJTkdTIH0gZnJvbSAnLi9tb2RlbHMvc2V0dGluZ3MnO1xuaW1wb3J0IHsgRGF0YUNhcmRzU2V0dGluZ1RhYiB9IGZyb20gJy4vdWkvc2V0dGluZ3MtdGFiJztcbmltcG9ydCB7IFBhcnNlclNlcnZpY2UgfSBmcm9tICcuL3NlcnZpY2VzL3BhcnNlcic7XG5pbXBvcnQgeyBSZW5kZXJlclNlcnZpY2UgfSBmcm9tICcuL3NlcnZpY2VzL3JlbmRlcmVyJztcbmltcG9ydCB7IERhdGF2aWV3QXBpVXRpbCB9IGZyb20gJy4vdXRpbHMvZGF0YXZpZXctYXBpJztcbmltcG9ydCB7IExvZ2dlciB9IGZyb20gJy4vdXRpbHMvbG9nZ2VyJztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgRGF0YUNhcmRzUGx1Z2luIGV4dGVuZHMgUGx1Z2luIHtcbiAgc2V0dGluZ3M6IERhdGFDYXJkc1NldHRpbmdzO1xuICBwcml2YXRlIHBhcnNlclNlcnZpY2U6IFBhcnNlclNlcnZpY2U7XG4gIHByaXZhdGUgcmVuZGVyZXJTZXJ2aWNlOiBSZW5kZXJlclNlcnZpY2U7XG4gIHByaXZhdGUgZGF0YXZpZXdBcGlVdGlsOiBEYXRhdmlld0FwaVV0aWw7XG4gIHByaXZhdGUgaXNSZWZyZXNoaW5nOiBib29sZWFuID0gZmFsc2U7XG4gIHByaXZhdGUgbGFzdEFjdGl2ZUVsZW1lbnQ6IEVsZW1lbnQgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSByZWZyZXNoRGVib3VuY2VUaW1lb3V0OiBudW1iZXIgPSAyNTAwOyAvLyBtcyB0byB3YWl0IGJlZm9yZSByZWZyZXNoaW5nICgxLjUgc2Vjb25kcylcblxuICBhc3luYyBvbmxvYWQoKSB7XG4gICAgYXdhaXQgdGhpcy5sb2FkU2V0dGluZ3MoKTtcblxuICAgIC8vIEluaXRpYWxpemUgbG9nZ2VyIHdpdGggZGVidWcgbW9kZSBzZXR0aW5nXG4gICAgTG9nZ2VyLnNldERlYnVnTW9kZSh0aGlzLnNldHRpbmdzLmRlYnVnTW9kZSk7XG5cbiAgICAvLyBJbml0aWFsaXplIHNlcnZpY2VzXG4gICAgdGhpcy5wYXJzZXJTZXJ2aWNlID0gbmV3IFBhcnNlclNlcnZpY2UoKTtcbiAgICB0aGlzLnJlbmRlcmVyU2VydmljZSA9IG5ldyBSZW5kZXJlclNlcnZpY2UodGhpcy5hcHAsIHRoaXMuc2V0dGluZ3MpO1xuICAgIHRoaXMuZGF0YXZpZXdBcGlVdGlsID0gbmV3IERhdGF2aWV3QXBpVXRpbCh0aGlzKTtcblxuICAgIC8vIFJlZ2lzdGVyIHRoZSBkYXRhY2FyZHMgY29kZSBibG9jayBwcm9jZXNzb3JcbiAgICB0aGlzLnJlZ2lzdGVyTWFya2Rvd25Db2RlQmxvY2tQcm9jZXNzb3IoJ2RhdGFjYXJkcycsIHRoaXMucHJvY2Vzc0RhdGFDYXJkc0Jsb2NrLmJpbmQodGhpcykpO1xuXG4gICAgLy8gQWRkIHNldHRpbmdzIHRhYlxuICAgIHRoaXMuYWRkU2V0dGluZ1RhYihuZXcgRGF0YUNhcmRzU2V0dGluZ1RhYih0aGlzLmFwcCwgdGhpcykpO1xuXG4gICAgLy8gUmVnaXN0ZXIgYSBjb21tYW5kIHRvIHJlZnJlc2ggYWxsIGRhdGFjYXJkcyBibG9ja3NcbiAgICB0aGlzLmFkZENvbW1hbmQoe1xuICAgICAgaWQ6ICdyZWZyZXNoLWRhdGFjYXJkcycsXG4gICAgICBuYW1lOiAnUmVmcmVzaCBhbGwgRGF0YUNhcmRzJyxcbiAgICAgIGNhbGxiYWNrOiAoKSA9PiB7XG4gICAgICAgIHRoaXMucmVmcmVzaEFsbERhdGFDYXJkcyh0cnVlKTsgLy8gdHJ1ZSA9IHNob3cgbm90aWZpY2F0aW9uXG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBSZWdpc3RlciBldmVudCBsaXN0ZW5lciBmb3IgRGF0YXZpZXcgbWV0YWRhdGEgY2hhbmdlc1xuICAgIHRoaXMucmVnaXN0ZXJEYXRhdmlld0V2ZW50cygpO1xuXG4gICAgTG9nZ2VyLmRlYnVnKCdEYXRhQ2FyZHMgcGx1Z2luIGxvYWRlZCcpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlZ2lzdGVyIGV2ZW50IGxpc3RlbmVycyBmb3IgRGF0YXZpZXcgZXZlbnRzXG4gICAqL1xuICBwcml2YXRlIHJlZ2lzdGVyRGF0YXZpZXdFdmVudHMoKTogdm9pZCB7XG4gICAgLy8gV2FpdCBmb3IgRGF0YXZpZXcgdG8gYmUgcmVhZHkgYmVmb3JlIHJlZ2lzdGVyaW5nIGV2ZW50c1xuICAgIHRoaXMuYXBwLndvcmtzcGFjZS5vbkxheW91dFJlYWR5KCgpID0+IHtcbiAgICAgIC8vIENoZWNrIGlmIERhdGF2aWV3IGlzIGVuYWJsZWRcbiAgICAgIGlmICghdGhpcy5kYXRhdmlld0FwaVV0aWwuaXNEYXRhdmlld0VuYWJsZWQoKSkge1xuICAgICAgICBMb2dnZXIud2FybignRGF0YXZpZXcgcGx1Z2luIGlzIG5vdCBlbmFibGVkLCBjYW5ub3QgcmVnaXN0ZXIgZm9yIG1ldGFkYXRhIGNoYW5nZSBldmVudHMnKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICAvLyBSZWdpc3RlciBmb3IgdGhlIG1ldGFkYXRhLWNoYW5nZSBldmVudFxuICAgICAgLy8gVXNlIHR5cGUgYXNzZXJ0aW9uIHRvIGhhbmRsZSB0aGUgRGF0YXZpZXcgY3VzdG9tIGV2ZW50XG4gICAgICB0aGlzLnJlZ2lzdGVyRXZlbnQoXG4gICAgICAgIC8vIEB0cy1pZ25vcmUgLSBEYXRhdmlldyBhZGRzIGN1c3RvbSBldmVudHMgdG8gbWV0YWRhdGFDYWNoZVxuICAgICAgICB0aGlzLmFwcC5tZXRhZGF0YUNhY2hlLm9uKCdkYXRhdmlldzptZXRhZGF0YS1jaGFuZ2UnLCAodHlwZTogc3RyaW5nLCBmaWxlOiBhbnkpID0+IHtcbiAgICAgICAgICB0aGlzLmhhbmRsZU1ldGFkYXRhQ2hhbmdlKHR5cGUsIGZpbGUpO1xuICAgICAgICB9KVxuICAgICAgKTtcblxuICAgICAgTG9nZ2VyLmRlYnVnKCdSZWdpc3RlcmVkIGZvciBEYXRhdmlldyBtZXRhZGF0YSBjaGFuZ2UgZXZlbnRzJyk7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogSGFuZGxlIERhdGF2aWV3IG1ldGFkYXRhIGNoYW5nZXNcbiAgICogXG4gICAqIEBwYXJhbSB0eXBlIFRoZSB0eXBlIG9mIGNoYW5nZVxuICAgKiBAcGFyYW0gZmlsZSBUaGUgZmlsZSB0aGF0IGNoYW5nZWRcbiAgICovXG4gIHByaXZhdGUgaGFuZGxlTWV0YWRhdGFDaGFuZ2UodHlwZTogc3RyaW5nLCBmaWxlOiBhbnkpOiB2b2lkIHtcbiAgICAvLyBPbmx5IHByb2Nlc3MgaWYgZHluYW1pYyB1cGRhdGVzIGFyZSBlbmFibGVkIGdsb2JhbGx5XG4gICAgaWYgKCF0aGlzLnNldHRpbmdzLmVuYWJsZUR5bmFtaWNVcGRhdGVzKSB7XG4gICAgICBMb2dnZXIuZGVidWcoJ0R5bmFtaWMgdXBkYXRlcyBhcmUgZGlzYWJsZWQgZ2xvYmFsbHksIGlnbm9yaW5nIG1ldGFkYXRhIGNoYW5nZScpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIExvZ2dlci5kZWJ1ZyhgRGF0YXZpZXcgbWV0YWRhdGEgY2hhbmdlZDogJHt0eXBlfSBmb3IgZmlsZSAke2ZpbGU/LnBhdGh9YCk7XG4gICAgXG4gICAgLy8gUmVmcmVzaCB0aGUgYWZmZWN0ZWQgdmlld3Mgd2l0aCBkZWJvdW5jaW5nXG4gICAgdGhpcy5kZWJvdW5jZWRSZWZyZXNoKGZpbGUpO1xuICB9XG5cbiAgLyoqXG4gICAqIERlYm91bmNlZCByZWZyZXNoIGZ1bmN0aW9uIHRvIGF2b2lkIG11bHRpcGxlIHJlZnJlc2hlcyBpbiBxdWljayBzdWNjZXNzaW9uXG4gICAqIFRoaXMgaGVscHMgcHJldmVudCBpbnB1dCBmaWVsZCBmb2N1cyBsb3NzIHdoZW4gdHlwaW5nIHF1aWNrbHlcbiAgICovXG4gIHByaXZhdGUgZGVib3VuY2VkUmVmcmVzaCA9IGRlYm91bmNlKChmaWxlOiBhbnkpID0+IHtcbiAgICB0aGlzLnJlZnJlc2hBZmZlY3RlZERhdGFDYXJkcyhmaWxlKTtcbiAgfSwgdGhpcy5yZWZyZXNoRGVib3VuY2VUaW1lb3V0KTtcblxuICAvKipcbiAgICogUmVmcmVzaCBEYXRhQ2FyZHMgdGhhdCBtaWdodCBiZSBhZmZlY3RlZCBieSBjaGFuZ2VzIHRvIGEgc3BlY2lmaWMgZmlsZVxuICAgKiBcbiAgICogQHBhcmFtIGZpbGUgVGhlIGZpbGUgdGhhdCBjaGFuZ2VkXG4gICAqL1xuICBwcml2YXRlIHJlZnJlc2hBZmZlY3RlZERhdGFDYXJkcyhmaWxlOiBhbnkpOiB2b2lkIHtcbiAgICBpZiAoIWZpbGUpIHJldHVybjtcbiAgICBcbiAgICAvLyBTYXZlIHRoZSBjdXJyZW50bHkgZm9jdXNlZCBlbGVtZW50IGJlZm9yZSByZWZyZXNoXG4gICAgdGhpcy5sYXN0QWN0aXZlRWxlbWVudCA9IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQ7XG4gICAgXG4gICAgLy8gRm9yIG5vdywgd2UnbGwganVzdCByZWZyZXNoIGFsbCBEYXRhQ2FyZHMgc2luY2UgZGV0ZXJtaW5pbmcgd2hpY2ggb25lc1xuICAgIC8vIGFyZSBhZmZlY3RlZCBieSBhIHNwZWNpZmljIGZpbGUgY2hhbmdlIHdvdWxkIHJlcXVpcmUgdHJhY2tpbmcgcXVlcnkgcmVzdWx0c1xuICAgIHRoaXMucmVmcmVzaEFsbERhdGFDYXJkcyhmYWxzZSk7IC8vIGZhbHNlID0gZG9uJ3Qgc2hvdyBub3RpZmljYXRpb24gZHVyaW5nIHR5cGluZ1xuICB9XG5cbiAgb251bmxvYWQoKSB7XG4gICAgTG9nZ2VyLmRlYnVnKCdEYXRhQ2FyZHMgcGx1Z2luIHVubG9hZGVkJyk7XG4gIH1cblxuICBhc3luYyBsb2FkU2V0dGluZ3MoKSB7XG4gICAgdGhpcy5zZXR0aW5ncyA9IE9iamVjdC5hc3NpZ24oe30sIERFRkFVTFRfU0VUVElOR1MsIGF3YWl0IHRoaXMubG9hZERhdGEoKSk7XG4gIH1cblxuICBhc3luYyBzYXZlU2V0dGluZ3MoKSB7XG4gICAgYXdhaXQgdGhpcy5zYXZlRGF0YSh0aGlzLnNldHRpbmdzKTtcbiAgICBcbiAgICAvLyBVcGRhdGUgbG9nZ2VyIGRlYnVnIG1vZGUgaWYgaXQgY2hhbmdlZFxuICAgIExvZ2dlci5zZXREZWJ1Z01vZGUodGhpcy5zZXR0aW5ncy5kZWJ1Z01vZGUpO1xuICAgIFxuICAgIC8vIFVwZGF0ZSB0aGUgcmVuZGVyZXIgc2VydmljZSB3aXRoIHRoZSBuZXcgc2V0dGluZ3NcbiAgICB0aGlzLnJlbmRlcmVyU2VydmljZS51cGRhdGVTZXR0aW5ncyh0aGlzLnNldHRpbmdzKTtcbiAgICBcbiAgICAvLyBSZWZyZXNoIGFsbCBkYXRhY2FyZHMgYmxvY2tzIHRvIGFwcGx5IHRoZSBuZXcgc2V0dGluZ3NcbiAgICB0aGlzLnJlZnJlc2hBbGxEYXRhQ2FyZHModHJ1ZSk7IC8vIHRydWUgPSBzaG93IG5vdGlmaWNhdGlvblxuICB9XG5cbiAgLyoqXG4gICAqIFByb2Nlc3MgYSBkYXRhY2FyZHMgY29kZSBibG9ja1xuICAgKiBcbiAgICogQHBhcmFtIHNvdXJjZSBUaGUgY29udGVudCBvZiB0aGUgY29kZSBibG9ja1xuICAgKiBAcGFyYW0gZWwgVGhlIEhUTUwgZWxlbWVudCB0byByZW5kZXIgaW50b1xuICAgKiBAcGFyYW0gY3R4IFRoZSBtYXJrZG93biBwb3N0IHByb2Nlc3NvciBjb250ZXh0XG4gICAqL1xuICBwcml2YXRlIGFzeW5jIHByb2Nlc3NEYXRhQ2FyZHNCbG9jayhzb3VyY2U6IHN0cmluZywgZWw6IEhUTUxFbGVtZW50LCBjdHg6IE1hcmtkb3duUG9zdFByb2Nlc3NvckNvbnRleHQpIHtcbiAgICBMb2dnZXIuZGVidWcoJ1Byb2Nlc3NpbmcgRGF0YUNhcmRzIGJsb2NrJyk7XG4gICAgXG4gICAgLy8gQ2hlY2sgaWYgRGF0YXZpZXcgaXMgZW5hYmxlZFxuICAgIGlmICghdGhpcy5kYXRhdmlld0FwaVV0aWwuaXNEYXRhdmlld0VuYWJsZWQoKSkge1xuICAgICAgTG9nZ2VyLmVycm9yKCdEYXRhdmlldyBwbHVnaW4gaXMgbm90IGVuYWJsZWQnKTtcbiAgICAgIGVsLmNyZWF0ZUVsKCdkaXYnLCB7XG4gICAgICAgIGNsczogJ2RhdGFjYXJkcy1lcnJvcicsXG4gICAgICAgIHRleHQ6ICdEYXRhdmlldyBwbHVnaW4gaXMgcmVxdWlyZWQgYnV0IG5vdCBlbmFibGVkJ1xuICAgICAgfSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIFxuICAgIC8vIFdhaXQgZm9yIERhdGF2aWV3IHRvIGJlIHJlYWR5XG4gICAgY29uc3QgaXNEYXRhdmlld1JlYWR5ID0gYXdhaXQgdGhpcy5kYXRhdmlld0FwaVV0aWwud2FpdEZvckRhdGF2aWV3UmVhZHkoKTtcbiAgICBpZiAoIWlzRGF0YXZpZXdSZWFkeSkge1xuICAgICAgTG9nZ2VyLndhcm4oJ1RpbWVkIG91dCB3YWl0aW5nIGZvciBEYXRhdmlldyB0byBiZSByZWFkeScpO1xuICAgICAgLy8gQ29udGludWUgYW55d2F5LCBidXQgbG9nIGEgd2FybmluZ1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICAvLyBQYXJzZSB0aGUgY29kZSBibG9jayBjb250ZW50XG4gICAgICBjb25zdCB7IHF1ZXJ5LCBzZXR0aW5ncyB9ID0gdGhpcy5wYXJzZXJTZXJ2aWNlLnBhcnNlRGF0YUNhcmRzQmxvY2soc291cmNlKTtcbiAgICAgIExvZ2dlci5kZWJ1ZygnUGFyc2VkIHF1ZXJ5OicsIHF1ZXJ5KTtcbiAgICAgIExvZ2dlci5kZWJ1ZygnUGFyc2VkIHNldHRpbmdzOicsIHNldHRpbmdzKTtcblxuICAgICAgLy8gR2V0IHRoZSBzb3VyY2UgZmlsZSBwYXRoXG4gICAgICBjb25zdCBzb3VyY2VQYXRoID0gY3R4LnNvdXJjZVBhdGg7XG4gICAgICBcbiAgICAgIC8vIENyZWF0ZSBhIGNvbnRhaW5lciBmb3IgdGhlIERhdGF2aWV3IHF1ZXJ5IHJlc3VsdFxuICAgICAgY29uc3QgZGF0YXZpZXdDb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgIGRhdGF2aWV3Q29udGFpbmVyLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG4gICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGRhdGF2aWV3Q29udGFpbmVyKTsgLy8gVGVtcG9yYXJpbHkgYWRkIHRvIERPTSBmb3IgRGF0YXZpZXcgdG8gd29yayB3aXRoIGl0XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIC8vIEV4ZWN1dGUgdGhlIERhdGF2aWV3IHF1ZXJ5XG4gICAgICAgIExvZ2dlci5kZWJ1ZygnRXhlY3V0aW5nIERhdGF2aWV3IHF1ZXJ5Jyk7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZGF0YXZpZXdBcGlVdGlsLmV4ZWN1dGVTYWZlUXVlcnkocXVlcnksIHNvdXJjZVBhdGgsIGRhdGF2aWV3Q29udGFpbmVyKTtcblxuICAgICAgICAvLyBSZW1vdmUgdGhlIHRlbXBvcmFyeSBjb250YWluZXJcbiAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChkYXRhdmlld0NvbnRhaW5lcik7XG5cbiAgICAgICAgaWYgKCFyZXN1bHQpIHtcbiAgICAgICAgICBMb2dnZXIuZXJyb3IoJ1Jlc3VsdCBpcyB1bmRlZmluZWQgb3IgbnVsbCcpO1xuICAgICAgICAgIGVsLmNyZWF0ZUVsKCdkaXYnLCB7XG4gICAgICAgICAgICBjbHM6ICdkYXRhY2FyZHMtZXJyb3InLFxuICAgICAgICAgICAgdGV4dDogJ0Vycm9yIGV4ZWN1dGluZyBEYXRhdmlldyBxdWVyeTogdW5kZWZpbmVkIHJlc3VsdCdcbiAgICAgICAgICB9KTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIXJlc3VsdC5zdWNjZXNzZnVsKSB7XG4gICAgICAgICAgLy8gSGFuZGxlIHF1ZXJ5IGVycm9yXG4gICAgICAgICAgY29uc3QgZXJyb3JNZXNzYWdlID0gYEVycm9yIGV4ZWN1dGluZyBEYXRhdmlldyBxdWVyeTogJHtyZXN1bHQudmFsdWUgfHwgJ3Vua25vd24gZXJyb3InfWA7XG4gICAgICAgICAgTG9nZ2VyLmVycm9yKGVycm9yTWVzc2FnZSk7XG4gICAgICAgICAgZWwuY3JlYXRlRWwoJ2RpdicsIHtcbiAgICAgICAgICAgIGNsczogJ2RhdGFjYXJkcy1lcnJvcicsXG4gICAgICAgICAgICB0ZXh0OiBlcnJvck1lc3NhZ2VcbiAgICAgICAgICB9KTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC8vIENoZWNrIGlmIHRoZSByZXN1bHQgdmFsdWUgaXRzZWxmIGhhcyBhIHN1Y2Nlc3NmdWwgcHJvcGVydHkgYW5kIGl0J3MgZmFsc2VcbiAgICAgICAgaWYgKHJlc3VsdC52YWx1ZSAmJiB0eXBlb2YgcmVzdWx0LnZhbHVlID09PSAnb2JqZWN0JyAmJiAnc3VjY2Vzc2Z1bCcgaW4gcmVzdWx0LnZhbHVlICYmIHJlc3VsdC52YWx1ZS5zdWNjZXNzZnVsID09PSBmYWxzZSkge1xuICAgICAgICAgIC8vIEhhbmRsZSBxdWVyeSBlcnJvciBpbiB0aGUgcmVzdWx0IHZhbHVlXG4gICAgICAgICAgY29uc3QgZXJyb3JNZXNzYWdlID0gYEVycm9yIGV4ZWN1dGluZyBEYXRhdmlldyBxdWVyeTogJHtyZXN1bHQudmFsdWUuZXJyb3IgfHwgJ3Vua25vd24gZXJyb3InfWA7XG4gICAgICAgICAgTG9nZ2VyLmVycm9yKGVycm9yTWVzc2FnZSk7XG4gICAgICAgICAgZWwuY3JlYXRlRWwoJ2RpdicsIHtcbiAgICAgICAgICAgIGNsczogJ2RhdGFjYXJkcy1lcnJvcicsXG4gICAgICAgICAgICB0ZXh0OiBlcnJvck1lc3NhZ2VcbiAgICAgICAgICB9KTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICAvLyBDaGVjayBpZiByZXN1bHQudmFsdWUgaXMgdW5kZWZpbmVkLCBudWxsLCBvciBlbXB0eVxuICAgICAgICBpZiAocmVzdWx0LnZhbHVlID09PSB1bmRlZmluZWQgfHwgcmVzdWx0LnZhbHVlID09PSBudWxsKSB7XG4gICAgICAgICAgTG9nZ2VyLmVycm9yKCdEYXRhdmlldyByZXR1cm5lZCBudWxsIG9yIHVuZGVmaW5lZCB2YWx1ZScpO1xuICAgICAgICAgIGVsLmNyZWF0ZUVsKCdkaXYnLCB7XG4gICAgICAgICAgICBjbHM6ICdkYXRhY2FyZHMtZXJyb3InLFxuICAgICAgICAgICAgdGV4dDogJ0RhdGF2aWV3IHJldHVybmVkIG5vIHJlc3VsdHMuIE1ha2Ugc3VyZSB5b3VyIHF1ZXJ5IGlzIGNvcnJlY3QgYW5kIHJldHVybnMgZGF0YS4nXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIHJlc3VsdCBpcyBlbXB0eSAobm8gbWF0Y2hpbmcgZmlsZXMpXG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KHJlc3VsdC52YWx1ZSkgJiYgcmVzdWx0LnZhbHVlLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgIExvZ2dlci5kZWJ1ZygnRGF0YXZpZXcgcmV0dXJuZWQgZW1wdHkgYXJyYXknKTtcbiAgICAgICAgICBlbC5jcmVhdGVFbCgnZGl2Jywge1xuICAgICAgICAgICAgY2xzOiAnZGF0YWNhcmRzLWluZm8nLFxuICAgICAgICAgICAgdGV4dDogJ05vIGZpbGVzIG1hdGNoIHlvdXIgcXVlcnkgY3JpdGVyaWEuJ1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChyZXN1bHQudmFsdWUudmFsdWVzICYmIEFycmF5LmlzQXJyYXkocmVzdWx0LnZhbHVlLnZhbHVlcykgJiYgcmVzdWx0LnZhbHVlLnZhbHVlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICBMb2dnZXIuZGVidWcoJ0RhdGF2aWV3IHJldHVybmVkIGVtcHR5IHRhYmxlJyk7XG4gICAgICAgICAgZWwuY3JlYXRlRWwoJ2RpdicsIHtcbiAgICAgICAgICAgIGNsczogJ2RhdGFjYXJkcy1pbmZvJyxcbiAgICAgICAgICAgIHRleHQ6ICdObyBmaWxlcyBtYXRjaCB5b3VyIHF1ZXJ5IGNyaXRlcmlhLidcbiAgICAgICAgICB9KTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICAvLyBDaGVjayBpZiByZXN1bHQudmFsdWUgaXMgdGhlIGFjdHVhbCBkYXRhIG9yIGlmIGl0J3Mgd3JhcHBlZCBpbiBhIHN0cnVjdHVyZVxuICAgICAgICBsZXQgZGF0YVRvUmVuZGVyID0gcmVzdWx0LnZhbHVlO1xuICAgICAgICBcbiAgICAgICAgLy8gSWYgdGhlIHJlc3VsdCBpcyB0aGUgcmVzcG9uc2Ugb2JqZWN0IGl0c2VsZiwgZXh0cmFjdCB0aGUgYWN0dWFsIGRhdGFcbiAgICAgICAgaWYgKGRhdGFUb1JlbmRlciAmJiB0eXBlb2YgZGF0YVRvUmVuZGVyID09PSAnb2JqZWN0JyAmJiAnc3VjY2Vzc2Z1bCcgaW4gZGF0YVRvUmVuZGVyICYmICd2YWx1ZScgaW4gZGF0YVRvUmVuZGVyKSB7XG4gICAgICAgICAgTG9nZ2VyLmRlYnVnKCdVbndyYXBwaW5nIG5lc3RlZCByZXN1bHQgc3RydWN0dXJlJyk7XG4gICAgICAgICAgZGF0YVRvUmVuZGVyID0gZGF0YVRvUmVuZGVyLnZhbHVlO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAvLyBDaGVjayBpZiB0aGlzIHNwZWNpZmljIGNhcmQgaGFzIGEgZHluYW1pYyB1cGRhdGUgc2V0dGluZ1xuICAgICAgICBpZiAoc2V0dGluZ3MuZHluYW1pY1VwZGF0ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgTG9nZ2VyLmRlYnVnKGBDYXJkIGhhcyBkeW5hbWljVXBkYXRlIHNldHRpbmc6ICR7c2V0dGluZ3MuZHluYW1pY1VwZGF0ZX1gKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8gUmVuZGVyIHRoZSBjYXJkcyB3aXRoIHRoZSBleHRyYWN0ZWQgZGF0YVxuICAgICAgICB0aGlzLnJlbmRlcmVyU2VydmljZS5yZW5kZXJDYXJkcyhlbCwgZGF0YVRvUmVuZGVyLCBzZXR0aW5ncyk7XG4gICAgICB9IGNhdGNoIChxdWVyeUVycm9yKSB7XG4gICAgICAgIC8vIEhhbmRsZSBxdWVyeSBleGVjdXRpb24gZXJyb3JzXG4gICAgICAgIExvZ2dlci5lcnJvcignRXJyb3IgZXhlY3V0aW5nIERhdGF2aWV3IHF1ZXJ5OicsIHF1ZXJ5RXJyb3IpO1xuICAgICAgICBcbiAgICAgICAgLy8gTWFrZSBzdXJlIHRvIHJlbW92ZSB0aGUgdGVtcG9yYXJ5IGNvbnRhaW5lciBpZiB0aGVyZSB3YXMgYW4gZXJyb3JcbiAgICAgICAgaWYgKGRvY3VtZW50LmJvZHkuY29udGFpbnMoZGF0YXZpZXdDb250YWluZXIpKSB7XG4gICAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChkYXRhdmlld0NvbnRhaW5lcik7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGVsLmNyZWF0ZUVsKCdkaXYnLCB7XG4gICAgICAgICAgY2xzOiAnZGF0YWNhcmRzLWVycm9yJyxcbiAgICAgICAgICB0ZXh0OiBgRXJyb3IgZXhlY3V0aW5nIERhdGF2aWV3IHF1ZXJ5OiAke3F1ZXJ5RXJyb3IubWVzc2FnZSB8fCBTdHJpbmcocXVlcnlFcnJvcil9YFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgLy8gSGFuZGxlIGFueSBvdGhlciBlcnJvcnNcbiAgICAgIExvZ2dlci5lcnJvcignRGF0YUNhcmRzIGVycm9yOicsIGVycm9yKTtcbiAgICAgIGVsLmNyZWF0ZUVsKCdkaXYnLCB7XG4gICAgICAgIGNsczogJ2RhdGFjYXJkcy1lcnJvcicsXG4gICAgICAgIHRleHQ6IGBFcnJvciBwcm9jZXNzaW5nIERhdGFDYXJkcyBibG9jazogJHtlcnJvci5tZXNzYWdlIHx8IFN0cmluZyhlcnJvcil9YFxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFJlZnJlc2ggYWxsIGRhdGFjYXJkcyBibG9ja3MgaW4gdGhlIGN1cnJlbnQgdmlld1xuICAgKiBcbiAgICogQHBhcmFtIHNob3dOb3RpZmljYXRpb24gV2hldGhlciB0byBzaG93IGEgbm90aWZpY2F0aW9uIGFmdGVyIHJlZnJlc2hpbmdcbiAgICovXG4gIHByaXZhdGUgcmVmcmVzaEFsbERhdGFDYXJkcyhzaG93Tm90aWZpY2F0aW9uOiBib29sZWFuID0gdHJ1ZSkge1xuICAgIC8vIFByZXZlbnQgbXVsdGlwbGUgcmVmcmVzaGVzIGZyb20gaGFwcGVuaW5nIGF0IHRoZSBzYW1lIHRpbWVcbiAgICBpZiAodGhpcy5pc1JlZnJlc2hpbmcpIHJldHVybjtcbiAgICBcbiAgICB0aGlzLmlzUmVmcmVzaGluZyA9IHRydWU7XG4gICAgXG4gICAgY29uc3QgYWN0aXZlVmlldyA9IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRBY3RpdmVWaWV3T2ZUeXBlKE1hcmtkb3duVmlldyk7XG4gICAgaWYgKGFjdGl2ZVZpZXcpIHtcbiAgICAgIC8vIFRoaXMgdHJpZ2dlcnMgYSByZS1yZW5kZXIgb2YgdGhlIHZpZXcsIHdoaWNoIHdpbGwgcmUtcHJvY2VzcyBhbGwgY29kZSBibG9ja3NcbiAgICAgIGFjdGl2ZVZpZXcucHJldmlld01vZGUucmVyZW5kZXIodHJ1ZSk7XG4gICAgICBcbiAgICAgIC8vIFNob3cgYSBub3RpZmljYXRpb24gdG8gY29uZmlybSB0aGUgcmVmcmVzaCBpZiByZXF1ZXN0ZWRcbiAgICAgIGlmIChzaG93Tm90aWZpY2F0aW9uKSB7XG4gICAgICAgIG5ldyBOb3RpY2UoJ0RhdGFDYXJkcyByZWZyZXNoZWQnLCAyMDAwKTsgLy8gU2hvdyBmb3IgMiBzZWNvbmRzXG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIFJlc3RvcmUgZm9jdXMgdG8gdGhlIHByZXZpb3VzbHkgYWN0aXZlIGVsZW1lbnQgaWYgaXQgZXhpc3RzXG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgaWYgKHRoaXMubGFzdEFjdGl2ZUVsZW1lbnQgJiYgZG9jdW1lbnQuYm9keS5jb250YWlucyh0aGlzLmxhc3RBY3RpdmVFbGVtZW50KSkge1xuICAgICAgICAgIC8vIFRyeSB0byByZXN0b3JlIGZvY3VzXG4gICAgICAgICAgKHRoaXMubGFzdEFjdGl2ZUVsZW1lbnQgYXMgSFRNTEVsZW1lbnQpLmZvY3VzKCk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC8vIFJlc2V0IHRoZSByZWZyZXNoaW5nIGZsYWdcbiAgICAgICAgdGhpcy5pc1JlZnJlc2hpbmcgPSBmYWxzZTtcbiAgICAgIH0sIDUwKTsgLy8gU21hbGwgZGVsYXkgdG8gYWxsb3cgdGhlIERPTSB0byB1cGRhdGVcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKHNob3dOb3RpZmljYXRpb24pIHtcbiAgICAgICAgbmV3IE5vdGljZSgnTm8gYWN0aXZlIG1hcmtkb3duIHZpZXcgdG8gcmVmcmVzaCcsIDIwMDApO1xuICAgICAgfVxuICAgICAgdGhpcy5pc1JlZnJlc2hpbmcgPSBmYWxzZTtcbiAgICB9XG4gIH1cbn1cbiIsICIvKipcbiAqIFNldHRpbmdzIGludGVyZmFjZXMgZm9yIHRoZSBEYXRhQ2FyZHMgcGx1Z2luXG4gKi9cblxuLyoqXG4gKiBQcmVzZXQgb3B0aW9ucyBmb3IgY2FyZCBkaXNwbGF5XG4gKi9cbmV4cG9ydCB0eXBlIENhcmRQcmVzZXQgPSAnZ3JpZCcgfCAncG9ydHJhaXQnIHwgJ3NxdWFyZScgfCAnY29tcGFjdCcgfCAnZGVuc2UnO1xuXG4vKipcbiAqIEZvbnQgc2l6ZSBvcHRpb25zXG4gKi9cbmV4cG9ydCB0eXBlIEZvbnRTaXplID0gJ2xhcmdlcicgfCAnbGFyZ2UnIHwgJ2RlZmF1bHQnIHwgJ3NtYWxsJyB8ICdzbWFsbGVyJztcblxuLyoqXG4gKiBJbWFnZSBmaXR0aW5nIG9wdGlvbnNcbiAqL1xuZXhwb3J0IHR5cGUgSW1hZ2VGaXQgPSAnY292ZXInIHwgJ2NvbnRhaW4nO1xuXG4vKipcbiAqIFByb3BlcnR5IGZvcm1hdHRlciB0eXBlc1xuICovXG5leHBvcnQgdHlwZSBQcm9wZXJ0eUZvcm1hdHRlclR5cGUgPSAndGV4dCcgfCAnc3RhcnMnIHwgJ2JhZGdlJyB8ICdwcm9ncmVzcycgfCAnZGF0ZScgfCAndGFncyc7XG5cbi8qKlxuICogUHJvcGVydHkgZm9ybWF0dGVyIGNvbmZpZ3VyYXRpb25cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBQcm9wZXJ0eUZvcm1hdHRlciB7XG4gIHR5cGU6IFByb3BlcnR5Rm9ybWF0dGVyVHlwZTtcbiAgb3B0aW9ucz86IFJlY29yZDxzdHJpbmcsIGFueT47XG59XG5cbi8qKlxuICogTWFpbiBzZXR0aW5ncyBpbnRlcmZhY2UgZm9yIHRoZSBEYXRhQ2FyZHMgcGx1Z2luXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgRGF0YUNhcmRzU2V0dGluZ3Mge1xuICAvLyBQcmVzZXQgc2V0dGluZ3NcbiAgcHJlc2V0OiBDYXJkUHJlc2V0O1xuICBcbiAgLy8gSW1hZ2Ugc2V0dGluZ3NcbiAgaW1hZ2VQcm9wZXJ0eTogc3RyaW5nO1xuICBpbWFnZUhlaWdodDogc3RyaW5nO1xuICBpbWFnZUZpdDogSW1hZ2VGaXQ7XG4gIFxuICAvLyBDb250ZW50IHNldHRpbmdzXG4gIHByb3BlcnRpZXM6IHN0cmluZ1tdIHwgJ2FsbCc7XG4gIGV4Y2x1ZGU6IHN0cmluZ1tdO1xuICBzY3JvbGxhYmxlUHJvcGVydGllczogYm9vbGVhbjsgLy8gRW5hYmxlIHNjcm9sbGluZyBmb3IgcHJvcGVydGllc1xuICBjb250ZW50SGVpZ2h0OiBzdHJpbmc7IC8vIEhlaWdodCBvZiB0aGUgc2Nyb2xsYWJsZSBjb250ZW50IGFyZWFcbiAgXG4gIC8vIERpc3BsYXkgc2V0dGluZ3NcbiAgc2hvd0xhYmVsczogYm9vbGVhbjtcbiAgY2FyZFNwYWNpbmc6IG51bWJlcjtcbiAgZW5hYmxlU2hhZG93czogYm9vbGVhbjtcbiAgcHJvcGVydGllc0FsaWduOiAnbGVmdCcgfCAnY2VudGVyJyB8ICdyaWdodCc7IC8vIEFsaWdubWVudCBmb3IgcHJvcGVydGllcyBhbmQgbGFiZWxzXG4gIHRpdGxlQWxpZ246ICdsZWZ0JyB8ICdjZW50ZXInIHwgJ3JpZ2h0JzsgLy8gQWxpZ25tZW50IGZvciB0aGUgdGl0bGUgKGZpbGVuYW1lKVxuICBmb250U2l6ZTogRm9udFNpemU7IC8vIEZvbnQgc2l6ZSBmb3IgYWxsIHRleHQgZWxlbWVudHNcbiAgXG4gIC8vIEZvcm1hdHRpbmcgc2V0dGluZ3NcbiAgZGVmYXVsdERhdGVGb3JtYXQ6IHN0cmluZztcbiAgcHJvcGVydHlGb3JtYXR0ZXJzOiB7XG4gICAgW3Byb3BlcnR5TmFtZTogc3RyaW5nXTogUHJvcGVydHlGb3JtYXR0ZXI7XG4gIH07XG4gIFxuICAvLyBNb2JpbGUgc2V0dGluZ3NcbiAgbW9iaWxlQ29sdW1uczogbnVtYmVyO1xuICBtb2JpbGVQcmVzZXQ6IENhcmRQcmVzZXQ7XG4gIG1vYmlsZUltYWdlSGVpZ2h0OiBzdHJpbmc7XG4gIG1vYmlsZVNjcm9sbGFibGVQcm9wZXJ0aWVzOiBib29sZWFuOyAvLyBFbmFibGUgc2Nyb2xsaW5nIGZvciBwcm9wZXJ0aWVzIG9uIG1vYmlsZVxuICBtb2JpbGVDb250ZW50SGVpZ2h0OiBzdHJpbmc7IC8vIEhlaWdodCBvZiB0aGUgc2Nyb2xsYWJsZSBjb250ZW50IGFyZWEgb24gbW9iaWxlXG4gIGZvcmNlTW9iaWxlTW9kZTogYm9vbGVhbjsgLy8gRm9yY2UgbW9iaWxlIG1vZGUgZm9yIHRlc3RpbmdcbiAgXG4gIC8vIFBlcmZvcm1hbmNlIHNldHRpbmdzXG4gIGVuYWJsZUxhenlMb2FkaW5nOiBib29sZWFuO1xuICBcbiAgLy8gVXBkYXRlIHNldHRpbmdzXG4gIGVuYWJsZUR5bmFtaWNVcGRhdGVzOiBib29sZWFuOyAvLyBFbmFibGUgYXV0b21hdGljIHVwZGF0ZXMgd2hlbiBwcm9wZXJ0aWVzIGNoYW5nZVxuICBcbiAgLy8gRGVidWcgc2V0dGluZ3NcbiAgZGVidWdNb2RlOiBib29sZWFuOyAvLyBFbmFibGUgZGVidWcgbG9nZ2luZ1xuICBcbiAgLy8gQ29sdW1uIGFsaWFzZXMgKGZvciBkaXNwbGF5IG5hbWVzKVxuICBjb2x1bW5BbGlhc2VzPzogQ29sdW1uQWxpYXNbXTsgLy8gTWFwcGluZyBvZiBvcmlnaW5hbCBwcm9wZXJ0eSBuYW1lcyB0byBkaXNwbGF5IG5hbWVzXG59XG5cbi8qKlxuICogRGVmYXVsdCBzZXR0aW5ncyBmb3IgdGhlIERhdGFDYXJkcyBwbHVnaW5cbiAqL1xuZXhwb3J0IGNvbnN0IERFRkFVTFRfU0VUVElOR1M6IERhdGFDYXJkc1NldHRpbmdzID0ge1xuICAvLyBQcmVzZXQgc2V0dGluZ3NcbiAgcHJlc2V0OiAnZ3JpZCcsXG4gIFxuICAvLyBJbWFnZSBzZXR0aW5nc1xuICBpbWFnZVByb3BlcnR5OiAnY292ZXInLFxuICBpbWFnZUhlaWdodDogJzIwMHB4JyxcbiAgaW1hZ2VGaXQ6ICdjb3ZlcicsXG4gIFxuICAvLyBDb250ZW50IHNldHRpbmdzXG4gIHByb3BlcnRpZXM6ICdhbGwnLFxuICBleGNsdWRlOiBbXSxcbiAgc2Nyb2xsYWJsZVByb3BlcnRpZXM6IGZhbHNlLCAvLyBEZWZhdWx0IHRvIG5vbi1zY3JvbGxhYmxlIGZvciBtb3N0IHByZXNldHNcbiAgY29udGVudEhlaWdodDogJzIwMHB4JywgLy8gRGVmYXVsdCBoZWlnaHQgZm9yIHNjcm9sbGFibGUgY29udGVudFxuICBcbiAgLy8gRGlzcGxheSBzZXR0aW5nc1xuICBzaG93TGFiZWxzOiB0cnVlLFxuICBjYXJkU3BhY2luZzogMTYsXG4gIGVuYWJsZVNoYWRvd3M6IHRydWUsXG4gIHByb3BlcnRpZXNBbGlnbjogJ2xlZnQnLCAvLyBEZWZhdWx0IHRvIGxlZnQgYWxpZ25tZW50XG4gIHRpdGxlQWxpZ246ICdsZWZ0JywgLy8gRGVmYXVsdCB0byBsZWZ0IGFsaWdubWVudFxuICBmb250U2l6ZTogJ2RlZmF1bHQnLCAvLyBEZWZhdWx0IGZvbnQgc2l6ZVxuICBcbiAgLy8gRm9ybWF0dGluZyBzZXR0aW5nc1xuICBkZWZhdWx0RGF0ZUZvcm1hdDogJ1lZWVktTU0tREQnLFxuICBwcm9wZXJ0eUZvcm1hdHRlcnM6IHt9LFxuICBcbiAgLy8gTW9iaWxlIHNldHRpbmdzXG4gIG1vYmlsZUNvbHVtbnM6IDEsXG4gIG1vYmlsZVByZXNldDogJ2dyaWQnLFxuICBtb2JpbGVJbWFnZUhlaWdodDogJzE1MHB4JyxcbiAgbW9iaWxlU2Nyb2xsYWJsZVByb3BlcnRpZXM6IHRydWUsIC8vIERlZmF1bHQgdG8gc2Nyb2xsYWJsZSBvbiBtb2JpbGVcbiAgbW9iaWxlQ29udGVudEhlaWdodDogJzE1MHB4JywgLy8gRGVmYXVsdCBoZWlnaHQgZm9yIG1vYmlsZSBzY3JvbGxhYmxlIGNvbnRlbnRcbiAgZm9yY2VNb2JpbGVNb2RlOiBmYWxzZSwgLy8gRGlzYWJsZWQgYnkgZGVmYXVsdFxuICBcbiAgLy8gUGVyZm9ybWFuY2Ugc2V0dGluZ3NcbiAgZW5hYmxlTGF6eUxvYWRpbmc6IGZhbHNlLFxuICBcbiAgLy8gVXBkYXRlIHNldHRpbmdzXG4gIGVuYWJsZUR5bmFtaWNVcGRhdGVzOiBmYWxzZSwgLy8gRGlzYWJsZWQgYnkgZGVmYXVsdCB0byBhdm9pZCBwZXJmb3JtYW5jZSBpc3N1ZXNcbiAgXG4gIC8vIERlYnVnIHNldHRpbmdzXG4gIGRlYnVnTW9kZTogZmFsc2UgLy8gRGlzYWJsZWQgYnkgZGVmYXVsdFxufTtcblxuLyoqXG4gKiBDb2x1bW4gYWxpYXMgbWFwcGluZ1xuICovXG5leHBvcnQgaW50ZXJmYWNlIENvbHVtbkFsaWFzIHtcbiAgb3JpZ2luYWw6IHN0cmluZzsgIC8vIE9yaWdpbmFsIHByb3BlcnR5IG5hbWVcbiAgYWxpYXM6IHN0cmluZzsgICAgIC8vIERpc3BsYXkgbmFtZSAoYWxpYXMpXG4gIGV4cHJlc3Npb246IHN0cmluZzsgLy8gT3JpZ2luYWwgZXhwcmVzc2lvbiAoaWYgY29tcGxleClcbn1cblxuLyoqXG4gKiBTZXR0aW5ncyBmb3IgYSBzcGVjaWZpYyBkYXRhY2FyZHMgY29kZSBibG9ja1xuICogVGhpcyBjYW4gb3ZlcnJpZGUgdGhlIGdsb2JhbCBzZXR0aW5nc1xuICovXG5leHBvcnQgaW50ZXJmYWNlIEJsb2NrU2V0dGluZ3MgZXh0ZW5kcyBQYXJ0aWFsPERhdGFDYXJkc1NldHRpbmdzPiB7XG4gIC8vIEJsb2NrLXNwZWNpZmljIHNldHRpbmdzXG4gIGNvbHVtbnM/OiBudW1iZXI7IC8vIEFsbG93IGNvbHVtbnMgdG8gYmUgc2V0IGluIGNvZGUgYmxvY2tzXG4gIGNvbHVtbkFsaWFzZXM/OiBDb2x1bW5BbGlhc1tdOyAvLyBNYXBwaW5nIG9mIG9yaWdpbmFsIHByb3BlcnR5IG5hbWVzIHRvIGRpc3BsYXkgbmFtZXNcbiAgZHluYW1pY1VwZGF0ZT86IGJvb2xlYW47IC8vIEVuYWJsZS9kaXNhYmxlIGR5bmFtaWMgdXBkYXRlcyBmb3IgdGhpcyBzcGVjaWZpYyBibG9ja1xufVxuIiwgImltcG9ydCB7IEFwcCwgUGx1Z2luU2V0dGluZ1RhYiwgU2V0dGluZyB9IGZyb20gJ29ic2lkaWFuJztcbmltcG9ydCB7IERhdGFDYXJkc1NldHRpbmdzIH0gZnJvbSAnLi4vbW9kZWxzL3NldHRpbmdzJztcbmltcG9ydCBEYXRhQ2FyZHNQbHVnaW4gZnJvbSAnLi4vbWFpbic7XG5cbi8qKlxuICogU2V0dGluZ3MgdGFiIGZvciB0aGUgRGF0YUNhcmRzIHBsdWdpblxuICovXG5leHBvcnQgY2xhc3MgRGF0YUNhcmRzU2V0dGluZ1RhYiBleHRlbmRzIFBsdWdpblNldHRpbmdUYWIge1xuICBwbHVnaW46IERhdGFDYXJkc1BsdWdpbjtcblxuICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgcGx1Z2luOiBEYXRhQ2FyZHNQbHVnaW4pIHtcbiAgICBzdXBlcihhcHAsIHBsdWdpbik7XG4gICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47XG4gIH1cblxuICBkaXNwbGF5KCk6IHZvaWQge1xuICAgIGNvbnN0IHsgY29udGFpbmVyRWwgfSA9IHRoaXM7XG4gICAgY29udGFpbmVyRWwuZW1wdHkoKTtcblxuICAgIGNvbnRhaW5lckVsLmNyZWF0ZUVsKCdoMicsIHsgdGV4dDogJ0RhdGFDYXJkcyBTZXR0aW5ncycgfSk7XG5cbiAgICAvLyBQcmVzZXQgc2V0dGluZ3NcbiAgICBjb250YWluZXJFbC5jcmVhdGVFbCgnaDMnLCB7IHRleHQ6ICdQcmVzZXQgU2V0dGluZ3MnIH0pO1xuXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAuc2V0TmFtZSgnRGVmYXVsdCBQcmVzZXQnKVxuICAgICAgLnNldERlc2MoJ0Nob29zZSB0aGUgZGVmYXVsdCBwcmVzZXQgZm9yIGNhcmRzJylcbiAgICAgIC5hZGREcm9wZG93bihkcm9wZG93biA9PiBkcm9wZG93blxuICAgICAgICAuYWRkT3B0aW9uKCdncmlkJywgJ0dyaWQgKGJhbGFuY2VkLCAzIGNvbHVtbnMpJylcbiAgICAgICAgLmFkZE9wdGlvbigncG9ydHJhaXQnLCAnUG9ydHJhaXQgKG9wdGltaXplZCBmb3IgYm9vayBjb3ZlcnMsIDMgY29sdW1ucyknKVxuICAgICAgICAuYWRkT3B0aW9uKCdzcXVhcmUnLCAnU3F1YXJlICgxOjEgY2FyZHMgd2l0aCBtaW5pbWFsIHRleHQsIDQgY29sdW1ucyknKVxuICAgICAgICAuYWRkT3B0aW9uKCdjb21wYWN0JywgJ0NvbXBhY3QgKHNpZGUtYnktc2lkZSBsYXlvdXQsIDQgY29sdW1ucyknKVxuICAgICAgICAuYWRkT3B0aW9uKCdkZW5zZScsICdEZW5zZSAobWF4aW11bSBkZW5zaXR5LCA2IGNvbHVtbnMpJylcbiAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLnByZXNldClcbiAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZTogc3RyaW5nKSA9PiB7XG4gICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MucHJlc2V0ID0gdmFsdWUgYXMgYW55O1xuICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICB9KSk7XG5cbiAgICAvLyBIaWRkZW4gc2V0dGluZyBmb3IgY29sdW1ucyAtIHdlIGtlZXAgaXQgaW4gdGhlIGNvZGUgYnV0IGRvbid0IHNob3cgaW4gVUlcbiAgICAvLyBhcyBwcmVzZXRzIG5vdyBkZWZpbmUgcmVjb21tZW5kZWQgY29sdW1uIGNvdW50c1xuXG4gICAgLy8gSW1hZ2Ugc2V0dGluZ3NcbiAgICBjb250YWluZXJFbC5jcmVhdGVFbCgnaDMnLCB7IHRleHQ6ICdJbWFnZSBTZXR0aW5ncycgfSk7XG5cbiAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgIC5zZXROYW1lKCdEZWZhdWx0IEltYWdlIFByb3BlcnR5JylcbiAgICAgIC5zZXREZXNjKCdUaGUgZnJvbnRtYXR0ZXIgcHJvcGVydHkgdG8gdXNlIGZvciBpbWFnZXMnKVxuICAgICAgLmFkZFRleHQodGV4dCA9PiB0ZXh0XG4gICAgICAgIC5zZXRQbGFjZWhvbGRlcignY292ZXInKVxuICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuaW1hZ2VQcm9wZXJ0eSlcbiAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmltYWdlUHJvcGVydHkgPSB2YWx1ZTtcbiAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgfSkpO1xuXG4gICAgLy8gSW1hZ2UgaGVpZ2h0IGFuZCBmaXQgYXJlIG5vdyBjb250cm9sbGVkIGJ5IHByZXNldHNcbiAgICAvLyBUaGVzZSBzZXR0aW5ncyBoYXZlIGJlZW4gcmVtb3ZlZCBmcm9tIHRoZSBVSSB0byBhdm9pZCBjb25mdXNpb25cbiAgICAvLyBVc2VycyBjYW4gc3RpbGwgb3ZlcnJpZGUgdGhlbSBpbiBpbmRpdmlkdWFsIGNvZGUgYmxvY2tzXG5cbiAgICAvLyBEaXNwbGF5IHNldHRpbmdzXG4gICAgY29udGFpbmVyRWwuY3JlYXRlRWwoJ2gzJywgeyB0ZXh0OiAnRGlzcGxheSBTZXR0aW5ncycgfSk7XG5cbiAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgIC5zZXROYW1lKCdTaG93IFByb3BlcnR5IExhYmVscycpXG4gICAgICAuc2V0RGVzYygnU2hvdyBsYWJlbHMgZm9yIHByb3BlcnRpZXMnKVxuICAgICAgLmFkZFRvZ2dsZSh0b2dnbGUgPT4gdG9nZ2xlXG4gICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5zaG93TGFiZWxzKVxuICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3Muc2hvd0xhYmVscyA9IHZhbHVlO1xuICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICB9KSk7XG5cbiAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgIC5zZXROYW1lKCdDYXJkIFNwYWNpbmcnKVxuICAgICAgLnNldERlc2MoJ1NwYWNlIGJldHdlZW4gY2FyZHMgKGluIHBpeGVscyknKVxuICAgICAgLmFkZFNsaWRlcihzbGlkZXIgPT4gc2xpZGVyXG4gICAgICAgIC5zZXRMaW1pdHMoMCwgMzIsIDQpXG4gICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5jYXJkU3BhY2luZylcbiAgICAgICAgLnNldER5bmFtaWNUb29sdGlwKClcbiAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmNhcmRTcGFjaW5nID0gdmFsdWU7XG4gICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgIH0pKTtcbiAgICAgICAgXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAuc2V0TmFtZSgnRW5hYmxlIENhcmQgU2hhZG93cycpXG4gICAgICAuc2V0RGVzYygnQWRkIHN1YnRsZSBzaGFkb3dzIHRvIGNhcmRzIGZvciBhIG1vcmUgdGhyZWUtZGltZW5zaW9uYWwgYXBwZWFyYW5jZScpXG4gICAgICAuYWRkVG9nZ2xlKHRvZ2dsZSA9PiB0b2dnbGVcbiAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmVuYWJsZVNoYWRvd3MpXG4gICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5lbmFibGVTaGFkb3dzID0gdmFsdWU7XG4gICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgIH0pKTtcbiAgICAgICAgXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAuc2V0TmFtZSgnUHJvcGVydGllcyBBbGlnbm1lbnQnKVxuICAgICAgLnNldERlc2MoJ1RleHQgYWxpZ25tZW50IGZvciBwcm9wZXJ0aWVzIGFuZCB0aGVpciBsYWJlbHMnKVxuICAgICAgLmFkZERyb3Bkb3duKGRyb3Bkb3duID0+IGRyb3Bkb3duXG4gICAgICAgIC5hZGRPcHRpb24oJ2xlZnQnLCAnTGVmdCcpXG4gICAgICAgIC5hZGRPcHRpb24oJ2NlbnRlcicsICdDZW50ZXInKVxuICAgICAgICAuYWRkT3B0aW9uKCdyaWdodCcsICdSaWdodCcpXG4gICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5wcm9wZXJ0aWVzQWxpZ24pXG4gICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWU6IHN0cmluZykgPT4ge1xuICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnByb3BlcnRpZXNBbGlnbiA9IHZhbHVlIGFzIGFueTtcbiAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgfSkpO1xuXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAuc2V0TmFtZSgnVGl0bGUgQWxpZ25tZW50JylcbiAgICAgIC5zZXREZXNjKCdUZXh0IGFsaWdubWVudCBmb3IgdGhlIHRpdGxlIChmaWxlbmFtZSknKVxuICAgICAgLmFkZERyb3Bkb3duKGRyb3Bkb3duID0+IGRyb3Bkb3duXG4gICAgICAgIC5hZGRPcHRpb24oJ2xlZnQnLCAnTGVmdCcpXG4gICAgICAgIC5hZGRPcHRpb24oJ2NlbnRlcicsICdDZW50ZXInKVxuICAgICAgICAuYWRkT3B0aW9uKCdyaWdodCcsICdSaWdodCcpXG4gICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy50aXRsZUFsaWduKVxuICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlOiBzdHJpbmcpID0+IHtcbiAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy50aXRsZUFsaWduID0gdmFsdWUgYXMgYW55O1xuICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICB9KSk7XG4gICAgICAgIFxuICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgLnNldE5hbWUoJ0ZvbnQgU2l6ZScpXG4gICAgICAuc2V0RGVzYygnVGV4dCBzaXplIGZvciBhbGwgY2FyZCBlbGVtZW50cyAocHJvcGVydGllcywgbGFiZWxzLCBhbmQgdGl0bGUpJylcbiAgICAgIC5hZGREcm9wZG93bihkcm9wZG93biA9PiBkcm9wZG93blxuICAgICAgICAuYWRkT3B0aW9uKCdsYXJnZXInLCAnTGFyZ2VyICgxMjAlKScpXG4gICAgICAgIC5hZGRPcHRpb24oJ2xhcmdlJywgJ0xhcmdlICgxMTAlKScpXG4gICAgICAgIC5hZGRPcHRpb24oJ2RlZmF1bHQnLCAnRGVmYXVsdCAoMTAwJSknKVxuICAgICAgICAuYWRkT3B0aW9uKCdzbWFsbCcsICdTbWFsbCAoOTAlIC0gc2ltaWxhciB0byBkZW5zZSBwcmVzZXQpJylcbiAgICAgICAgLmFkZE9wdGlvbignc21hbGxlcicsICdTbWFsbGVyICg4MCUpJylcbiAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmZvbnRTaXplKVxuICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlOiBzdHJpbmcpID0+IHtcbiAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5mb250U2l6ZSA9IHZhbHVlIGFzIGFueTtcbiAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgfSkpO1xuICAgIFxuICAgIC8vIENhcmQgQ29udGVudCBTZXR0aW5nc1xuICAgIGNvbnRhaW5lckVsLmNyZWF0ZUVsKCdoMycsIHsgdGV4dDogJ0NhcmQgQ29udGVudCBTZXR0aW5ncycgfSk7XG4gICAgXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAuc2V0TmFtZSgnU2Nyb2xsYWJsZSBQcm9wZXJ0aWVzJylcbiAgICAgIC5zZXREZXNjKCdFbmFibGUgc2Nyb2xsaW5nIGZvciBjYXJkIHByb3BlcnRpZXMgd2hlbiB0aGV5IGV4Y2VlZCB0aGUgY29udGVudCBoZWlnaHQgKE5vdGU6IFNxdWFyZSBhbmQgQ29tcGFjdCBwcmVzZXRzIGFyZSBzY3JvbGxhYmxlIGJ5IGRlZmF1bHQpJylcbiAgICAgIC5hZGRUb2dnbGUodG9nZ2xlID0+IHRvZ2dsZVxuICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3Muc2Nyb2xsYWJsZVByb3BlcnRpZXMpXG4gICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5zY3JvbGxhYmxlUHJvcGVydGllcyA9IHZhbHVlO1xuICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICB9KSk7XG4gICAgXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAuc2V0TmFtZSgnQ29udGVudCBIZWlnaHQnKVxuICAgICAgLnNldERlc2MoJ0hlaWdodCBvZiB0aGUgc2Nyb2xsYWJsZSBjb250ZW50IGFyZWEgKGUuZy4sIDIwMHB4KScpXG4gICAgICAuYWRkVGV4dCh0ZXh0ID0+IHRleHRcbiAgICAgICAgLnNldFBsYWNlaG9sZGVyKCcyMDBweCcpXG4gICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5jb250ZW50SGVpZ2h0KVxuICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuY29udGVudEhlaWdodCA9IHZhbHVlIHx8ICcyMDBweCc7XG4gICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgIH0pKTtcbiAgICAgICAgXG4gICAgLy8gRm9ybWF0dGluZyBzZXR0aW5nc1xuICAgIGNvbnRhaW5lckVsLmNyZWF0ZUVsKCdoMycsIHsgdGV4dDogJ0Zvcm1hdHRpbmcgU2V0dGluZ3MnIH0pO1xuICAgIFxuICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgLnNldE5hbWUoJ0RlZmF1bHQgRGF0ZSBGb3JtYXQnKVxuICAgICAgLnNldERlc2MoJ0Zvcm1hdCBmb3IgZGlzcGxheWluZyBkYXRlcyAoWVlZWSA9IHllYXIsIE1NID0gbW9udGgsIEREID0gZGF5KScpXG4gICAgICAuYWRkVGV4dCh0ZXh0ID0+IHRleHRcbiAgICAgICAgLnNldFBsYWNlaG9sZGVyKCdZWVlZLU1NLUREJylcbiAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmRlZmF1bHREYXRlRm9ybWF0KVxuICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuZGVmYXVsdERhdGVGb3JtYXQgPSB2YWx1ZSB8fCAnWVlZWS1NTS1ERCc7XG4gICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgIH0pKTtcbiAgICBcbiAgICAvLyBNb2JpbGUgc2V0dGluZ3NcbiAgICBjb250YWluZXJFbC5jcmVhdGVFbCgnaDMnLCB7IHRleHQ6ICdNb2JpbGUgU2V0dGluZ3MnIH0pO1xuICAgIFxuICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgLnNldE5hbWUoJ01vYmlsZSBQcmVzZXQnKVxuICAgICAgLnNldERlc2MoJ1ByZXNldCB0byB1c2Ugb24gbW9iaWxlIGRldmljZXMgKGFsbCBwcmVzZXRzIGRlZmF1bHQgdG8gMSBjb2x1bW4gb24gbW9iaWxlKScpXG4gICAgICAuYWRkRHJvcGRvd24oZHJvcGRvd24gPT4gZHJvcGRvd25cbiAgICAgICAgLmFkZE9wdGlvbignZ3JpZCcsICdHcmlkIChiYWxhbmNlZCknKVxuICAgICAgICAuYWRkT3B0aW9uKCdwb3J0cmFpdCcsICdQb3J0cmFpdCAob3B0aW1pemVkIGZvciBib29rIGNvdmVycyknKVxuICAgICAgICAuYWRkT3B0aW9uKCdzcXVhcmUnLCAnU3F1YXJlICgxOjEgY2FyZHMgd2l0aCBtaW5pbWFsIHRleHQpJylcbiAgICAgICAgLmFkZE9wdGlvbignY29tcGFjdCcsICdDb21wYWN0IChzaWRlLWJ5LXNpZGUgbGF5b3V0KScpXG4gICAgICAgIC5hZGRPcHRpb24oJ2RlbnNlJywgJ0RlbnNlIChtYXhpbXVtIGRlbnNpdHkpJylcbiAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLm1vYmlsZVByZXNldClcbiAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZTogc3RyaW5nKSA9PiB7XG4gICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MubW9iaWxlUHJlc2V0ID0gdmFsdWUgYXMgYW55O1xuICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICB9KSk7XG4gICAgXG4gICAgLy8gTW9iaWxlIGNvbHVtbnMgYW5kIGltYWdlIGhlaWdodCBhcmUgbm93IGNvbnRyb2xsZWQgYnkgcHJlc2V0c1xuICAgIC8vIFRoZXNlIHNldHRpbmdzIGhhdmUgYmVlbiByZW1vdmVkIGZyb20gdGhlIFVJIHRvIGF2b2lkIGNvbmZ1c2lvblxuICAgIC8vIEFsbCBwcmVzZXRzIGRlZmF1bHQgdG8gMSBjb2x1bW4gb24gbW9iaWxlIGZvciBvcHRpbWFsIHJlYWRhYmlsaXR5XG4gICAgXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAuc2V0TmFtZSgnTW9iaWxlIFNjcm9sbGFibGUgUHJvcGVydGllcycpXG4gICAgICAuc2V0RGVzYygnRW5hYmxlIHNjcm9sbGluZyBmb3IgY2FyZCBwcm9wZXJ0aWVzIG9uIG1vYmlsZSBkZXZpY2VzJylcbiAgICAgIC5hZGRUb2dnbGUodG9nZ2xlID0+IHRvZ2dsZVxuICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MubW9iaWxlU2Nyb2xsYWJsZVByb3BlcnRpZXMpXG4gICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5tb2JpbGVTY3JvbGxhYmxlUHJvcGVydGllcyA9IHZhbHVlO1xuICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICB9KSk7XG4gICAgXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAuc2V0TmFtZSgnTW9iaWxlIENvbnRlbnQgSGVpZ2h0JylcbiAgICAgIC5zZXREZXNjKCdIZWlnaHQgb2YgdGhlIHNjcm9sbGFibGUgY29udGVudCBhcmVhIG9uIG1vYmlsZSBkZXZpY2VzJylcbiAgICAgIC5hZGRUZXh0KHRleHQgPT4gdGV4dFxuICAgICAgICAuc2V0UGxhY2Vob2xkZXIoJzE1MHB4JylcbiAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLm1vYmlsZUNvbnRlbnRIZWlnaHQpXG4gICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5tb2JpbGVDb250ZW50SGVpZ2h0ID0gdmFsdWUgfHwgJzE1MHB4JztcbiAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgfSkpO1xuICAgIFxuICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgLnNldE5hbWUoJ0ZvcmNlIE1vYmlsZSBNb2RlJylcbiAgICAgIC5zZXREZXNjKCdGb3JjZSB0aGUgcGx1Z2luIHRvIHVzZSBtb2JpbGUgc2V0dGluZ3MgZXZlbiBvbiBkZXNrdG9wIChmb3IgdGVzdGluZyknKVxuICAgICAgLmFkZFRvZ2dsZSh0b2dnbGUgPT4gdG9nZ2xlXG4gICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5mb3JjZU1vYmlsZU1vZGUpXG4gICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5mb3JjZU1vYmlsZU1vZGUgPSB2YWx1ZTtcbiAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgfSkpO1xuICAgIFxuICAgIC8vIFBlcmZvcm1hbmNlIHNldHRpbmdzXG4gICAgY29udGFpbmVyRWwuY3JlYXRlRWwoJ2gzJywgeyB0ZXh0OiAnUGVyZm9ybWFuY2UgU2V0dGluZ3MnIH0pO1xuICAgIFxuICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgLnNldE5hbWUoJ0VuYWJsZSBMYXp5IExvYWRpbmcnKVxuICAgICAgLnNldERlc2MoJ09ubHkgbG9hZCBpbWFnZXMgd2hlbiB0aGV5IGJlY29tZSB2aXNpYmxlIChpbXByb3ZlcyBwZXJmb3JtYW5jZSB3aXRoIG1hbnkgY2FyZHMpJylcbiAgICAgIC5hZGRUb2dnbGUodG9nZ2xlID0+IHRvZ2dsZVxuICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuZW5hYmxlTGF6eUxvYWRpbmcpXG4gICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5lbmFibGVMYXp5TG9hZGluZyA9IHZhbHVlO1xuICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICB9KSk7XG4gICAgICAgIFxuICAgIC8vIFVwZGF0ZSBzZXR0aW5nc1xuICAgIGNvbnRhaW5lckVsLmNyZWF0ZUVsKCdoMycsIHsgdGV4dDogJ1VwZGF0ZSBTZXR0aW5ncycgfSk7XG4gICAgXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAuc2V0TmFtZSgnRW5hYmxlIER5bmFtaWMgVXBkYXRlcycpXG4gICAgICAuc2V0RGVzYygnQXV0b21hdGljYWxseSB1cGRhdGUgRGF0YUNhcmRzIHdoZW4gcHJvcGVydGllcyBjaGFuZ2UgKG1heSBpbXBhY3QgcGVyZm9ybWFuY2UpJylcbiAgICAgIC5hZGRUb2dnbGUodG9nZ2xlID0+IHRvZ2dsZVxuICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuZW5hYmxlRHluYW1pY1VwZGF0ZXMpXG4gICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5lbmFibGVEeW5hbWljVXBkYXRlcyA9IHZhbHVlO1xuICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICB9KSk7XG4gICAgICAgIFxuICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgLnNldE5hbWUoJ1Blci1DYXJkIER5bmFtaWMgVXBkYXRlcycpXG4gICAgICAuc2V0RGVzYygnSW5kaXZpZHVhbCBjYXJkcyBjYW4gb3ZlcnJpZGUgdGhlIGdsb2JhbCBzZXR0aW5nIHdpdGggXCJkeW5hbWljVXBkYXRlOiB0cnVlL2ZhbHNlXCIgaW4gdGhlaXIgc2V0dGluZ3MnKVxuICAgICAgLnNldERpc2FibGVkKHRydWUpO1xuICAgICAgICBcbiAgICAvLyBEZWJ1ZyBzZXR0aW5nc1xuICAgIGNvbnRhaW5lckVsLmNyZWF0ZUVsKCdoMycsIHsgdGV4dDogJ0RldmVsb3BlciBTZXR0aW5ncycgfSk7XG4gICAgXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAuc2V0TmFtZSgnRGVidWcgTW9kZScpXG4gICAgICAuc2V0RGVzYygnRW5hYmxlIGRlYnVnIGxvZ2dpbmcgKG9ubHkgdXNlIGR1cmluZyBkZXZlbG9wbWVudCBvciB0cm91Ymxlc2hvb3RpbmcpJylcbiAgICAgIC5hZGRUb2dnbGUodG9nZ2xlID0+IHRvZ2dsZVxuICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuZGVidWdNb2RlKVxuICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuZGVidWdNb2RlID0gdmFsdWU7XG4gICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgIH0pKTtcblxuICAgIC8vIEhlbHAgc2VjdGlvblxuICAgIGNvbnRhaW5lckVsLmNyZWF0ZUVsKCdoMycsIHsgdGV4dDogJ0hlbHAnIH0pO1xuICAgIFxuICAgIGNvbnN0IGhlbHBUZXh0ID0gY29udGFpbmVyRWwuY3JlYXRlRWwoJ2RpdicpO1xuICAgIGhlbHBUZXh0LmlubmVySFRNTCA9IGBcbiAgICAgIDxwPjxzdHJvbmc+QmFzaWMgVXNhZ2U6PC9zdHJvbmc+PGJyPlxuICAgICAgVXNlIHRoZSA8Y29kZT5kYXRhY2FyZHM8L2NvZGU+IGNvZGUgYmxvY2sgdG8gY3JlYXRlIGNhcmQgbGF5b3V0cyBmcm9tIERhdGF2aWV3IHF1ZXJpZXMuPC9wPlxuICAgICAgXG4gICAgICA8cD48c3Ryb25nPkV4YW1wbGU6PC9zdHJvbmc+PC9wPlxuICAgICAgPHByZT48Y29kZT5cblxcYFxcYFxcYGRhdGFjYXJkc1xuVEFCTEUgdGl0bGUsIGF1dGhvciwgcmF0aW5nLCBjb3ZlciBGUk9NICNib29rc1xuU09SVCByYXRpbmcgREVTQ1xuXG4vLyBTZXR0aW5nc1xucHJlc2V0OiBncmlkXG5pbWFnZUZpdDogY29udGFpblxuZGVmYXVsdERhdGVGb3JtYXQ6IFlZWVlcblxcYFxcYFxcYFxuICAgICAgPC9jb2RlPjwvcHJlPlxuICAgICAgXG4gICAgICA8cD48c3Ryb25nPkltcG9ydGFudDo8L3N0cm9uZz4gWW91IG11c3QgZXhwbGljaXRseSBpbmNsdWRlIGFsbCBwcm9wZXJ0aWVzIHlvdSB3YW50IHRvIGRpc3BsYXkgaW4geW91ciBEYXRhdmlldyBxdWVyeSAoaW5jbHVkaW5nIHRoZSBpbWFnZSBwcm9wZXJ0eSkuPC9wPlxuICAgICAgXG4gICAgICA8cD48c3Ryb25nPkltYWdlIFN1cHBvcnQ6PC9zdHJvbmc+PGJyPlxuICAgICAgVGhlIHBsdWdpbiBzdXBwb3J0cyBleHRlcm5hbCBVUkxzLCB2YXVsdCBpbWFnZXMsIGFuZCB3aWtpIGxpbmtzOjxicj5cbiAgICAgIDxjb2RlPmNvdmVyOiBodHRwczovL2V4YW1wbGUuY29tL2ltYWdlLmpwZzwvY29kZT4gb3IgPGNvZGU+Y292ZXI6IFtbcGF0aC90by9pbWFnZS5qcGddXTwvY29kZT48L3A+ICAgICBcbiAgICBcbiAgICAgIDxwPjxzdHJvbmc+VGlwOjwvc3Ryb25nPiBEYXRhIENhcmRzIHdvcmtzIGJlc3Qgd2l0aCB0aGUgRWRpdG9yLVNldHRpbmcgXCJSZWFkYWJsZSBsaW5lIGxlbmd0aFwiIGRpc2FibGVkLiA8L3A+PGJyPlxuICAgICAgXG4gICAgICA8cD48YSBocmVmPVwiaHR0cHM6Ly9naXRodWIuY29tL1NvcGhva2xlczE4Ny9kYXRhLWNhcmRzXCIgdGFyZ2V0PVwiX2JsYW5rXCIgcmVsPVwibm9vcGVuZXJcIj5WaWV3IGNvbXBsZXRlIGRvY3VtZW50YXRpb24gYW5kIGV4YW1wbGVzIG9uIEdpdEh1YjwvYT48L3A+XG4gICAgYDtcbiAgfVxufVxuIiwgIi8qXG4gKiBEYXRhQ2FyZHMgZm9yIE9ic2lkaWFuXG4gKiBDb3B5cmlnaHQgKEMpIDIwMjUgU29waG9rbGVzMTg3XG4gKiBcbiAqIFRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5XG4gKiBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxuICogdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3JcbiAqIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG4gKiBcbiAqIFRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLFxuICogYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2ZcbiAqIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGVcbiAqIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuXG4gKiBcbiAqIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlXG4gKiBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS4gIElmIG5vdCwgc2VlIDxodHRwczovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uXG4gKi9cblxuLyoqXG4gKiBMb2dnZXIgdXRpbGl0eSBmb3IgRGF0YUNhcmRzIHBsdWdpblxuICogUHJvdmlkZXMgY29uc2lzdGVudCBsb2dnaW5nIHdpdGggZGlmZmVyZW50IGxldmVsc1xuICogT25seSBlcnJvciBsb2dzIGFyZSBzaG93biBieSBkZWZhdWx0IGluIHByb2R1Y3Rpb25cbiAqL1xuZXhwb3J0IGNsYXNzIExvZ2dlciB7XG4gIHByaXZhdGUgc3RhdGljIGRlYnVnTW9kZSA9IGZhbHNlO1xuICBcbiAgLyoqXG4gICAqIEVuYWJsZSBvciBkaXNhYmxlIGRlYnVnIG1vZGVcbiAgICogV2hlbiBkaXNhYmxlZCwgZGVidWcgbG9ncyB3b24ndCBiZSBzaG93blxuICAgKiBcbiAgICogQHBhcmFtIGVuYWJsZWQgV2hldGhlciBkZWJ1ZyBtb2RlIHNob3VsZCBiZSBlbmFibGVkXG4gICAqL1xuICBzdGF0aWMgc2V0RGVidWdNb2RlKGVuYWJsZWQ6IGJvb2xlYW4pOiB2b2lkIHtcbiAgICB0aGlzLmRlYnVnTW9kZSA9IGVuYWJsZWQ7XG4gIH1cbiAgXG4gIC8qKlxuICAgKiBMb2cgYW4gZXJyb3IgbWVzc2FnZVxuICAgKiBUaGVzZSBhcmUgYWx3YXlzIHNob3duIHJlZ2FyZGxlc3Mgb2YgZGVidWcgbW9kZVxuICAgKiBcbiAgICogQHBhcmFtIG1lc3NhZ2UgVGhlIGVycm9yIG1lc3NhZ2VcbiAgICogQHBhcmFtIGFyZ3MgQWRkaXRpb25hbCBhcmd1bWVudHMgdG8gbG9nXG4gICAqL1xuICBzdGF0aWMgZXJyb3IobWVzc2FnZTogc3RyaW5nLCAuLi5hcmdzOiBhbnlbXSk6IHZvaWQge1xuICAgIGNvbnNvbGUuZXJyb3IoYFtEYXRhQ2FyZHNdICR7bWVzc2FnZX1gLCAuLi5hcmdzKTtcbiAgfVxuICBcbiAgLyoqXG4gICAqIExvZyBhIHdhcm5pbmcgbWVzc2FnZVxuICAgKiBUaGVzZSBhcmUgYWx3YXlzIHNob3duIHJlZ2FyZGxlc3Mgb2YgZGVidWcgbW9kZVxuICAgKiBcbiAgICogQHBhcmFtIG1lc3NhZ2UgVGhlIHdhcm5pbmcgbWVzc2FnZVxuICAgKiBAcGFyYW0gYXJncyBBZGRpdGlvbmFsIGFyZ3VtZW50cyB0byBsb2dcbiAgICovXG4gIHN0YXRpYyB3YXJuKG1lc3NhZ2U6IHN0cmluZywgLi4uYXJnczogYW55W10pOiB2b2lkIHtcbiAgICBjb25zb2xlLndhcm4oYFtEYXRhQ2FyZHNdICR7bWVzc2FnZX1gLCAuLi5hcmdzKTtcbiAgfVxuICBcbiAgLyoqXG4gICAqIExvZyBhIGRlYnVnIG1lc3NhZ2VcbiAgICogVGhlc2UgYXJlIG9ubHkgc2hvd24gd2hlbiBkZWJ1ZyBtb2RlIGlzIGVuYWJsZWRcbiAgICogXG4gICAqIEBwYXJhbSBtZXNzYWdlIFRoZSBkZWJ1ZyBtZXNzYWdlXG4gICAqIEBwYXJhbSBhcmdzIEFkZGl0aW9uYWwgYXJndW1lbnRzIHRvIGxvZ1xuICAgKi9cbiAgc3RhdGljIGRlYnVnKG1lc3NhZ2U6IHN0cmluZywgLi4uYXJnczogYW55W10pOiB2b2lkIHtcbiAgICBpZiAodGhpcy5kZWJ1Z01vZGUpIHtcbiAgICAgIGNvbnNvbGUubG9nKGBbRGF0YUNhcmRzXSAke21lc3NhZ2V9YCwgLi4uYXJncyk7XG4gICAgfVxuICB9XG59XG4iLCAiaW1wb3J0IHsgQmxvY2tTZXR0aW5ncywgQ29sdW1uQWxpYXMgfSBmcm9tICcuLi9tb2RlbHMvc2V0dGluZ3MnO1xuaW1wb3J0IHsgTG9nZ2VyIH0gZnJvbSAnLi4vdXRpbHMvbG9nZ2VyJztcblxuLy8gVHlwZSBmb3IgZHluYW1pYyBwcm9wZXJ0eSBhY2Nlc3NcbmludGVyZmFjZSBEeW5hbWljQmxvY2tTZXR0aW5ncyBleHRlbmRzIEJsb2NrU2V0dGluZ3Mge1xuICBba2V5OiBzdHJpbmddOiBhbnk7XG59XG5cbi8qKlxuICogUmVzdWx0IG9mIHBhcnNpbmcgYSBkYXRhY2FyZHMgY29kZSBibG9ja1xuICovXG5leHBvcnQgaW50ZXJmYWNlIFBhcnNlUmVzdWx0IHtcbiAgcXVlcnk6IHN0cmluZztcbiAgc2V0dGluZ3M6IEJsb2NrU2V0dGluZ3M7XG59XG5cbi8qKlxuICogU2VydmljZSBmb3IgcGFyc2luZyBkYXRhY2FyZHMgY29kZSBibG9ja3NcbiAqL1xuZXhwb3J0IGNsYXNzIFBhcnNlclNlcnZpY2Uge1xuICAvKipcbiAgICogUGFyc2UgYSBkYXRhY2FyZHMgY29kZSBibG9jayBjb250ZW50XG4gICAqIFNlcGFyYXRlcyB0aGUgcXVlcnkgZnJvbSB0aGUgc2V0dGluZ3Mgc2VjdGlvblxuICAgKiBcbiAgICogQHBhcmFtIHNvdXJjZSBUaGUgY29udGVudCBvZiB0aGUgZGF0YWNhcmRzIGNvZGUgYmxvY2tcbiAgICogQHJldHVybnMgQW4gb2JqZWN0IGNvbnRhaW5pbmcgdGhlIHF1ZXJ5IGFuZCBzZXR0aW5nc1xuICAgKi9cbiAgcHVibGljIHBhcnNlRGF0YUNhcmRzQmxvY2soc291cmNlOiBzdHJpbmcpOiBQYXJzZVJlc3VsdCB7XG4gICAgTG9nZ2VyLmRlYnVnKCdQYXJzaW5nIGRhdGFjYXJkcyBibG9jaycpO1xuICAgIFxuICAgIC8vIExvb2sgZm9yIHRoZSBzZXBhcmF0b3IgbGluZSAodGhyZWUgb3IgbW9yZSBoeXBoZW5zIG9uIGEgbGluZSBieSBpdHNlbGYpXG4gICAgLy8gb3IgYSBsaW5lIHN0YXJ0aW5nIHdpdGggXCIvLyBTZXR0aW5nc1wiIG9yIFwiLyogU2V0dGluZ3MgKi9cIlxuICAgIGNvbnN0IHNlcGFyYXRvclJlZ2V4ID0gL1xcbi17Myx9XFxufFxcblxcL1xcL1xccypTZXR0aW5ncy4qfFxcblxcL1xcKlxccypTZXR0aW5nc1xccypcXCpcXC8uKi87XG4gICAgY29uc3Qgc2VwYXJhdG9yTWF0Y2ggPSBzb3VyY2UubWF0Y2goc2VwYXJhdG9yUmVnZXgpO1xuICAgIFxuICAgIC8vIEFsc28gY2hlY2sgaWYgdGhlIGJsb2NrIHN0YXJ0cyB3aXRoIFwiLy8gU2V0dGluZ3NcIiAobm8gbmV3bGluZSBiZWZvcmUgaXQpXG4gICAgY29uc3Qgc3RhcnRzV2l0aFNldHRpbmdzUmVnZXggPSAvXlxcL1xcL1xccypTZXR0aW5ncy4qLztcbiAgICBjb25zdCBzdGFydHNXaXRoU2V0dGluZ3NNYXRjaCA9IHNvdXJjZS5tYXRjaChzdGFydHNXaXRoU2V0dGluZ3NSZWdleCk7XG4gICAgXG4gICAgbGV0IHF1ZXJ5OiBzdHJpbmc7XG4gICAgbGV0IHNldHRpbmdzVGV4dDogc3RyaW5nO1xuICAgIFxuICAgIGlmIChzZXBhcmF0b3JNYXRjaCAmJiBzZXBhcmF0b3JNYXRjaC5pbmRleCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAvLyBTcGxpdCBpbnRvIHF1ZXJ5IGFuZCBzZXR0aW5nc1xuICAgICAgTG9nZ2VyLmRlYnVnKCdGb3VuZCBzZXR0aW5ncyBzZXBhcmF0b3IgYXQgaW5kZXg6Jywgc2VwYXJhdG9yTWF0Y2guaW5kZXgpO1xuICAgICAgcXVlcnkgPSBzb3VyY2Uuc3Vic3RyaW5nKDAsIHNlcGFyYXRvck1hdGNoLmluZGV4KS50cmltKCk7XG4gICAgICBzZXR0aW5nc1RleHQgPSBzb3VyY2Uuc3Vic3RyaW5nKHNlcGFyYXRvck1hdGNoLmluZGV4ICsgc2VwYXJhdG9yTWF0Y2hbMF0ubGVuZ3RoKS50cmltKCk7XG4gICAgfSBlbHNlIGlmIChzdGFydHNXaXRoU2V0dGluZ3NNYXRjaCkge1xuICAgICAgLy8gVGhlIGJsb2NrIHN0YXJ0cyB3aXRoIFwiLy8gU2V0dGluZ3NcIlxuICAgICAgTG9nZ2VyLmRlYnVnKCdCbG9jayBzdGFydHMgd2l0aCBzZXR0aW5ncyBtYXJrZXInKTtcbiAgICAgIHF1ZXJ5ID0gJyc7IC8vIE5vIHF1ZXJ5IHBhcnRcbiAgICAgIHNldHRpbmdzVGV4dCA9IHNvdXJjZS5zdWJzdHJpbmcoc3RhcnRzV2l0aFNldHRpbmdzTWF0Y2hbMF0ubGVuZ3RoKS50cmltKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIE5vIHNlcGFyYXRvciBmb3VuZCwgdHJlYXQgZXZlcnl0aGluZyBhcyBxdWVyeVxuICAgICAgTG9nZ2VyLmRlYnVnKCdObyBzZXR0aW5ncyBzZXBhcmF0b3IgZm91bmQnKTtcbiAgICAgIHF1ZXJ5ID0gc291cmNlLnRyaW0oKTtcbiAgICAgIHNldHRpbmdzVGV4dCA9ICcnO1xuICAgIH1cbiAgICBcbiAgICBMb2dnZXIuZGVidWcoJ0V4dHJhY3RlZCBxdWVyeTonLCBxdWVyeSk7XG4gICAgXG4gICAgLy8gRW5zdXJlIHRoZSBxdWVyeSBoYXMgYSB0eXBlIChUQUJMRSwgTElTVCwgVEFTSywgQ0FMRU5EQVIpXG4gICAgcXVlcnkgPSB0aGlzLmVuc3VyZVF1ZXJ5VHlwZShxdWVyeSk7XG4gICAgXG4gICAgLy8gUGFyc2Ugc2V0dGluZ3MgKFlBTUwtbGlrZSBmb3JtYXQpXG4gICAgY29uc3Qgc2V0dGluZ3MgPSB0aGlzLnBhcnNlU2V0dGluZ3Moc2V0dGluZ3NUZXh0KTtcbiAgICBcbiAgICAvLyBFeHRyYWN0IGNvbHVtbiBhbGlhc2VzIGZyb20gdGhlIHF1ZXJ5XG4gICAgY29uc3QgY29sdW1uQWxpYXNlcyA9IHRoaXMuZXh0cmFjdENvbHVtbkFsaWFzZXMocXVlcnkpO1xuICAgIGlmIChjb2x1bW5BbGlhc2VzLmxlbmd0aCA+IDApIHtcbiAgICAgIHNldHRpbmdzLmNvbHVtbkFsaWFzZXMgPSBjb2x1bW5BbGlhc2VzO1xuICAgICAgTG9nZ2VyLmRlYnVnKCdFeHRyYWN0ZWQgY29sdW1uIGFsaWFzZXM6JywgY29sdW1uQWxpYXNlcyk7XG4gICAgfVxuICAgIFxuICAgIHJldHVybiB7IHF1ZXJ5LCBzZXR0aW5ncyB9O1xuICB9XG4gIFxuICAvKipcbiAgICogRXh0cmFjdCBjb2x1bW4gYWxpYXNlcyBmcm9tIGEgRGF0YXZpZXcgcXVlcnlcbiAgICogSGFuZGxlcyBib3RoIHNpbXBsZSBhbGlhc2VzIChmaWVsZCBhcyBcIkFsaWFzXCIpIGFuZCBjb21wbGV4IGV4cHJlc3Npb25zXG4gICAqIFxuICAgKiBAcGFyYW0gcXVlcnkgVGhlIERhdGF2aWV3IHF1ZXJ5XG4gICAqIEByZXR1cm5zIEFycmF5IG9mIGNvbHVtbiBhbGlhc2VzXG4gICAqL1xuICBwcml2YXRlIGV4dHJhY3RDb2x1bW5BbGlhc2VzKHF1ZXJ5OiBzdHJpbmcpOiBDb2x1bW5BbGlhc1tdIHtcbiAgICBjb25zdCBhbGlhc2VzOiBDb2x1bW5BbGlhc1tdID0gW107XG4gICAgXG4gICAgLy8gT25seSBwcm9jZXNzIFRBQkxFIHF1ZXJpZXNcbiAgICBpZiAoIXF1ZXJ5LnRyaW0oKS50b1VwcGVyQ2FzZSgpLnN0YXJ0c1dpdGgoJ1RBQkxFJykpIHtcbiAgICAgIHJldHVybiBhbGlhc2VzO1xuICAgIH1cbiAgICBcbiAgICB0cnkge1xuICAgICAgLy8gRXh0cmFjdCB0aGUgY29sdW1uIGRlZmluaXRpb25zIHBhcnQgb2YgdGhlIHF1ZXJ5XG4gICAgICAvLyBUaGlzIGlzIHRoZSBwYXJ0IGJldHdlZW4gVEFCTEUgYW5kIHRoZSBmaXJzdCBGUk9NLCBXSEVSRSwgU09SVCwgR1JPVVAgQlksIExJTUlULCBGTEFUVEVOXG4gICAgICAvLyBVc2UgW1xcc1xcU10gaW5zdGVhZCBvZiBkb3Qgd2l0aCBzIGZsYWcgZm9yIGNyb3NzLWxpbmUgbWF0Y2hpbmdcbiAgICAgIGNvbnN0IHRhYmxlTWF0Y2ggPSBxdWVyeS5tYXRjaCgvVEFCTEVcXHMrKHdpdGhvdXRcXHMraWRcXHMrKT8oW1xcc1xcU10qPykoPzpcXHMrRlJPTXxcXHMrV0hFUkV8XFxzK1NPUlR8XFxzK0dST1VQIEJZfFxccytMSU1JVHxcXHMrRkxBVFRFTnwkKS9pKTtcbiAgICAgIFxuICAgICAgaWYgKCF0YWJsZU1hdGNoIHx8ICF0YWJsZU1hdGNoWzJdKSB7XG4gICAgICAgIHJldHVybiBhbGlhc2VzO1xuICAgICAgfVxuICAgICAgXG4gICAgICBjb25zdCBjb2x1bW5zVGV4dCA9IHRhYmxlTWF0Y2hbMl0udHJpbSgpO1xuICAgICAgTG9nZ2VyLmRlYnVnKCdFeHRyYWN0ZWQgY29sdW1ucyB0ZXh0OicsIGNvbHVtbnNUZXh0KTtcbiAgICAgIFxuICAgICAgaWYgKCFjb2x1bW5zVGV4dCkge1xuICAgICAgICByZXR1cm4gYWxpYXNlcztcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gU3BsaXQgdGhlIGNvbHVtbnMgYnkgY29tbWFzLCBidXQgaGFuZGxlIGNvbXBsZXggZXhwcmVzc2lvbnNcbiAgICAgIC8vIFRoaXMgaXMgYSBzaW1wbGlmaWVkIGFwcHJvYWNoIGFuZCBtYXkgbm90IGhhbmRsZSBhbGwgY2FzZXMgcGVyZmVjdGx5XG4gICAgICBjb25zdCBjb2x1bW5zID0gdGhpcy5zcGxpdENvbHVtbnNQcmVzZXJ2aW5nRXhwcmVzc2lvbnMoY29sdW1uc1RleHQpO1xuICAgICAgXG4gICAgICBmb3IgKGNvbnN0IGNvbHVtbiBvZiBjb2x1bW5zKSB7XG4gICAgICAgIC8vIExvb2sgZm9yIHRoZSBcImFzXCIga2V5d29yZCwgaGFuZGxpbmcgYm90aCBxdW90ZWQgYW5kIHVucXVvdGVkIGFsaWFzZXNcbiAgICAgICAgLy8gVGhpcyByZWdleCBoYW5kbGVzOiBmaWVsZCBhcyBBbGlhcywgZmllbGQgYXMgXCJBbGlhc1wiLCAoZXhwcmVzc2lvbikgYXMgQWxpYXMsIChleHByZXNzaW9uKSBhcyBcIkFsaWFzXCJcbiAgICAgICAgY29uc3QgYXNNYXRjaCA9IGNvbHVtbi5tYXRjaCgvXiguKj8pXFxzK2FzXFxzKyg/OlwiKFteXCJdKylcInwnKFteJ10rKSd8KFteXFxzLF0rKSkkL2kpO1xuICAgICAgICBcbiAgICAgICAgaWYgKGFzTWF0Y2gpIHtcbiAgICAgICAgICBjb25zdCBleHByZXNzaW9uID0gYXNNYXRjaFsxXS50cmltKCk7XG4gICAgICAgICAgLy8gVGhlIGFsaWFzIGNvdWxkIGJlIGluIGdyb3VwIDIgKGRvdWJsZSBxdW90ZXMpLCAzIChzaW5nbGUgcXVvdGVzKSwgb3IgNCAodW5xdW90ZWQpXG4gICAgICAgICAgY29uc3QgYWxpYXMgPSBhc01hdGNoWzJdIHx8IGFzTWF0Y2hbM10gfHwgYXNNYXRjaFs0XTtcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBGb3Igc2ltcGxlIGZpZWxkIG5hbWVzLCB1c2UgdGhlIGZpZWxkIG5hbWUgYXMgb3JpZ2luYWxcbiAgICAgICAgICAvLyBGb3IgY29tcGxleCBleHByZXNzaW9ucywgdXNlIHRoZSB3aG9sZSBleHByZXNzaW9uXG4gICAgICAgICAgbGV0IG9yaWdpbmFsID0gZXhwcmVzc2lvbjtcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBJZiBpdCdzIGEgc2ltcGxlIGZpZWxkIG5hbWUgKG5vIHNwYWNlcywgb3BlcmF0b3JzLCBldGMuKSwgdXNlIGl0IGFzIG9yaWdpbmFsXG4gICAgICAgICAgaWYgKC9eW2EtekEtWjAtOV8uLV0rJC8udGVzdChleHByZXNzaW9uKSkge1xuICAgICAgICAgICAgb3JpZ2luYWwgPSBleHByZXNzaW9uO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBGb3IgY29tcGxleCBleHByZXNzaW9ucywgdHJ5IHRvIGV4dHJhY3QgdGhlIGNvcmUgZmllbGQgbmFtZSBpZiBwb3NzaWJsZVxuICAgICAgICAgICAgLy8gVGhpcyBoZWxwcyB3aXRoIGV4cHJlc3Npb25zIGxpa2UgKFwiIVt8NjBdKFwiICsgY292ZXIgKyBcIilcIikgYXMgQ292ZXJcbiAgICAgICAgICAgIGNvbnN0IGZpZWxkTWF0Y2ggPSBleHByZXNzaW9uLm1hdGNoKC9cXChcXHMqXCIuKj9cIlxccypcXCtcXHMqKFthLXpBLVowLTlfLi1dKylcXHMqXFwrXFxzKlwiLio/XCJcXHMqXFwpLyk7XG4gICAgICAgICAgICBpZiAoZmllbGRNYXRjaCAmJiBmaWVsZE1hdGNoWzFdKSB7XG4gICAgICAgICAgICAgIC8vIFVzZSB0aGUgZXh0cmFjdGVkIGZpZWxkIG5hbWUgYXMgdGhlIG9yaWdpbmFsXG4gICAgICAgICAgICAgIG9yaWdpbmFsID0gZmllbGRNYXRjaFsxXTtcbiAgICAgICAgICAgICAgTG9nZ2VyLmRlYnVnKGBFeHRyYWN0ZWQgZmllbGQgbmFtZSBmcm9tIGNvbXBsZXggZXhwcmVzc2lvbjogJHtvcmlnaW5hbH1gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgXG4gICAgICAgICAgYWxpYXNlcy5wdXNoKHtcbiAgICAgICAgICAgIG9yaWdpbmFsLFxuICAgICAgICAgICAgYWxpYXMsXG4gICAgICAgICAgICBleHByZXNzaW9uXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgXG4gICAgICAgICAgTG9nZ2VyLmRlYnVnKGBGb3VuZCBjb2x1bW4gYWxpYXM6ICR7b3JpZ2luYWx9IGFzIFwiJHthbGlhc31cImApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIExvZ2dlci5lcnJvcignRXJyb3IgZXh0cmFjdGluZyBjb2x1bW4gYWxpYXNlczonLCBlcnJvcik7XG4gICAgfVxuICAgIFxuICAgIHJldHVybiBhbGlhc2VzO1xuICB9XG4gIFxuICAvKipcbiAgICogU3BsaXQgYSBjb21tYS1zZXBhcmF0ZWQgbGlzdCBvZiBjb2x1bW5zIHdoaWxlIHByZXNlcnZpbmcgZXhwcmVzc2lvbnNcbiAgICogVGhpcyBoYW5kbGVzIG5lc3RlZCBwYXJlbnRoZXNlcyBhbmQgcXVvdGVzXG4gICAqIFxuICAgKiBAcGFyYW0gY29sdW1uc1RleHQgVGhlIHRleHQgY29udGFpbmluZyBjb21tYS1zZXBhcmF0ZWQgY29sdW1uc1xuICAgKiBAcmV0dXJucyBBcnJheSBvZiBjb2x1bW4gZXhwcmVzc2lvbnNcbiAgICovXG4gIHByaXZhdGUgc3BsaXRDb2x1bW5zUHJlc2VydmluZ0V4cHJlc3Npb25zKGNvbHVtbnNUZXh0OiBzdHJpbmcpOiBzdHJpbmdbXSB7XG4gICAgY29uc3QgY29sdW1uczogc3RyaW5nW10gPSBbXTtcbiAgICBsZXQgY3VycmVudENvbHVtbiA9ICcnO1xuICAgIGxldCBwYXJlbkRlcHRoID0gMDtcbiAgICBsZXQgaW5Eb3VibGVRdW90ZSA9IGZhbHNlO1xuICAgIGxldCBpblNpbmdsZVF1b3RlID0gZmFsc2U7XG4gICAgXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb2x1bW5zVGV4dC5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgY2hhciA9IGNvbHVtbnNUZXh0W2ldO1xuICAgICAgXG4gICAgICAvLyBIYW5kbGUgcXVvdGVzXG4gICAgICBpZiAoY2hhciA9PT0gJ1wiJyAmJiAhaW5TaW5nbGVRdW90ZSkge1xuICAgICAgICBpbkRvdWJsZVF1b3RlID0gIWluRG91YmxlUXVvdGU7XG4gICAgICB9IGVsc2UgaWYgKGNoYXIgPT09IFwiJ1wiICYmICFpbkRvdWJsZVF1b3RlKSB7XG4gICAgICAgIGluU2luZ2xlUXVvdGUgPSAhaW5TaW5nbGVRdW90ZTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gSGFuZGxlIHBhcmVudGhlc2VzIChvbmx5IGlmIG5vdCBpbiBxdW90ZXMpXG4gICAgICBpZiAoIWluRG91YmxlUXVvdGUgJiYgIWluU2luZ2xlUXVvdGUpIHtcbiAgICAgICAgaWYgKGNoYXIgPT09ICcoJykge1xuICAgICAgICAgIHBhcmVuRGVwdGgrKztcbiAgICAgICAgfSBlbHNlIGlmIChjaGFyID09PSAnKScpIHtcbiAgICAgICAgICBwYXJlbkRlcHRoLS07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gSGFuZGxlIGNvbW1hcyAob25seSBpZiBub3QgaW4gcXVvdGVzIG9yIHBhcmVudGhlc2VzKVxuICAgICAgaWYgKGNoYXIgPT09ICcsJyAmJiBwYXJlbkRlcHRoID09PSAwICYmICFpbkRvdWJsZVF1b3RlICYmICFpblNpbmdsZVF1b3RlKSB7XG4gICAgICAgIGNvbHVtbnMucHVzaChjdXJyZW50Q29sdW1uLnRyaW0oKSk7XG4gICAgICAgIGN1cnJlbnRDb2x1bW4gPSAnJztcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBcbiAgICAgIGN1cnJlbnRDb2x1bW4gKz0gY2hhcjtcbiAgICB9XG4gICAgXG4gICAgLy8gQWRkIHRoZSBsYXN0IGNvbHVtblxuICAgIGlmIChjdXJyZW50Q29sdW1uLnRyaW0oKSkge1xuICAgICAgY29sdW1ucy5wdXNoKGN1cnJlbnRDb2x1bW4udHJpbSgpKTtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIGNvbHVtbnM7XG4gIH1cblxuICAvKipcbiAgICogRW5zdXJlIHRoZSBxdWVyeSBoYXMgYSB0eXBlIChUQUJMRSwgTElTVCwgVEFTSywgQ0FMRU5EQVIpXG4gICAqIElmIG5vIHR5cGUgaXMgc3BlY2lmaWVkLCBhZGQgVEFCTEUgYXMgdGhlIGRlZmF1bHRcbiAgICogXG4gICAqIEBwYXJhbSBxdWVyeSBUaGUgRGF0YXZpZXcgcXVlcnlcbiAgICogQHJldHVybnMgVGhlIHF1ZXJ5IHdpdGggYSB0eXBlXG4gICAqL1xuICBwcml2YXRlIGVuc3VyZVF1ZXJ5VHlwZShxdWVyeTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICAvLyBDaGVjayBpZiB0aGUgcXVlcnkgYWxyZWFkeSBoYXMgYSB0eXBlXG4gICAgY29uc3QgaGFzVHlwZSA9IC9cXGIoVEFCTEV8TElTVHxUQVNLfENBTEVOREFSKVxcYi9pLnRlc3QocXVlcnkpO1xuICAgIFxuICAgIGlmICghaGFzVHlwZSkge1xuICAgICAgLy8gQWRkIFRBQkxFIGFzIHRoZSBkZWZhdWx0IHR5cGVcbiAgICAgIC8vIEZpcnN0LCBmaW5kIHRoZSBmaXJzdCBsaW5lIHRoYXQncyBub3QgYSBjb21tZW50XG4gICAgICBjb25zdCBsaW5lcyA9IHF1ZXJ5LnNwbGl0KCdcXG4nKTtcbiAgICAgIGxldCBmaXJzdE5vbkNvbW1lbnRMaW5lID0gLTE7XG4gICAgICBcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGluZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgY29uc3QgbGluZSA9IGxpbmVzW2ldLnRyaW0oKTtcbiAgICAgICAgaWYgKGxpbmUgJiYgIWxpbmUuc3RhcnRzV2l0aCgnLy8nKSAmJiAhbGluZS5zdGFydHNXaXRoKCcvKicpKSB7XG4gICAgICAgICAgZmlyc3ROb25Db21tZW50TGluZSA9IGk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIFxuICAgICAgaWYgKGZpcnN0Tm9uQ29tbWVudExpbmUgPj0gMCkge1xuICAgICAgICAvLyBHZXQgdGhlIHNldHRpbmdzIHRvIGRldGVybWluZSB3aGljaCBwcm9wZXJ0aWVzIHRvIGluY2x1ZGUgaW4gdGhlIHF1ZXJ5XG4gICAgICAgIGNvbnN0IHNldHRpbmdzID0gdGhpcy5wYXJzZVNldHRpbmdzKGxpbmVzLnNsaWNlKGZpcnN0Tm9uQ29tbWVudExpbmUgKyAxKS5qb2luKCdcXG4nKSk7XG4gICAgICAgIFxuICAgICAgICAvLyBEZXRlcm1pbmUgd2hpY2ggcHJvcGVydGllcyB0byBpbmNsdWRlIGluIHRoZSBxdWVyeVxuICAgICAgICBsZXQgcHJvcGVydGllc1RvSW5jbHVkZSA9ICcnO1xuICAgICAgICBjb25zdCBwcm9wZXJ0aWVzVG9JbmNsdWRlQXJyYXkgPSBbXTtcbiAgICAgICAgXG4gICAgICAgIC8vIEFkZCB0aGUgaW1hZ2UgcHJvcGVydHkgaWYgc3BlY2lmaWVkXG4gICAgICAgIGlmIChzZXR0aW5ncy5pbWFnZVByb3BlcnR5KSB7XG4gICAgICAgICAgcHJvcGVydGllc1RvSW5jbHVkZUFycmF5LnB1c2goc2V0dGluZ3MuaW1hZ2VQcm9wZXJ0eSk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC8vIEZvciBzaW1wbGljaXR5LCBsZXQncyBqdXN0IHVzZSBhIGJhc2ljIFRBQkxFIHF1ZXJ5IHdpdGhvdXQgc3BlY2lmeWluZyBwcm9wZXJ0aWVzXG4gICAgICAgIC8vIERhdGF2aWV3IHdpbGwgYXV0b21hdGljYWxseSBpbmNsdWRlIGFsbCBwcm9wZXJ0aWVzXG4gICAgICAgIHByb3BlcnRpZXNUb0luY2x1ZGUgPSAnJztcbiAgICAgICAgXG4gICAgICAgIExvZ2dlci5kZWJ1ZygnVXNpbmcgc2ltcGxlIFRBQkxFIHF1ZXJ5IHdpdGhvdXQgcHJvcGVydHkgbGlzdCcpO1xuICAgICAgICBcbiAgICAgICAgLy8gSW5zZXJ0IFRBQkxFIHdpdGggcHJvcGVydGllcyBiZWZvcmUgdGhlIGZpcnN0IG5vbi1jb21tZW50IGxpbmVcbiAgICAgICAgLy8gTWFrZSBzdXJlIHRoZXJlJ3Mgbm8gc3BhY2UgYmV0d2VlbiBUQUJMRSBhbmQgRlJPTSBpZiB0aGVyZSBhcmUgbm8gcHJvcGVydGllc1xuICAgICAgICBpZiAocHJvcGVydGllc1RvSW5jbHVkZS50cmltKCkgPT09ICcnKSB7XG4gICAgICAgICAgbGluZXNbZmlyc3ROb25Db21tZW50TGluZV0gPSAnVEFCTEUgJyArIGxpbmVzW2ZpcnN0Tm9uQ29tbWVudExpbmVdO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGxpbmVzW2ZpcnN0Tm9uQ29tbWVudExpbmVdID0gJ1RBQkxFJyArIHByb3BlcnRpZXNUb0luY2x1ZGUgKyAnICcgKyBsaW5lc1tmaXJzdE5vbkNvbW1lbnRMaW5lXTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbGluZXMuam9pbignXFxuJyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBJZiB0aGVyZSBhcmUgbm8gbm9uLWNvbW1lbnQgbGluZXMsIGp1c3QgcHJlcGVuZCBUQUJMRVxuICAgICAgICByZXR1cm4gJ1RBQkxFICcgKyBxdWVyeTtcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHF1ZXJ5O1xuICB9XG5cbiAgLyoqXG4gICAqIFBhcnNlIHRoZSBzZXR0aW5ncyBzZWN0aW9uIG9mIGEgZGF0YWNhcmRzIGNvZGUgYmxvY2tcbiAgICogXG4gICAqIEBwYXJhbSBzZXR0aW5nc1RleHQgVGhlIHNldHRpbmdzIHRleHQgdG8gcGFyc2VcbiAgICogQHJldHVybnMgVGhlIHBhcnNlZCBzZXR0aW5ncyBvYmplY3RcbiAgICovXG4gIHByaXZhdGUgcGFyc2VTZXR0aW5ncyhzZXR0aW5nc1RleHQ6IHN0cmluZyk6IEJsb2NrU2V0dGluZ3Mge1xuICAgIGlmICghc2V0dGluZ3NUZXh0KSB7XG4gICAgICByZXR1cm4ge307XG4gICAgfVxuXG4gICAgY29uc3Qgc2V0dGluZ3M6IER5bmFtaWNCbG9ja1NldHRpbmdzID0ge307XG4gICAgXG4gICAgLy8gU3BsaXQgdGhlIHNldHRpbmdzIHRleHQgaW50byBsaW5lc1xuICAgIGNvbnN0IGxpbmVzID0gc2V0dGluZ3NUZXh0LnNwbGl0KCdcXG4nKTtcbiAgICBcbiAgICBMb2dnZXIuZGVidWcoJ1BhcnNpbmcgc2V0dGluZ3MgZnJvbSB0ZXh0Jyk7XG4gICAgXG4gICAgZm9yIChjb25zdCBsaW5lIG9mIGxpbmVzKSB7XG4gICAgICAvLyBTa2lwIGNvbW1lbnRzIGFuZCBlbXB0eSBsaW5lc1xuICAgICAgaWYgKGxpbmUudHJpbSgpLnN0YXJ0c1dpdGgoJy8vJykgfHwgbGluZS50cmltKCkuc3RhcnRzV2l0aCgnLyonKSB8fCAhbGluZS50cmltKCkpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIExvb2sgZm9yIGtleS12YWx1ZSBwYWlycyAoa2V5OiB2YWx1ZSlcbiAgICAgIGNvbnN0IG1hdGNoID0gbGluZS5tYXRjaCgvXlxccyooW2EtekEtWjAtOV9dKylcXHMqOlxccyooLispXFxzKiQvKTtcbiAgICAgIGlmIChtYXRjaCkge1xuICAgICAgICBjb25zdCBbLCBrZXksIHZhbHVlXSA9IG1hdGNoO1xuICAgICAgICBMb2dnZXIuZGVidWcoYEZvdW5kIHNldHRpbmc6ICR7a2V5fSA9ICR7dmFsdWV9YCk7XG4gICAgICAgIFxuICAgICAgICAvLyBTcGVjaWFsIGhhbmRsaW5nIGZvciBwcm9wZXJ0aWVzXG4gICAgICAgIGlmIChrZXkgPT09ICdwcm9wZXJ0aWVzJyAmJiB2YWx1ZS50cmltKCkuc3RhcnRzV2l0aCgnWycpICYmIHZhbHVlLnRyaW0oKS5lbmRzV2l0aCgnXScpKSB7XG4gICAgICAgICAgTG9nZ2VyLmRlYnVnKCdEZXRlY3RlZCBwcm9wZXJ0aWVzIGFycmF5Jyk7XG4gICAgICAgICAgY29uc3QgYXJyYXlDb250ZW50ID0gdmFsdWUuc3Vic3RyaW5nKDEsIHZhbHVlLmxlbmd0aCAtIDEpLnRyaW0oKTtcbiAgICAgICAgICBpZiAoYXJyYXlDb250ZW50KSB7XG4gICAgICAgICAgICBjb25zdCBwcm9wZXJ0aWVzID0gYXJyYXlDb250ZW50LnNwbGl0KCcsJykubWFwKGl0ZW0gPT4gaXRlbS50cmltKCkpO1xuICAgICAgICAgICAgc2V0dGluZ3Nba2V5XSA9IHByb3BlcnRpZXM7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHNldHRpbmdzW2tleV0gPSBbXTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgLy8gU3BlY2lhbCBoYW5kbGluZyBmb3IgZGVmYXVsdERhdGVGb3JtYXRcbiAgICBpZiAoa2V5ID09PSAnZGVmYXVsdERhdGVGb3JtYXQnKSB7XG4gICAgICBzZXR0aW5nc1trZXldID0gdmFsdWUudHJpbSgpO1xuICAgIH0gXG4gICAgLy8gU3BlY2lhbCBoYW5kbGluZyBmb3IgZHluYW1pY1VwZGF0ZVxuICAgIGVsc2UgaWYgKGtleSA9PT0gJ2R5bmFtaWNVcGRhdGUnKSB7XG4gICAgICBzZXR0aW5nc1trZXldID0gdGhpcy5wYXJzZVZhbHVlKHZhbHVlLnRyaW0oKSk7XG4gICAgICBMb2dnZXIuZGVidWcoYFBhcnNlZCBkeW5hbWljVXBkYXRlIHNldHRpbmc6ICR7c2V0dGluZ3Nba2V5XX1gKTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gUGFyc2Ugb3RoZXIgdmFsdWVzIGJhc2VkIG9uIHRoZWlyIGZvcm1hdFxuICAgICAgc2V0dGluZ3Nba2V5XSA9IHRoaXMucGFyc2VWYWx1ZSh2YWx1ZS50cmltKCkpO1xuICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICByZXR1cm4gc2V0dGluZ3M7XG4gIH1cblxuICAvKipcbiAgICogUGFyc2UgYSB2YWx1ZSBmcm9tIHRoZSBzZXR0aW5ncyBzZWN0aW9uXG4gICAqIFxuICAgKiBAcGFyYW0gdmFsdWUgVGhlIHZhbHVlIHRvIHBhcnNlXG4gICAqIEByZXR1cm5zIFRoZSBwYXJzZWQgdmFsdWVcbiAgICovXG4gIHByaXZhdGUgcGFyc2VWYWx1ZSh2YWx1ZTogc3RyaW5nKTogYW55IHtcbiAgICBMb2dnZXIuZGVidWcoJ1BhcnNpbmcgdmFsdWU6JywgdmFsdWUpO1xuICAgIFxuICAgIC8vIFRyeSB0byBwYXJzZSBhcyBKU09OXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGpzb25WYWx1ZSA9IEpTT04ucGFyc2UodmFsdWUpO1xuICAgICAgcmV0dXJuIGpzb25WYWx1ZTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICAvLyBOb3QgdmFsaWQgSlNPTiwgY29udGludWUgd2l0aCBvdGhlciBwYXJzaW5nIG1ldGhvZHNcbiAgICB9XG4gICAgXG4gICAgLy8gQ2hlY2sgZm9yIGFycmF5cyBpbiB0aGUgZm9ybWF0IFtpdGVtMSwgaXRlbTIsIGl0ZW0zXVxuICAgIGlmICh2YWx1ZS5zdGFydHNXaXRoKCdbJykgJiYgdmFsdWUuZW5kc1dpdGgoJ10nKSkge1xuICAgICAgTG9nZ2VyLmRlYnVnKCdEZXRlY3RlZCBhcnJheSBzeW50YXgnKTtcbiAgICAgIGNvbnN0IGFycmF5Q29udGVudCA9IHZhbHVlLnN1YnN0cmluZygxLCB2YWx1ZS5sZW5ndGggLSAxKS50cmltKCk7XG4gICAgICBpZiAoYXJyYXlDb250ZW50KSB7XG4gICAgICAgIC8vIFNwbGl0IGJ5IGNvbW1hcywgYnV0IGhhbmRsZSB0aGUgY2FzZSB3aGVyZSB0aGVyZSBhcmUgbm8gc3BhY2VzIGFmdGVyIGNvbW1hc1xuICAgICAgICBjb25zdCBpdGVtcyA9IGFycmF5Q29udGVudC5zcGxpdCgnLCcpLm1hcChpdGVtID0+IHtcbiAgICAgICAgICBjb25zdCB0cmltbWVkSXRlbSA9IGl0ZW0udHJpbSgpO1xuICAgICAgICAgIC8vIERvbid0IHJlY3Vyc2l2ZWx5IHBhcnNlIGFycmF5IGl0ZW1zIHRvIGF2b2lkIGlzc3VlcyB3aXRoIHByb3BlcnR5IG5hbWVzXG4gICAgICAgICAgLy8gSnVzdCByZXR1cm4gdGhlIHRyaW1tZWQgc3RyaW5nIGZvciBwcm9wZXJ0eSBuYW1lc1xuICAgICAgICAgIHJldHVybiB0cmltbWVkSXRlbTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBpdGVtcztcbiAgICAgIH1cbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gICAgXG4gICAgLy8gQ2hlY2sgZm9yIG51bWJlcnNcbiAgICBpZiAoL14tP1xcZCsoXFwuXFxkKyk/JC8udGVzdCh2YWx1ZSkpIHtcbiAgICAgIHJldHVybiBOdW1iZXIodmFsdWUpO1xuICAgIH1cbiAgICBcbiAgICAvLyBDaGVjayBmb3IgYm9vbGVhbnNcbiAgICBpZiAodmFsdWUudG9Mb3dlckNhc2UoKSA9PT0gJ3RydWUnKSByZXR1cm4gdHJ1ZTtcbiAgICBpZiAodmFsdWUudG9Mb3dlckNhc2UoKSA9PT0gJ2ZhbHNlJykgcmV0dXJuIGZhbHNlO1xuICAgIFxuICAgIC8vIERlZmF1bHQgdG8gc3RyaW5nXG4gICAgcmV0dXJuIHZhbHVlO1xuICB9XG59XG4iLCAiaW1wb3J0IHsgQXBwLCBURmlsZSwgUGxhdGZvcm0gfSBmcm9tICdvYnNpZGlhbic7XG5pbXBvcnQgeyBEYXRhQ2FyZHNTZXR0aW5ncywgQmxvY2tTZXR0aW5ncyB9IGZyb20gJy4uL21vZGVscy9zZXR0aW5ncyc7XG5pbXBvcnQgeyBERUZBVUxUX1NFVFRJTkdTIH0gZnJvbSAnLi4vbW9kZWxzL3NldHRpbmdzJztcbmltcG9ydCB7IExvZ2dlciB9IGZyb20gJy4uL3V0aWxzL2xvZ2dlcic7XG5cbi8qKlxuICogU2VydmljZSBmb3IgcmVuZGVyaW5nIERhdGF2aWV3IHJlc3VsdHMgYXMgY2FyZHNcbiAqL1xuZXhwb3J0IGNsYXNzIFJlbmRlcmVyU2VydmljZSB7XG4gIHByaXZhdGUgYXBwOiBBcHA7XG4gIC8vIFN0b3JlIHRoZSBjdXJyZW50IHNldHRpbmdzIGZvciB1c2UgaW4gZm9ybWF0dGluZyBtZXRob2RzXG4gIHByaXZhdGUgY3VycmVudFNldHRpbmdzOiBEYXRhQ2FyZHNTZXR0aW5ncyB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIHBsdWdpblNldHRpbmdzOiBEYXRhQ2FyZHNTZXR0aW5ncztcblxuICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgcGx1Z2luU2V0dGluZ3M6IERhdGFDYXJkc1NldHRpbmdzKSB7XG4gICAgdGhpcy5hcHAgPSBhcHA7XG4gICAgdGhpcy5wbHVnaW5TZXR0aW5ncyA9IHBsdWdpblNldHRpbmdzO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSB0aGUgcGx1Z2luIHNldHRpbmdzIHJlZmVyZW5jZVxuICAgKiBcbiAgICogQHBhcmFtIHNldHRpbmdzIFRoZSB1cGRhdGVkIHBsdWdpbiBzZXR0aW5nc1xuICAgKi9cbiAgcHVibGljIHVwZGF0ZVNldHRpbmdzKHNldHRpbmdzOiBEYXRhQ2FyZHNTZXR0aW5ncyk6IHZvaWQge1xuICAgICB0aGlzLnBsdWdpblNldHRpbmdzID0gc2V0dGluZ3M7XG4gIH1cbiAgLyoqXG4gICAqIENoZWNrIGlmIHRoZSBjdXJyZW50IGRldmljZSBpcyBtb2JpbGUgb3IgaWYgbW9iaWxlIG1vZGUgaXMgZm9yY2VkXG4gICAqIFxuICAgKiBAcmV0dXJucyBUcnVlIGlmIHRoZSBkZXZpY2UgaXMgbW9iaWxlIG9yIGlmIG1vYmlsZSBtb2RlIGlzIGZvcmNlZCwgZmFsc2Ugb3RoZXJ3aXNlXG4gICAqL1xuICBwcml2YXRlIGlzTW9iaWxlRGV2aWNlKCk6IGJvb2xlYW4ge1xuICAgIC8vIFJldHVybiB0cnVlIGlmIHRoZSBkZXZpY2UgaXMgYWN0dWFsbHkgbW9iaWxlIE9SIGlmIGZvcmNlIG1vYmlsZSBtb2RlIGlzIGVuYWJsZWRcbiAgICByZXR1cm4gUGxhdGZvcm0uaXNNb2JpbGUgfHwgdGhpcy5wbHVnaW5TZXR0aW5ncy5mb3JjZU1vYmlsZU1vZGU7XG4gIH1cblxuICAvKipcbiAgICogUmVuZGVyIERhdGF2aWV3IHF1ZXJ5IHJlc3VsdHMgYXMgY2FyZHNcbiAgICogXG4gICAqIEBwYXJhbSBjb250YWluZXIgVGhlIGNvbnRhaW5lciBlbGVtZW50IHRvIHJlbmRlciBpbnRvXG4gICAqIEBwYXJhbSByZXN1bHRzIFRoZSBEYXRhdmlldyBxdWVyeSByZXN1bHRzXG4gICAqIEBwYXJhbSBibG9ja1NldHRpbmdzIFRoZSBzZXR0aW5ncyBmb3IgdGhpcyBzcGVjaWZpYyBibG9ja1xuICAgKi9cbiAgcHVibGljIHJlbmRlckNhcmRzKGNvbnRhaW5lcjogSFRNTEVsZW1lbnQsIHJlc3VsdHM6IGFueSwgYmxvY2tTZXR0aW5nczogQmxvY2tTZXR0aW5ncyk6IHZvaWQge1xuICAgIC8vIENoZWNrIGlmIHdlJ3JlIG9uIG1vYmlsZVxuICAgIGNvbnN0IGlzTW9iaWxlID0gdGhpcy5pc01vYmlsZURldmljZSgpO1xuICAgIExvZ2dlci5kZWJ1ZygnSXMgbW9iaWxlIGRldmljZTonLCBpc01vYmlsZSk7XG4gICAgXG4gICAgLy8gU3RhcnQgd2l0aCBwbHVnaW4gc2V0dGluZ3NcbiAgICBsZXQgc2V0dGluZ3MgPSB7IC4uLnRoaXMucGx1Z2luU2V0dGluZ3MgfTtcbiAgICBMb2dnZXIuZGVidWcoJ0luaXRpYWwgc2V0dGluZ3MgZnJvbSBwbHVnaW46Jywge1xuICAgICAgcHJlc2V0OiBzZXR0aW5ncy5wcmVzZXQsXG4gICAgICBpbWFnZUhlaWdodDogc2V0dGluZ3MuaW1hZ2VIZWlnaHQsXG4gICAgICBtb2JpbGVDb2x1bW5zOiBzZXR0aW5ncy5tb2JpbGVDb2x1bW5zLFxuICAgICAgbW9iaWxlUHJlc2V0OiBzZXR0aW5ncy5tb2JpbGVQcmVzZXQsXG4gICAgICBtb2JpbGVJbWFnZUhlaWdodDogc2V0dGluZ3MubW9iaWxlSW1hZ2VIZWlnaHRcbiAgICB9KTtcbiAgICBcbiAgICAvLyBBcHBseSBibG9jayBzZXR0aW5nc1xuICAgIHNldHRpbmdzID0geyAuLi5zZXR0aW5ncywgLi4uYmxvY2tTZXR0aW5ncyB9O1xuICAgIExvZ2dlci5kZWJ1ZygnQWZ0ZXIgYXBwbHlpbmcgYmxvY2sgc2V0dGluZ3M6Jywge1xuICAgICAgcHJlc2V0OiBzZXR0aW5ncy5wcmVzZXQsXG4gICAgICBpbWFnZUhlaWdodDogc2V0dGluZ3MuaW1hZ2VIZWlnaHQsXG4gICAgICBtb2JpbGVDb2x1bW5zOiBzZXR0aW5ncy5tb2JpbGVDb2x1bW5zLFxuICAgICAgbW9iaWxlUHJlc2V0OiBzZXR0aW5ncy5tb2JpbGVQcmVzZXQsXG4gICAgICBtb2JpbGVJbWFnZUhlaWdodDogc2V0dGluZ3MubW9iaWxlSW1hZ2VIZWlnaHRcbiAgICB9KTtcbiAgICBcbiAgICAvLyBJZiBvbiBtb2JpbGUsIGFwcGx5IG1vYmlsZSBzZXR0aW5ncyAob3ZlcnJpZGluZyBwcmV2aW91cyBzZXR0aW5ncylcbiAgICBpZiAoaXNNb2JpbGUpIHtcbiAgICAgIExvZ2dlci5kZWJ1ZygnQXBwbHlpbmcgbW9iaWxlIHNldHRpbmdzLi4uJyk7XG4gICAgICBcbiAgICAgIC8vIE1vYmlsZSBkZXZpY2VzIHVzZSBtb2JpbGVDb2x1bW5zIHNldHRpbmcgKGRlZmF1bHRzIHRvIDEpXG4gICAgICBMb2dnZXIuZGVidWcoYFVzaW5nIG1vYmlsZSBjb2x1bW5zOiAke3NldHRpbmdzLm1vYmlsZUNvbHVtbnN9YCk7XG4gICAgICBcbiAgICAgIC8vIEFwcGx5IG1vYmlsZSBwcmVzZXRcbiAgICAgIGlmIChzZXR0aW5ncy5tb2JpbGVQcmVzZXQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBMb2dnZXIuZGVidWcoYE92ZXJyaWRpbmcgcHJlc2V0OiAke3NldHRpbmdzLnByZXNldH0gd2l0aCBtb2JpbGVQcmVzZXQ6ICR7c2V0dGluZ3MubW9iaWxlUHJlc2V0fWApO1xuICAgICAgICBzZXR0aW5ncy5wcmVzZXQgPSBzZXR0aW5ncy5tb2JpbGVQcmVzZXQ7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIEFwcGx5IG1vYmlsZSBpbWFnZSBoZWlnaHRcbiAgICAgIGlmIChzZXR0aW5ncy5tb2JpbGVJbWFnZUhlaWdodCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIExvZ2dlci5kZWJ1ZyhgT3ZlcnJpZGluZyBpbWFnZUhlaWdodDogJHtzZXR0aW5ncy5pbWFnZUhlaWdodH0gd2l0aCBtb2JpbGVJbWFnZUhlaWdodDogJHtzZXR0aW5ncy5tb2JpbGVJbWFnZUhlaWdodH1gKTtcbiAgICAgICAgc2V0dGluZ3MuaW1hZ2VIZWlnaHQgPSBzZXR0aW5ncy5tb2JpbGVJbWFnZUhlaWdodDtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgTG9nZ2VyLmRlYnVnKCdGaW5hbCBzZXR0aW5ncyBhZnRlciBhcHBseWluZyBtb2JpbGUgc2V0dGluZ3M6Jywge1xuICAgICAgICBwcmVzZXQ6IHNldHRpbmdzLnByZXNldCxcbiAgICAgICAgaW1hZ2VIZWlnaHQ6IHNldHRpbmdzLmltYWdlSGVpZ2h0XG4gICAgICB9KTtcbiAgICB9XG4gICAgXG4gICAgLy8gU3RvcmUgdGhlIGN1cnJlbnQgc2V0dGluZ3MgZm9yIHVzZSBpbiBmb3JtYXR0aW5nIG1ldGhvZHNcbiAgICB0aGlzLmN1cnJlbnRTZXR0aW5ncyA9IHNldHRpbmdzO1xuICAgIFxuICAgIC8vIENyZWF0ZSB0aGUgY2FyZHMgY29udGFpbmVyXG4gICAgY29uc3QgY2FyZHNDb250YWluZXIgPSBjb250YWluZXIuY3JlYXRlRWwoJ2RpdicsIHtcbiAgICAgIGNsczogJ2RhdGFjYXJkcy1jb250YWluZXInLFxuICAgIH0pO1xuICAgIFxuICAgIC8vIEFkZCBwcmVzZXQgY2xhc3MgZmlyc3RcbiAgICBjYXJkc0NvbnRhaW5lci5hZGRDbGFzcyhgZGF0YWNhcmRzLXByZXNldC0ke3NldHRpbmdzLnByZXNldH1gKTtcbiAgICBcbiAgICAvLyBBZGQgbm8tc2hhZG93cyBjbGFzcyBpZiBzaGFkb3dzIGFyZSBkaXNhYmxlZFxuICAgIGlmICghc2V0dGluZ3MuZW5hYmxlU2hhZG93cykge1xuICAgICAgY2FyZHNDb250YWluZXIuYWRkQ2xhc3MoJ2RhdGFjYXJkcy1uby1zaGFkb3dzJyk7XG4gICAgfVxuICAgIFxuICAgIC8vIEFwcGx5IGZvbnQgc2l6ZSBjbGFzcyBpZiBzcGVjaWZpZWRcbiAgICBpZiAoc2V0dGluZ3MuZm9udFNpemUgJiYgc2V0dGluZ3MuZm9udFNpemUgIT09ICdkZWZhdWx0Jykge1xuICAgICAgY2FyZHNDb250YWluZXIuYWRkQ2xhc3MoYGRhdGFjYXJkcy1mb250LSR7c2V0dGluZ3MuZm9udFNpemV9YCk7XG4gICAgICBMb2dnZXIuZGVidWcoYEFwcGxpZWQgZm9udCBzaXplIGNsYXNzOiBkYXRhY2FyZHMtZm9udC0ke3NldHRpbmdzLmZvbnRTaXplfWApO1xuICAgIH0gZWxzZSBpZiAoc2V0dGluZ3MucHJlc2V0ID09PSAnZGVuc2UnICYmICghc2V0dGluZ3MuZm9udFNpemUgfHwgc2V0dGluZ3MuZm9udFNpemUgPT09ICdkZWZhdWx0JykpIHtcbiAgICAgIC8vIEZvciBkZW5zZSBwcmVzZXQsIGF1dG9tYXRpY2FsbHkgdXNlIHNtYWxsIGZvbnQgc2l6ZSBpZiBub3QgZXhwbGljaXRseSBvdmVycmlkZGVuXG4gICAgICBjYXJkc0NvbnRhaW5lci5hZGRDbGFzcygnZGF0YWNhcmRzLWZvbnQtc21hbGwnKTtcbiAgICAgIExvZ2dlci5kZWJ1ZygnQXBwbGllZCBzbWFsbCBmb250IHNpemUgZm9yIGRlbnNlIHByZXNldCcpO1xuICAgIH1cbiAgICBcbiAgICAvLyBTZXQgb25seSB0aGUgbm9uLXByZXNldCBzcGVjaWZpYyBDU1MgdmFyaWFibGVzXG4gICAgLy8gVGhpcyBhbGxvd3MgdGhlIHByZXNldCBjbGFzcyB0byBjb250cm9sIHByZXNldC1zcGVjaWZpYyB2YXJpYWJsZXNcbiAgICBjYXJkc0NvbnRhaW5lci5zdHlsZS5zZXRQcm9wZXJ0eSgnLS1jYXJkLWdhcCcsIGAke3NldHRpbmdzLmNhcmRTcGFjaW5nfXB4YCk7XG4gICAgXG4gICAgLy8gRGV0ZXJtaW5lIGNvbHVtbnMgYmFzZWQgb24gcHJlc2V0IGFuZCBkZXZpY2UgdHlwZVxuICAgIGxldCBjb2x1bW5zVG9Vc2U6IG51bWJlcjtcbiAgICBcbiAgICBpZiAoaXNNb2JpbGUpIHtcbiAgICAgIC8vIE9uIG1vYmlsZSwgdXNlIG1vYmlsZUNvbHVtbnMgc2V0dGluZ1xuICAgICAgY29sdW1uc1RvVXNlID0gc2V0dGluZ3MubW9iaWxlQ29sdW1ucztcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gT24gZGVza3RvcCwgdXNlIHByZXNldCdzIHJlY29tbWVuZGVkIGNvbHVtbnMgb3IgYmxvY2stc3BlY2lmaWMgb3ZlcnJpZGVcbiAgICAgIGxldCByZWNvbW1lbmRlZENvbHVtbnMgPSAzOyAvLyBEZWZhdWx0IGZvciBncmlkXG4gICAgICBcbiAgICAgIGlmIChzZXR0aW5ncy5wcmVzZXQgPT09ICdkZW5zZScpIHtcbiAgICAgICAgcmVjb21tZW5kZWRDb2x1bW5zID0gNjtcbiAgICAgIH0gZWxzZSBpZiAoc2V0dGluZ3MucHJlc2V0ID09PSAnY29tcGFjdCcpIHtcbiAgICAgICAgcmVjb21tZW5kZWRDb2x1bW5zID0gNDtcbiAgICAgIH0gZWxzZSBpZiAoc2V0dGluZ3MucHJlc2V0ID09PSAnc3F1YXJlJykge1xuICAgICAgICByZWNvbW1lbmRlZENvbHVtbnMgPSA0O1xuICAgICAgfSBlbHNlIGlmIChzZXR0aW5ncy5wcmVzZXQgPT09ICdwb3J0cmFpdCcpIHtcbiAgICAgICAgcmVjb21tZW5kZWRDb2x1bW5zID0gMztcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gVXNlIGJsb2NrLXNwZWNpZmljIGNvbHVtbnMgc2V0dGluZyBpZiBwcm92aWRlZCBpbiB0aGUgY29kZSBibG9ja1xuICAgICAgY29sdW1uc1RvVXNlID0gKGJsb2NrU2V0dGluZ3MuY29sdW1ucyAhPT0gdW5kZWZpbmVkKSA/IGJsb2NrU2V0dGluZ3MuY29sdW1ucyA6IHJlY29tbWVuZGVkQ29sdW1ucztcbiAgICB9XG4gICAgXG4gICAgTG9nZ2VyLmRlYnVnKGBVc2luZyAke2NvbHVtbnNUb1VzZX0gY29sdW1uc2ApO1xuICAgIFxuICAgIC8vIFNldCBjb2x1bW5zIHdpdGggIWltcG9ydGFudCB0byBvdmVycmlkZSBtZWRpYSBxdWVyaWVzXG4gICAgY2FyZHNDb250YWluZXIuc3R5bGUuc2V0UHJvcGVydHkoJy0tY2FyZC1jb2x1bW5zJywgY29sdW1uc1RvVXNlLnRvU3RyaW5nKCksICdpbXBvcnRhbnQnKTtcbiAgICBcbiAgICAvLyBTZXQgaW1hZ2UgaGVpZ2h0IGFuZCBmaXQgYmFzZWQgb24gcHJlc2V0IGlmIG5vdCBleHBsaWNpdGx5IHByb3ZpZGVkXG4gICAgXG4gICAgLy8gRm9yIGltYWdlIGhlaWdodFxuICAgIGxldCBpbWFnZUhlaWdodDtcbiAgICBpZiAoYmxvY2tTZXR0aW5ncy5pbWFnZUhlaWdodCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAvLyBVc2UgZXhwbGljaXRseSBwcm92aWRlZCBoZWlnaHQgZnJvbSBibG9jayBzZXR0aW5nc1xuICAgICAgaW1hZ2VIZWlnaHQgPSBzZXR0aW5ncy5pbWFnZUhlaWdodDtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gVXNlIHByZXNldC1zcGVjaWZpYyBkZWZhdWx0IGhlaWdodFxuICAgICAgaWYgKHNldHRpbmdzLnByZXNldCA9PT0gJ3BvcnRyYWl0Jykge1xuICAgICAgICBpbWFnZUhlaWdodCA9ICczNTBweCc7XG4gICAgICB9IGVsc2UgaWYgKHNldHRpbmdzLnByZXNldCA9PT0gJ3NxdWFyZScpIHtcbiAgICAgICAgaW1hZ2VIZWlnaHQgPSAnMjAwcHgnO1xuICAgICAgfSBlbHNlIGlmIChzZXR0aW5ncy5wcmVzZXQgPT09ICdjb21wYWN0Jykge1xuICAgICAgICBpbWFnZUhlaWdodCA9ICcyMDBweCc7XG4gICAgICB9IGVsc2UgaWYgKHNldHRpbmdzLnByZXNldCA9PT0gJ2RlbnNlJykge1xuICAgICAgICBpbWFnZUhlaWdodCA9ICcxMjBweCc7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBEZWZhdWx0IGZvciBncmlkXG4gICAgICAgIGltYWdlSGVpZ2h0ID0gJzIwMHB4JztcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgLy8gRW5zdXJlIGltYWdlSGVpZ2h0IGhhcyBhIHVuaXQgKHB4KSBpZiBpdCdzIGEgbnVtYmVyIG9yIG51bWVyaWMgc3RyaW5nXG4gICAgaWYgKHR5cGVvZiBpbWFnZUhlaWdodCA9PT0gJ251bWJlcicgfHwgL15cXGQrJC8udGVzdChpbWFnZUhlaWdodCkpIHtcbiAgICAgIGltYWdlSGVpZ2h0ID0gYCR7aW1hZ2VIZWlnaHR9cHhgO1xuICAgIH1cbiAgICBjYXJkc0NvbnRhaW5lci5zdHlsZS5zZXRQcm9wZXJ0eSgnLS1pbWFnZS1oZWlnaHQnLCBpbWFnZUhlaWdodCk7XG4gICAgXG4gICAgLy8gRm9yIGltYWdlIGZpdFxuICAgIGlmIChibG9ja1NldHRpbmdzLmltYWdlRml0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIC8vIFVzZSBleHBsaWNpdGx5IHByb3ZpZGVkIGZpdCBmcm9tIGJsb2NrIHNldHRpbmdzXG4gICAgICBjYXJkc0NvbnRhaW5lci5zdHlsZS5zZXRQcm9wZXJ0eSgnLS1pbWFnZS1maXQnLCBzZXR0aW5ncy5pbWFnZUZpdCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIFVzZSBwcmVzZXQtc3BlY2lmaWMgZGVmYXVsdCBmaXRcbiAgICAgIGNvbnN0IGRlZmF1bHRGaXQgPSBzZXR0aW5ncy5wcmVzZXQgPT09ICdwb3J0cmFpdCcgPyAnY29udGFpbicgOiAnY292ZXInO1xuICAgICAgY2FyZHNDb250YWluZXIuc3R5bGUuc2V0UHJvcGVydHkoJy0taW1hZ2UtZml0JywgZGVmYXVsdEZpdCk7XG4gICAgfVxuICAgIFxuICAgIC8vIEhhbmRsZSBkaWZmZXJlbnQgdHlwZXMgb2YgRGF0YXZpZXcgcmVzdWx0c1xuICAgIGlmIChyZXN1bHRzICYmIHJlc3VsdHMudmFsdWVzICYmIEFycmF5LmlzQXJyYXkocmVzdWx0cy52YWx1ZXMpKSB7XG4gICAgICBMb2dnZXIuZGVidWcoJ0RldGVjdGVkIHRhYmxlLWxpa2UgcmVzdWx0cyB3aXRoIHZhbHVlcyBhcnJheScpO1xuICAgICAgLy8gSGFuZGxlIHRhYmxlLWxpa2UgcmVzdWx0cyAobW9zdCBjb21tb24pXG4gICAgICB0aGlzLnJlbmRlclRhYmxlUmVzdWx0cyhjYXJkc0NvbnRhaW5lciwgcmVzdWx0cywgc2V0dGluZ3MpO1xuICAgIH0gZWxzZSBpZiAocmVzdWx0cyAmJiBBcnJheS5pc0FycmF5KHJlc3VsdHMpKSB7XG4gICAgICBMb2dnZXIuZGVidWcoJ0RldGVjdGVkIGFycmF5IHJlc3VsdHMnKTtcbiAgICAgIC8vIEhhbmRsZSBhcnJheSByZXN1bHRzXG4gICAgICB0aGlzLnJlbmRlckFycmF5UmVzdWx0cyhjYXJkc0NvbnRhaW5lciwgcmVzdWx0cywgc2V0dGluZ3MpO1xuICAgIH0gZWxzZSBpZiAocmVzdWx0cyAmJiB0eXBlb2YgcmVzdWx0cyA9PT0gJ29iamVjdCcpIHtcbiAgICAgIExvZ2dlci5kZWJ1ZygnRGV0ZWN0ZWQgb2JqZWN0IHJlc3VsdHMnKTtcbiAgICAgIC8vIEhhbmRsZSBvYmplY3QgcmVzdWx0c1xuICAgICAgdGhpcy5yZW5kZXJPYmplY3RSZXN1bHRzKGNhcmRzQ29udGFpbmVyLCByZXN1bHRzLCBzZXR0aW5ncyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIExvZ2dlci5kZWJ1ZygnTm8gdmFsaWQgcmVzdWx0cyBkZXRlY3RlZCcpO1xuICAgICAgLy8gSGFuZGxlIGVycm9yIG9yIGVtcHR5IHJlc3VsdHNcbiAgICAgIHRoaXMucmVuZGVyRXJyb3IoY2FyZHNDb250YWluZXIsICdObyByZXN1bHRzIG9yIHVuc3VwcG9ydGVkIHJlc3VsdCB0eXBlJyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFJlbmRlciBhbiBlcnJvciBtZXNzYWdlXG4gICAqIFxuICAgKiBAcGFyYW0gY29udGFpbmVyIFRoZSBjb250YWluZXIgZWxlbWVudFxuICAgKiBAcGFyYW0gbWVzc2FnZSBUaGUgZXJyb3IgbWVzc2FnZVxuICAgKi9cbiAgcHJpdmF0ZSByZW5kZXJFcnJvcihjb250YWluZXI6IEhUTUxFbGVtZW50LCBtZXNzYWdlOiBzdHJpbmcpOiB2b2lkIHtcbiAgICBjb25zdCBlcnJvckVsID0gY29udGFpbmVyLmNyZWF0ZUVsKCdkaXYnLCB7XG4gICAgICBjbHM6ICdkYXRhY2FyZHMtZXJyb3InLFxuICAgICAgdGV4dDogbWVzc2FnZSxcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZW5kZXIgdGFibGUtbGlrZSBEYXRhdmlldyByZXN1bHRzXG4gICAqIFxuICAgKiBAcGFyYW0gY29udGFpbmVyIFRoZSBjb250YWluZXIgZWxlbWVudFxuICAgKiBAcGFyYW0gcmVzdWx0cyBUaGUgRGF0YXZpZXcgdGFibGUgcmVzdWx0c1xuICAgKiBAcGFyYW0gc2V0dGluZ3MgVGhlIG1lcmdlZCBzZXR0aW5nc1xuICAgKi9cbiAgcHJpdmF0ZSByZW5kZXJUYWJsZVJlc3VsdHMoY29udGFpbmVyOiBIVE1MRWxlbWVudCwgcmVzdWx0czogYW55LCBzZXR0aW5nczogRGF0YUNhcmRzU2V0dGluZ3MpOiB2b2lkIHtcbiAgICBjb25zdCB7IHZhbHVlcywgaGVhZGVycyB9ID0gcmVzdWx0cztcbiAgICBcbiAgICAvLyBFbmhhbmNlZCBkZWJ1ZyBsb2dnaW5nIGZvciB0YWJsZSBzdHJ1Y3R1cmVcbiAgICBMb2dnZXIuZGVidWcoJ1JlbmRlcmluZyB0YWJsZSByZXN1bHRzOicpO1xuICAgIExvZ2dlci5kZWJ1ZygnLSBIZWFkZXJzOicsIGhlYWRlcnMpO1xuICAgIExvZ2dlci5kZWJ1ZygnLSBOdW1iZXIgb2Ygcm93czonLCB2YWx1ZXMubGVuZ3RoKTtcbiAgICBcbiAgICAvLyBDcmVhdGUgYSBjYXJkIGZvciBlYWNoIHJvd1xuICAgIHZhbHVlcy5mb3JFYWNoKChyb3c6IGFueVtdLCByb3dJbmRleDogbnVtYmVyKSA9PiB7XG4gICAgICBMb2dnZXIuZGVidWcoYFByb2Nlc3Npbmcgcm93ICR7cm93SW5kZXh9YCk7XG4gICAgICBjb25zdCBjYXJkID0gdGhpcy5jcmVhdGVDYXJkRWxlbWVudChjb250YWluZXIpO1xuICAgICAgXG4gICAgICAvLyBBZGQgaW1hZ2UgaWYgYXZhaWxhYmxlXG4gICAgICBpZiAoc2V0dGluZ3MuaW1hZ2VQcm9wZXJ0eSAmJiBoZWFkZXJzLmluY2x1ZGVzKHNldHRpbmdzLmltYWdlUHJvcGVydHkpKSB7XG4gICAgICAgIGNvbnN0IGltYWdlSW5kZXggPSBoZWFkZXJzLmluZGV4T2Yoc2V0dGluZ3MuaW1hZ2VQcm9wZXJ0eSk7XG4gICAgICAgIGNvbnN0IGltYWdlVmFsdWUgPSByb3dbaW1hZ2VJbmRleF07XG4gICAgICAgIExvZ2dlci5kZWJ1ZyhgSW1hZ2UgcHJvcGVydHkgJyR7c2V0dGluZ3MuaW1hZ2VQcm9wZXJ0eX0nIHZhbHVlOmAsIGltYWdlVmFsdWUpO1xuICAgICAgICBpZiAoaW1hZ2VWYWx1ZSkge1xuICAgICAgICAgIHRoaXMuYWRkSW1hZ2VUb0NhcmQoY2FyZCwgaW1hZ2VWYWx1ZSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAoc2V0dGluZ3MuaW1hZ2VQcm9wZXJ0eSkge1xuICAgICAgICBMb2dnZXIuZGVidWcoYEltYWdlIHByb3BlcnR5ICcke3NldHRpbmdzLmltYWdlUHJvcGVydHl9JyBub3QgZm91bmQgaW4gaGVhZGVyczpgLCBoZWFkZXJzKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gQWRkIGNvbnRlbnQgY29udGFpbmVyXG4gICAgICBjb25zdCBjb250ZW50RWwgPSBjYXJkLmNyZWF0ZUVsKCdkaXYnLCB7IGNsczogJ2RhdGFjYXJkcy1jb250ZW50JyB9KTtcbiAgICAgIFxuICAgICAgLy8gRmlyc3QsIGFkZCB0aGUgZmlsZSBwcm9wZXJ0eSBzZXBhcmF0ZWx5IGlmIGl0IGV4aXN0cyBpbiBoZWFkZXJzXG4gICAgICAvLyBUaGlzIGVuc3VyZXMgaXQncyBhbHdheXMgZGlzcGxheWVkIGZpcnN0LCBkaXJlY3RseSB1bmRlciB0aGUgaW1hZ2VcbiAgICAgIGlmIChoZWFkZXJzLmluY2x1ZGVzKCdGaWxlJykgfHwgaGVhZGVycy5pbmNsdWRlcygnZmlsZScpKSB7XG4gICAgICAgIGNvbnN0IGZpbGVJbmRleCA9IGhlYWRlcnMuZmluZEluZGV4KChoOiBzdHJpbmcpID0+IGgudG9Mb3dlckNhc2UoKSA9PT0gJ2ZpbGUnKTtcbiAgICAgICAgaWYgKGZpbGVJbmRleCA+PSAwKSB7XG4gICAgICAgICAgY29uc3QgZmlsZVZhbHVlID0gcm93W2ZpbGVJbmRleF07XG4gICAgICAgICAgTG9nZ2VyLmRlYnVnKCdGaWxlIHByb3BlcnR5IHZhbHVlOicsIGZpbGVWYWx1ZSk7XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gQWRkIGZpbGUgcHJvcGVydHkgd2l0aCBzcGVjaWFsIHN0eWxpbmdcbiAgICAgICAgICBjb25zdCBmaWxlUHJvcGVydHlFbCA9IGNvbnRlbnRFbC5jcmVhdGVFbCgnZGl2Jywge1xuICAgICAgICAgICAgY2xzOiAnZGF0YWNhcmRzLXByb3BlcnR5IGRhdGFjYXJkcy1maWxlLXByb3BlcnR5LWNvbnRhaW5lcicsXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gRG9uJ3Qgc2hvdyBsYWJlbCBmb3IgZmlsZSBwcm9wZXJ0eVxuICAgICAgICAgIHRoaXMuZm9ybWF0RmlsZVByb3BlcnR5KGZpbGVQcm9wZXJ0eUVsLCBmaWxlVmFsdWUpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIENyZWF0ZSBhIHByb3BlcnRpZXMgY29udGFpbmVyXG4gICAgICBjb25zdCBwcm9wZXJ0aWVzQ29udGFpbmVyID0gY29udGVudEVsLmNyZWF0ZUVsKCdkaXYnLCB7XG4gICAgICAgIGNsczogJ2RhdGFjYXJkcy1wcm9wZXJ0aWVzLWNvbnRhaW5lcicsXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgLy8gRGV0ZXJtaW5lIGlmIHByb3BlcnRpZXMgc2hvdWxkIGJlIHNjcm9sbGFibGVcbiAgICAgIGNvbnN0IHNob3VsZFNjcm9sbCA9IHRoaXMuc2hvdWxkVXNlU2Nyb2xsYWJsZVByb3BlcnRpZXMoc2V0dGluZ3MpO1xuICAgICAgXG4gICAgICAvLyBBcHBseSBzY3JvbGxhYmxlIGNsYXNzIGFuZCBoZWlnaHQgaWYgbmVlZGVkXG4gICAgICBpZiAoc2hvdWxkU2Nyb2xsKSB7XG4gICAgICAgIHByb3BlcnRpZXNDb250YWluZXIuYWRkQ2xhc3MoJ2RhdGFjYXJkcy1zY3JvbGxhYmxlLXByb3BlcnRpZXMnKTtcbiAgICAgICAgXG4gICAgICAgIC8vIFNldCBjb250ZW50IGhlaWdodCBhcyBDU1MgdmFyaWFibGVcbiAgICAgICAgY29uc3QgY29udGVudEhlaWdodCA9IHRoaXMuZ2V0Q29udGVudEhlaWdodChzZXR0aW5ncyk7XG4gICAgICAgIHByb3BlcnRpZXNDb250YWluZXIuc3R5bGUuc2V0UHJvcGVydHkoJy0tY29udGVudC1oZWlnaHQnLCBjb250ZW50SGVpZ2h0KTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gQWRkIHByb3BlcnRpZXNcbiAgICAgIGxldCBwcm9wZXJ0aWVzVG9TaG93OiBzdHJpbmdbXSA9IFtdO1xuICAgICAgXG4gICAgICBpZiAoc2V0dGluZ3MucHJvcGVydGllcyA9PT0gJ2FsbCcpIHtcbiAgICAgICAgcHJvcGVydGllc1RvU2hvdyA9IFsuLi5oZWFkZXJzXTtcbiAgICAgICAgTG9nZ2VyLmRlYnVnKCdVc2luZyBhbGwgaGVhZGVycyBhcyBwcm9wZXJ0aWVzOicsIHByb3BlcnRpZXNUb1Nob3cpO1xuICAgICAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KHNldHRpbmdzLnByb3BlcnRpZXMpKSB7XG4gICAgICAgIHByb3BlcnRpZXNUb1Nob3cgPSBbLi4uc2V0dGluZ3MucHJvcGVydGllc107XG4gICAgICAgIExvZ2dlci5kZWJ1ZygnVXNpbmcgc3BlY2lmaWVkIHByb3BlcnRpZXM6JywgcHJvcGVydGllc1RvU2hvdyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBMb2dnZXIuZGVidWcoJ05vIHByb3BlcnRpZXMgc3BlY2lmaWVkLCB1c2luZyBlbXB0eSBhcnJheScpO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBGaWx0ZXIgb3V0IGV4Y2x1ZGVkIHByb3BlcnRpZXMgYW5kIHRoZSBmaWxlIHByb3BlcnR5ICh3ZSBhbHJlYWR5IGFkZGVkIGl0KVxuICAgICAgbGV0IGZpbHRlcmVkUHJvcGVydGllcyA9IHByb3BlcnRpZXNUb1Nob3cuZmlsdGVyKChwcm9wOiBzdHJpbmcpID0+IFxuICAgICAgICAhc2V0dGluZ3MuZXhjbHVkZS5pbmNsdWRlcyhwcm9wKSAmJiBcbiAgICAgICAgcHJvcCAhPT0gc2V0dGluZ3MuaW1hZ2VQcm9wZXJ0eSAmJlxuICAgICAgICBwcm9wLnRvTG93ZXJDYXNlKCkgIT09ICdmaWxlJyAvLyBFeGNsdWRlIGZpbGUgcHJvcGVydHkgaGVyZSwgd2UgYWxyZWFkeSBhZGRlZCBpdCBzZXBhcmF0ZWx5XG4gICAgICApO1xuICAgICAgXG4gICAgICBMb2dnZXIuZGVidWcoJ0ZpbHRlcmVkIHByb3BlcnRpZXMgKGFmdGVyIGV4Y2x1ZGluZyBmaWxlKTonLCBmaWx0ZXJlZFByb3BlcnRpZXMpO1xuICAgICAgXG4gICAgICAvLyBBZGQgZWFjaCBwcm9wZXJ0eSB0byB0aGUgcHJvcGVydGllcyBjb250YWluZXJcbiAgICAgIGZpbHRlcmVkUHJvcGVydGllcy5mb3JFYWNoKChwcm9wZXJ0eTogc3RyaW5nKSA9PiB7XG4gICAgICAgIExvZ2dlci5kZWJ1ZyhgQ2hlY2tpbmcgcHJvcGVydHkgJyR7cHJvcGVydHl9JyBpbiBoZWFkZXJzOmAsIGhlYWRlcnMuaW5jbHVkZXMocHJvcGVydHkpKTtcbiAgICAgICAgaWYgKGhlYWRlcnMuaW5jbHVkZXMocHJvcGVydHkpKSB7XG4gICAgICAgICAgY29uc3QgcHJvcEluZGV4ID0gaGVhZGVycy5pbmRleE9mKHByb3BlcnR5KTtcbiAgICAgICAgICBjb25zdCBwcm9wVmFsdWUgPSByb3dbcHJvcEluZGV4XTtcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBMb2cgdGhlIHByb3BlcnR5IHZhbHVlIGZvciBkZWJ1Z2dpbmdcbiAgICAgICAgICBjb25zb2xlLmxvZyhgUHJvcGVydHkgJyR7cHJvcGVydHl9JyB2YWx1ZTpgLCBwcm9wVmFsdWUpO1xuICAgICAgICAgIGNvbnNvbGUubG9nKGBQcm9wZXJ0eSAnJHtwcm9wZXJ0eX0nIHR5cGU6YCwgdHlwZW9mIHByb3BWYWx1ZSk7XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gU3BlY2lhbCBoYW5kbGluZyBmb3Igd2lraSBsaW5rcyBpbiBwcm9wZXJ0eSB2YWx1ZXNcbiAgICAgICAgICBpZiAodHlwZW9mIHByb3BWYWx1ZSA9PT0gJ3N0cmluZycgJiYgcHJvcFZhbHVlLmluY2x1ZGVzKCdbWycpICYmIHByb3BWYWx1ZS5pbmNsdWRlcygnXV0nKSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coYEZvdW5kIHdpa2kgbGluayBpbiBwcm9wZXJ0eSAnJHtwcm9wZXJ0eX0nOmAsIHByb3BWYWx1ZSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIENyZWF0ZSBhIHNwZWNpYWwgcHJvcGVydHkgZWxlbWVudCBmb3Igd2lraSBsaW5rc1xuICAgICAgICAgICAgY29uc3QgcHJvcGVydHlFbCA9IHByb3BlcnRpZXNDb250YWluZXIuY3JlYXRlRWwoJ2RpdicsIHtcbiAgICAgICAgICAgICAgY2xzOiAnZGF0YWNhcmRzLXByb3BlcnR5JyxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBBZGQgbGFiZWwgaWYgZW5hYmxlZFxuICAgICAgICAgICAgaWYgKHNldHRpbmdzLnNob3dMYWJlbHMpIHtcbiAgICAgICAgICAgICAgcHJvcGVydHlFbC5jcmVhdGVFbCgnZGl2Jywge1xuICAgICAgICAgICAgICAgIGNsczogJ2RhdGFjYXJkcy1wcm9wZXJ0eS1sYWJlbCcsXG4gICAgICAgICAgICAgICAgdGV4dDogcHJvcGVydHksXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBDcmVhdGUgdmFsdWUgY29udGFpbmVyXG4gICAgICAgICAgICBjb25zdCB2YWx1ZUVsID0gcHJvcGVydHlFbC5jcmVhdGVFbCgnZGl2Jywge1xuICAgICAgICAgICAgICBjbHM6ICdkYXRhY2FyZHMtcHJvcGVydHktdmFsdWUnLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIEV4dHJhY3QgcGF0aCBhbmQgZGlzcGxheSB0ZXh0IGZyb20gd2lraSBsaW5rXG4gICAgICAgICAgICBjb25zdCB3aWtpTGlua01hdGNoID0gcHJvcFZhbHVlLm1hdGNoKC9cXFtcXFsoW15cXF18XSspKD86XFx8KFteXFxdXSspKT9cXF1cXF0vKTtcbiAgICAgICAgICAgIGlmICh3aWtpTGlua01hdGNoKSB7XG4gICAgICAgICAgICAgIGNvbnN0IHBhdGggPSB3aWtpTGlua01hdGNoWzFdO1xuICAgICAgICAgICAgICBjb25zdCBkaXNwbGF5VGV4dCA9IHdpa2lMaW5rTWF0Y2hbMl0gfHwgdGhpcy5nZXRDbGVhbkZpbGVuYW1lKHBhdGgpO1xuICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coYENyZWF0aW5nIGRpcmVjdCBsaW5rIGZvciB3aWtpIGxpbms6IHBhdGg9XCIke3BhdGh9XCIsIGRpc3BsYXk9XCIke2Rpc3BsYXlUZXh0fVwiYCk7XG4gICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAvLyBDcmVhdGUgbGluayBlbGVtZW50IGRpcmVjdGx5XG4gICAgICAgICAgICAgIGNvbnN0IGxpbmsgPSB2YWx1ZUVsLmNyZWF0ZUVsKCdhJywge1xuICAgICAgICAgICAgICAgIGNsczogJ2ludGVybmFsLWxpbmsnLFxuICAgICAgICAgICAgICAgIHRleHQ6IGRpc3BsYXlUZXh0LFxuICAgICAgICAgICAgICAgIGF0dHI6IHsgXG4gICAgICAgICAgICAgICAgICBocmVmOiBwYXRoLFxuICAgICAgICAgICAgICAgICAgJ2RhdGEtaHJlZic6IHBhdGgsXG4gICAgICAgICAgICAgICAgICAnZGF0YS10eXBlJzogJ2xpbmsnXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgIC8vIFJlZ2lzdGVyIHRoZSBsaW5rIHdpdGggT2JzaWRpYW4ncyBjbGljayBoYW5kbGVyXG4gICAgICAgICAgICAgIHRoaXMuYXBwLndvcmtzcGFjZS50cmlnZ2VyKCdob3Zlci1saW5rJywge1xuICAgICAgICAgICAgICAgIGV2ZW50OiBuZXcgTW91c2VFdmVudCgnbW91c2VvdmVyJyksXG4gICAgICAgICAgICAgICAgc291cmNlOiAncHJldmlldycsXG4gICAgICAgICAgICAgICAgaG92ZXJFbDogbGluayxcbiAgICAgICAgICAgICAgICB0YXJnZXRFbDogbGluayxcbiAgICAgICAgICAgICAgICBsaW5rdGV4dDogcGF0aFxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIC8vIEZhbGxiYWNrIHRvIHJlZ3VsYXIgdGV4dCBpZiB3ZSBjYW4ndCBwYXJzZSB0aGUgd2lraSBsaW5rXG4gICAgICAgICAgICAgIHZhbHVlRWwuc2V0VGV4dChwcm9wVmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBVc2UgdGhlIHN0YW5kYXJkIHByb3BlcnR5IGZvcm1hdHRpbmcgZm9yIG5vbi13aWtpIGxpbmtzXG4gICAgICAgICAgICB0aGlzLmFkZFByb3BlcnR5VG9DYXJkKHByb3BlcnRpZXNDb250YWluZXIsIHByb3BlcnR5LCBwcm9wVmFsdWUsIHNldHRpbmdzKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgTG9nZ2VyLmRlYnVnKGBQcm9wZXJ0eSAnJHtwcm9wZXJ0eX0nIG5vdCBmb3VuZCBpbiBoZWFkZXJzYCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgXG4gICAgICAvLyBJZiBubyBwcm9wZXJ0aWVzIHdlcmUgYWRkZWQsIGFkZCBhIGRlYnVnIG1lc3NhZ2VcbiAgICAgIGlmIChmaWx0ZXJlZFByb3BlcnRpZXMubGVuZ3RoID09PSAwICYmICFoZWFkZXJzLnNvbWUoKGg6IHN0cmluZykgPT4gaC50b0xvd2VyQ2FzZSgpID09PSAnZmlsZScpKSB7XG4gICAgICAgIExvZ2dlci5kZWJ1ZygnTm8gcHJvcGVydGllcyB3ZXJlIGFkZGVkIHRvIHRoZSBjYXJkJyk7XG4gICAgICAgIGNvbnRlbnRFbC5jcmVhdGVFbCgnZGl2Jywge1xuICAgICAgICAgIGNsczogJ2RhdGFjYXJkcy1wcm9wZXJ0eScsXG4gICAgICAgICAgdGV4dDogJ05vIHByb3BlcnRpZXMgdG8gZGlzcGxheSdcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogUmVuZGVyIGFycmF5IERhdGF2aWV3IHJlc3VsdHNcbiAgICogXG4gICAqIEBwYXJhbSBjb250YWluZXIgVGhlIGNvbnRhaW5lciBlbGVtZW50XG4gICAqIEBwYXJhbSByZXN1bHRzIFRoZSBEYXRhdmlldyBhcnJheSByZXN1bHRzXG4gICAqIEBwYXJhbSBzZXR0aW5ncyBUaGUgbWVyZ2VkIHNldHRpbmdzXG4gICAqL1xuICBwcml2YXRlIHJlbmRlckFycmF5UmVzdWx0cyhjb250YWluZXI6IEhUTUxFbGVtZW50LCByZXN1bHRzOiBhbnlbXSwgc2V0dGluZ3M6IERhdGFDYXJkc1NldHRpbmdzKTogdm9pZCB7XG4gICAgLy8gQ3JlYXRlIGEgY2FyZCBmb3IgZWFjaCBpdGVtIGluIHRoZSBhcnJheVxuICAgIHJlc3VsdHMuZm9yRWFjaCgoaXRlbTogYW55KSA9PiB7XG4gICAgICBjb25zdCBjYXJkID0gdGhpcy5jcmVhdGVDYXJkRWxlbWVudChjb250YWluZXIpO1xuICAgICAgXG4gICAgICAvLyBBZGQgaW1hZ2UgaWYgYXZhaWxhYmxlXG4gICAgICBpZiAoc2V0dGluZ3MuaW1hZ2VQcm9wZXJ0eSAmJiBpdGVtW3NldHRpbmdzLmltYWdlUHJvcGVydHldKSB7XG4gICAgICAgIHRoaXMuYWRkSW1hZ2VUb0NhcmQoY2FyZCwgaXRlbVtzZXR0aW5ncy5pbWFnZVByb3BlcnR5XSk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIEFkZCBjb250ZW50IGNvbnRhaW5lclxuICAgICAgY29uc3QgY29udGVudEVsID0gY2FyZC5jcmVhdGVFbCgnZGl2JywgeyBjbHM6ICdkYXRhY2FyZHMtY29udGVudCcgfSk7XG4gICAgICBcbiAgICAgIC8vIEZpcnN0LCBhZGQgdGhlIGZpbGUgcHJvcGVydHkgc2VwYXJhdGVseSBpZiBpdCBleGlzdHNcbiAgICAgIGlmICgnZmlsZScgaW4gaXRlbSkge1xuICAgICAgICBjb25zdCBmaWxlUHJvcGVydHlFbCA9IGNvbnRlbnRFbC5jcmVhdGVFbCgnZGl2Jywge1xuICAgICAgICAgIGNsczogJ2RhdGFjYXJkcy1wcm9wZXJ0eSBkYXRhY2FyZHMtZmlsZS1wcm9wZXJ0eS1jb250YWluZXInLFxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIHRoaXMuZm9ybWF0RmlsZVByb3BlcnR5KGZpbGVQcm9wZXJ0eUVsLCBpdGVtWydmaWxlJ10pO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBDcmVhdGUgYSBwcm9wZXJ0aWVzIGNvbnRhaW5lclxuICAgICAgY29uc3QgcHJvcGVydGllc0NvbnRhaW5lciA9IGNvbnRlbnRFbC5jcmVhdGVFbCgnZGl2Jywge1xuICAgICAgICBjbHM6ICdkYXRhY2FyZHMtcHJvcGVydGllcy1jb250YWluZXInLFxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIC8vIERldGVybWluZSBpZiBwcm9wZXJ0aWVzIHNob3VsZCBiZSBzY3JvbGxhYmxlXG4gICAgICBjb25zdCBzaG91bGRTY3JvbGwgPSB0aGlzLnNob3VsZFVzZVNjcm9sbGFibGVQcm9wZXJ0aWVzKHNldHRpbmdzKTtcbiAgICAgIFxuICAgICAgLy8gQXBwbHkgc2Nyb2xsYWJsZSBjbGFzcyBhbmQgaGVpZ2h0IGlmIG5lZWRlZFxuICAgICAgaWYgKHNob3VsZFNjcm9sbCkge1xuICAgICAgICBwcm9wZXJ0aWVzQ29udGFpbmVyLmFkZENsYXNzKCdkYXRhY2FyZHMtc2Nyb2xsYWJsZS1wcm9wZXJ0aWVzJyk7XG4gICAgICAgIFxuICAgICAgICAvLyBTZXQgY29udGVudCBoZWlnaHQgYXMgQ1NTIHZhcmlhYmxlXG4gICAgICAgIGNvbnN0IGNvbnRlbnRIZWlnaHQgPSB0aGlzLmdldENvbnRlbnRIZWlnaHQoc2V0dGluZ3MpO1xuICAgICAgICBwcm9wZXJ0aWVzQ29udGFpbmVyLnN0eWxlLnNldFByb3BlcnR5KCctLWNvbnRlbnQtaGVpZ2h0JywgY29udGVudEhlaWdodCk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIERldGVybWluZSB3aGljaCBwcm9wZXJ0aWVzIHRvIHNob3dcbiAgICAgIGNvbnN0IGFsbFByb3BlcnRpZXMgPSBPYmplY3Qua2V5cyhpdGVtKTtcbiAgICAgIGNvbnN0IHByb3BlcnRpZXNUb1Nob3cgPSBzZXR0aW5ncy5wcm9wZXJ0aWVzID09PSAnYWxsJyBcbiAgICAgICAgPyBhbGxQcm9wZXJ0aWVzIFxuICAgICAgICA6IEFycmF5LmlzQXJyYXkoc2V0dGluZ3MucHJvcGVydGllcykgPyBzZXR0aW5ncy5wcm9wZXJ0aWVzIDogW107XG4gICAgICBcbiAgICAgIC8vIEZpbHRlciBvdXQgZXhjbHVkZWQgcHJvcGVydGllcyBhbmQgdGhlIGZpbGUgcHJvcGVydHlcbiAgICAgIGNvbnN0IGZpbHRlcmVkUHJvcGVydGllcyA9IHByb3BlcnRpZXNUb1Nob3cuZmlsdGVyKChwcm9wOiBzdHJpbmcpID0+IFxuICAgICAgICAhc2V0dGluZ3MuZXhjbHVkZS5pbmNsdWRlcyhwcm9wKSAmJiBcbiAgICAgICAgcHJvcCAhPT0gc2V0dGluZ3MuaW1hZ2VQcm9wZXJ0eSAmJlxuICAgICAgICBwcm9wLnRvTG93ZXJDYXNlKCkgIT09ICdmaWxlJ1xuICAgICAgKTtcbiAgICAgIFxuICAgICAgLy8gQWRkIGVhY2ggcHJvcGVydHkgdG8gdGhlIHByb3BlcnRpZXMgY29udGFpbmVyXG4gICAgICBmaWx0ZXJlZFByb3BlcnRpZXMuZm9yRWFjaCgocHJvcGVydHk6IHN0cmluZykgPT4ge1xuICAgICAgICBpZiAocHJvcGVydHkgaW4gaXRlbSkge1xuICAgICAgICAgIHRoaXMuYWRkUHJvcGVydHlUb0NhcmQocHJvcGVydGllc0NvbnRhaW5lciwgcHJvcGVydHksIGl0ZW1bcHJvcGVydHldLCBzZXR0aW5ncyk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlbmRlciBvYmplY3QgRGF0YXZpZXcgcmVzdWx0c1xuICAgKiBcbiAgICogQHBhcmFtIGNvbnRhaW5lciBUaGUgY29udGFpbmVyIGVsZW1lbnRcbiAgICogQHBhcmFtIHJlc3VsdHMgVGhlIERhdGF2aWV3IG9iamVjdCByZXN1bHRzXG4gICAqIEBwYXJhbSBzZXR0aW5ncyBUaGUgbWVyZ2VkIHNldHRpbmdzXG4gICAqL1xuICBwcml2YXRlIHJlbmRlck9iamVjdFJlc3VsdHMoY29udGFpbmVyOiBIVE1MRWxlbWVudCwgcmVzdWx0czogYW55LCBzZXR0aW5nczogRGF0YUNhcmRzU2V0dGluZ3MpOiB2b2lkIHtcbiAgICAvLyBDcmVhdGUgYSBzaW5nbGUgY2FyZCBmb3IgdGhlIG9iamVjdFxuICAgIGNvbnN0IGNhcmQgPSB0aGlzLmNyZWF0ZUNhcmRFbGVtZW50KGNvbnRhaW5lcik7XG4gICAgXG4gICAgLy8gQWRkIGltYWdlIGlmIGF2YWlsYWJsZVxuICAgIGlmIChzZXR0aW5ncy5pbWFnZVByb3BlcnR5ICYmIHJlc3VsdHNbc2V0dGluZ3MuaW1hZ2VQcm9wZXJ0eV0pIHtcbiAgICAgIHRoaXMuYWRkSW1hZ2VUb0NhcmQoY2FyZCwgcmVzdWx0c1tzZXR0aW5ncy5pbWFnZVByb3BlcnR5XSk7XG4gICAgfVxuICAgIFxuICAgICAgLy8gQWRkIGNvbnRlbnQgY29udGFpbmVyXG4gICAgICBjb25zdCBjb250ZW50RWwgPSBjYXJkLmNyZWF0ZUVsKCdkaXYnLCB7IGNsczogJ2RhdGFjYXJkcy1jb250ZW50JyB9KTtcbiAgICAgIFxuICAgICAgLy8gRmlyc3QsIGFkZCB0aGUgZmlsZSBwcm9wZXJ0eSBzZXBhcmF0ZWx5IGlmIGl0IGV4aXN0c1xuICAgICAgaWYgKCdmaWxlJyBpbiByZXN1bHRzKSB7XG4gICAgICAgIGNvbnN0IGZpbGVQcm9wZXJ0eUVsID0gY29udGVudEVsLmNyZWF0ZUVsKCdkaXYnLCB7XG4gICAgICAgICAgY2xzOiAnZGF0YWNhcmRzLXByb3BlcnR5IGRhdGFjYXJkcy1maWxlLXByb3BlcnR5LWNvbnRhaW5lcicsXG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgdGhpcy5mb3JtYXRGaWxlUHJvcGVydHkoZmlsZVByb3BlcnR5RWwsIHJlc3VsdHNbJ2ZpbGUnXSk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIENyZWF0ZSBhIHByb3BlcnRpZXMgY29udGFpbmVyXG4gICAgICBjb25zdCBwcm9wZXJ0aWVzQ29udGFpbmVyID0gY29udGVudEVsLmNyZWF0ZUVsKCdkaXYnLCB7XG4gICAgICAgIGNsczogJ2RhdGFjYXJkcy1wcm9wZXJ0aWVzLWNvbnRhaW5lcicsXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgLy8gRGV0ZXJtaW5lIGlmIHByb3BlcnRpZXMgc2hvdWxkIGJlIHNjcm9sbGFibGVcbiAgICAgIGNvbnN0IHNob3VsZFNjcm9sbCA9IHRoaXMuc2hvdWxkVXNlU2Nyb2xsYWJsZVByb3BlcnRpZXMoc2V0dGluZ3MpO1xuICAgICAgXG4gICAgICAvLyBBcHBseSBzY3JvbGxhYmxlIGNsYXNzIGFuZCBoZWlnaHQgaWYgbmVlZGVkXG4gICAgICBpZiAoc2hvdWxkU2Nyb2xsKSB7XG4gICAgICAgIHByb3BlcnRpZXNDb250YWluZXIuYWRkQ2xhc3MoJ2RhdGFjYXJkcy1zY3JvbGxhYmxlLXByb3BlcnRpZXMnKTtcbiAgICAgICAgXG4gICAgICAgIC8vIFNldCBjb250ZW50IGhlaWdodCBhcyBDU1MgdmFyaWFibGVcbiAgICAgICAgY29uc3QgY29udGVudEhlaWdodCA9IHRoaXMuZ2V0Q29udGVudEhlaWdodChzZXR0aW5ncyk7XG4gICAgICAgIHByb3BlcnRpZXNDb250YWluZXIuc3R5bGUuc2V0UHJvcGVydHkoJy0tY29udGVudC1oZWlnaHQnLCBjb250ZW50SGVpZ2h0KTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gRGV0ZXJtaW5lIHdoaWNoIHByb3BlcnRpZXMgdG8gc2hvd1xuICAgICAgY29uc3QgYWxsUHJvcGVydGllcyA9IE9iamVjdC5rZXlzKHJlc3VsdHMpO1xuICAgICAgY29uc3QgcHJvcGVydGllc1RvU2hvdyA9IHNldHRpbmdzLnByb3BlcnRpZXMgPT09ICdhbGwnIFxuICAgICAgICA/IGFsbFByb3BlcnRpZXMgXG4gICAgICAgIDogQXJyYXkuaXNBcnJheShzZXR0aW5ncy5wcm9wZXJ0aWVzKSA/IHNldHRpbmdzLnByb3BlcnRpZXMgOiBbXTtcbiAgICAgIFxuICAgICAgLy8gRmlsdGVyIG91dCBleGNsdWRlZCBwcm9wZXJ0aWVzIGFuZCB0aGUgZmlsZSBwcm9wZXJ0eVxuICAgICAgY29uc3QgZmlsdGVyZWRQcm9wZXJ0aWVzID0gcHJvcGVydGllc1RvU2hvdy5maWx0ZXIoKHByb3A6IHN0cmluZykgPT4gXG4gICAgICAgICFzZXR0aW5ncy5leGNsdWRlLmluY2x1ZGVzKHByb3ApICYmIFxuICAgICAgICBwcm9wICE9PSBzZXR0aW5ncy5pbWFnZVByb3BlcnR5ICYmXG4gICAgICAgIHByb3AudG9Mb3dlckNhc2UoKSAhPT0gJ2ZpbGUnXG4gICAgICApO1xuICAgICAgXG4gICAgICAvLyBBZGQgZWFjaCBwcm9wZXJ0eSB0byB0aGUgcHJvcGVydGllcyBjb250YWluZXJcbiAgICAgIGZpbHRlcmVkUHJvcGVydGllcy5mb3JFYWNoKChwcm9wZXJ0eTogc3RyaW5nKSA9PiB7XG4gICAgICAgIGlmIChwcm9wZXJ0eSBpbiByZXN1bHRzKSB7XG4gICAgICAgICAgdGhpcy5hZGRQcm9wZXJ0eVRvQ2FyZChwcm9wZXJ0aWVzQ29udGFpbmVyLCBwcm9wZXJ0eSwgcmVzdWx0c1twcm9wZXJ0eV0sIHNldHRpbmdzKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIGEgY2FyZCBlbGVtZW50XG4gICAqIFxuICAgKiBAcGFyYW0gY29udGFpbmVyIFRoZSBjb250YWluZXIgdG8gYWRkIHRoZSBjYXJkIHRvXG4gICAqIEByZXR1cm5zIFRoZSBjcmVhdGVkIGNhcmQgZWxlbWVudFxuICAgKi9cbiAgcHJpdmF0ZSBjcmVhdGVDYXJkRWxlbWVudChjb250YWluZXI6IEhUTUxFbGVtZW50KTogSFRNTEVsZW1lbnQge1xuICAgIHJldHVybiBjb250YWluZXIuY3JlYXRlRWwoJ2RpdicsIHtcbiAgICAgIGNsczogJ2RhdGFjYXJkcy1jYXJkJyxcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGQgYW4gaW1hZ2UgdG8gYSBjYXJkXG4gICAqIFxuICAgKiBAcGFyYW0gY2FyZCBUaGUgY2FyZCBlbGVtZW50XG4gICAqIEBwYXJhbSBpbWFnZVZhbHVlIFRoZSBpbWFnZSB2YWx1ZSAocGF0aCwgVVJMLCBvciBMaW5rIG9iamVjdClcbiAgICovXG4gIHByaXZhdGUgYWRkSW1hZ2VUb0NhcmQoY2FyZDogSFRNTEVsZW1lbnQsIGltYWdlVmFsdWU6IGFueSk6IHZvaWQge1xuICAgIGNvbnN0IGltYWdlQ29udGFpbmVyID0gY2FyZC5jcmVhdGVFbCgnZGl2Jywge1xuICAgICAgY2xzOiAnZGF0YWNhcmRzLWltYWdlLWNvbnRhaW5lcicsXG4gICAgfSk7XG4gICAgXG4gICAgLy8gSGFuZGxlIERhdGF2aWV3IExpbmsgb2JqZWN0c1xuICAgIGxldCBpbWFnZVBhdGg6IHN0cmluZztcbiAgICBcbiAgICBpZiAodHlwZW9mIGltYWdlVmFsdWUgPT09ICdvYmplY3QnICYmIGltYWdlVmFsdWUgIT09IG51bGwpIHtcbiAgICAgIExvZ2dlci5kZWJ1ZygnSW1hZ2UgdmFsdWUgaXMgYW4gb2JqZWN0OicsIGltYWdlVmFsdWUpO1xuICAgICAgXG4gICAgICAvLyBIYW5kbGUgRGF0YXZpZXcgTGluayBvYmplY3RzIHdoaWNoIGhhdmUgYSBwYXRoIHByb3BlcnR5XG4gICAgICBpZiAoJ3BhdGgnIGluIGltYWdlVmFsdWUpIHtcbiAgICAgICAgaW1hZ2VQYXRoID0gaW1hZ2VWYWx1ZS5wYXRoO1xuICAgICAgICBMb2dnZXIuZGVidWcoJ0V4dHJhY3RlZCBwYXRoIGZyb20gTGluayBvYmplY3Q6JywgaW1hZ2VQYXRoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIElmIGl0J3Mgc29tZSBvdGhlciBvYmplY3QsIGNvbnZlcnQgdG8gc3RyaW5nXG4gICAgICAgIGltYWdlUGF0aCA9IFN0cmluZyhpbWFnZVZhbHVlKTtcbiAgICAgICAgTG9nZ2VyLmRlYnVnKCdDb252ZXJ0ZWQgb2JqZWN0IHRvIHN0cmluZzonLCBpbWFnZVBhdGgpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAvLyBJdCdzIGFscmVhZHkgYSBzdHJpbmdcbiAgICAgIGltYWdlUGF0aCA9IFN0cmluZyhpbWFnZVZhbHVlKTtcbiAgICAgIExvZ2dlci5kZWJ1ZygnSW1hZ2UgdmFsdWUgaXMgYSBzdHJpbmc6JywgaW1hZ2VQYXRoKTtcbiAgICB9XG4gICAgXG4gICAgLy8gQ2hlY2sgaWYgdGhlIHN0cmluZyBjb250YWlucyBhIHdpa2kgbGluayBvciBVUkwgYW5kIGV4dHJhY3QgaXRcbiAgICAvLyBUaGlzIGhlbHBzIHdpdGggZXhwcmVzc2lvbnMgdGhhdCByZXN1bHQgaW4gc3RyaW5ncyBjb250YWluaW5nIHdpa2kgbGlua3Mgb3IgVVJMc1xuICAgIGltYWdlUGF0aCA9IHRoaXMuZXh0cmFjdEltYWdlU291cmNlKGltYWdlUGF0aCk7XG4gICAgTG9nZ2VyLmRlYnVnKCdBZnRlciBpbWFnZSBzb3VyY2UgZXh0cmFjdGlvbjonLCBpbWFnZVBhdGgpO1xuICAgIFxuICAgIC8vIENyZWF0ZSBwbGFjZWhvbGRlciBmaXJzdFxuICAgIGNvbnN0IHBsYWNlaG9sZGVyID0gaW1hZ2VDb250YWluZXIuY3JlYXRlRWwoJ2RpdicsIHtcbiAgICAgIGNsczogJ2RhdGFjYXJkcy1pbWFnZS1wbGFjZWhvbGRlcicsXG4gICAgICB0ZXh0OiAnTG9hZGluZyBpbWFnZS4uLicsXG4gICAgfSk7XG4gICAgXG4gICAgLy8gQ2hlY2sgaWYgbGF6eSBsb2FkaW5nIGlzIGVuYWJsZWRcbiAgICBpZiAodGhpcy5jdXJyZW50U2V0dGluZ3M/LmVuYWJsZUxhenlMb2FkaW5nKSB7XG4gICAgICB0aGlzLmxhenlMb2FkSW1hZ2UoaW1hZ2VDb250YWluZXIsIHBsYWNlaG9sZGVyLCBpbWFnZVBhdGgpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmxvYWRJbWFnZShpbWFnZUNvbnRhaW5lciwgcGxhY2Vob2xkZXIsIGltYWdlUGF0aCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEV4dHJhY3QgYW4gaW1hZ2Ugc291cmNlIGZyb20gYSBzdHJpbmcgaWYgcHJlc2VudFxuICAgKiBUaGlzIGhlbHBzIHdpdGggaGFuZGxpbmcgZXhwcmVzc2lvbnMgdGhhdCByZXN1bHQgaW4gd2lraSBsaW5rcyBvciBVUkxzXG4gICAqIFxuICAgKiBAcGFyYW0gdmFsdWUgVGhlIHN0cmluZyB2YWx1ZSB0aGF0IG1pZ2h0IGNvbnRhaW4gYSB3aWtpIGxpbmsgb3IgVVJMXG4gICAqIEByZXR1cm5zIFRoZSB3aWtpIGxpbmsgb3IgVVJMIGlmIGZvdW5kLCBvdGhlcndpc2UgdGhlIG9yaWdpbmFsIHN0cmluZ1xuICAgKi9cbiAgcHJpdmF0ZSBleHRyYWN0SW1hZ2VTb3VyY2UodmFsdWU6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgaWYgKCF2YWx1ZSB8fCB0eXBlb2YgdmFsdWUgIT09ICdzdHJpbmcnKSB7XG4gICAgICByZXR1cm4gU3RyaW5nKHZhbHVlIHx8ICcnKTtcbiAgICB9XG4gICAgXG4gICAgLy8gRmlyc3QgY2hlY2sgZm9yIG1hcmtkb3duIGltYWdlIHN5bnRheDogIVthbHQgdGV4dF0odXJsKSBvciAhW3xzaXplXSh1cmwpXG4gICAgLy8gVXNlIGEgbW9yZSByb2J1c3QgcmVnZXggdGhhdCBjYW4gaGFuZGxlIHBhcmVudGhlc2VzIHdpdGhpbiB0aGUgVVJMXG4gICAgLy8gVGhpcyByZWdleCBoYW5kbGVzIG5lc3RlZCBwYXJlbnRoZXNlcyBpbiBVUkxzIGJ5IHVzaW5nIGEgbm9uLWdyZWVkeSBtYXRjaFxuICAgIGNvbnN0IG1hcmtkb3duSW1hZ2VNYXRjaCA9IHZhbHVlLm1hdGNoKC8hXFxbKC4qPylcXF1cXCgoLio/KVxcKS8pO1xuICAgIGlmIChtYXJrZG93bkltYWdlTWF0Y2gpIHtcbiAgICAgIC8vIFJldHVybiB0aGUgVVJMIGZyb20gdGhlIG1hcmtkb3duIGltYWdlIHN5bnRheFxuICAgICAgY29uc3QgdXJsID0gbWFya2Rvd25JbWFnZU1hdGNoWzJdO1xuICAgICAgTG9nZ2VyLmRlYnVnKCdFeHRyYWN0ZWQgVVJMIGZyb20gbWFya2Rvd24gaW1hZ2Ugc3ludGF4OicsIHVybCk7XG4gICAgICBcbiAgICAgIC8vIENsZWFuIHRoZSBVUkwgLSByZW1vdmUgYW55IHRyYWlsaW5nIHB1bmN0dWF0aW9uIG9yIHF1b3Rlc1xuICAgICAgY29uc3QgY2xlYW5VcmwgPSB1cmwucmVwbGFjZSgvWydcIiwuOzpdKyQvLCAnJyk7XG4gICAgICByZXR1cm4gY2xlYW5Vcmw7XG4gICAgfVxuICAgIFxuICAgIC8vIENoZWNrIGlmIHRoZSBzdHJpbmcgY29udGFpbnMgYSB3aWtpIGxpbmsgcGF0dGVyblxuICAgIGNvbnN0IHdpa2lMaW5rTWF0Y2ggPSB2YWx1ZS5tYXRjaCgvXFxbXFxbKC4qPylcXF1cXF0vKTtcbiAgICBpZiAod2lraUxpbmtNYXRjaCkge1xuICAgICAgLy8gUmV0dXJuIGp1c3QgdGhlIHdpa2kgbGluayBwYXJ0XG4gICAgICBjb25zdCB3aWtpTGluayA9IGBbWyR7d2lraUxpbmtNYXRjaFsxXX1dXWA7XG4gICAgICBMb2dnZXIuZGVidWcoJ0V4dHJhY3RlZCB3aWtpIGxpbms6Jywgd2lraUxpbmspO1xuICAgICAgcmV0dXJuIHdpa2lMaW5rO1xuICAgIH1cbiAgICBcbiAgICAvLyBDaGVjayBpZiB0aGUgc3RyaW5nIGNvbnRhaW5zIGEgVVJMIHBhdHRlcm5cbiAgICAvLyBVc2UgYSBtb3JlIHJvYnVzdCByZWdleCBmb3IgVVJMcyB0aGF0IGNhbiBoYW5kbGUgcXVlcnkgcGFyYW1ldGVycyBhbmQgZnJhZ21lbnRzXG4gICAgLy8gVGhpcyByZWdleCBpcyBtb3JlIHBlcm1pc3NpdmUgdG8gaGFuZGxlIHZhcmlvdXMgVVJMIGZvcm1hdHNcbiAgICBjb25zdCB1cmxNYXRjaCA9IHZhbHVlLm1hdGNoKC8oaHR0cHM/OlxcL1xcL1teXFxzXCInPD5bXFxde31dKykvKTtcbiAgICBpZiAodXJsTWF0Y2gpIHtcbiAgICAgIC8vIFJldHVybiBqdXN0IHRoZSBVUkwgcGFydFxuICAgICAgY29uc3QgdXJsID0gdXJsTWF0Y2hbMV07XG4gICAgICBMb2dnZXIuZGVidWcoJ0V4dHJhY3RlZCBVUkw6JywgdXJsKTtcbiAgICAgIFxuICAgICAgLy8gQ2xlYW4gdGhlIFVSTCAtIHJlbW92ZSBhbnkgdHJhaWxpbmcgcHVuY3R1YXRpb24gb3IgcXVvdGVzXG4gICAgICBjb25zdCBjbGVhblVybCA9IHVybC5yZXBsYWNlKC9bJ1wiLC47Ol0rJC8sICcnKTtcbiAgICAgIHJldHVybiBjbGVhblVybDtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHZhbHVlO1xuICB9XG4gIFxuICAvKipcbiAgICogTGF6eSBsb2FkIGFuIGltYWdlIHVzaW5nIEludGVyc2VjdGlvbiBPYnNlcnZlclxuICAgKiBcbiAgICogQHBhcmFtIGltYWdlQ29udGFpbmVyIFRoZSBjb250YWluZXIgZWxlbWVudCBmb3IgdGhlIGltYWdlXG4gICAqIEBwYXJhbSBwbGFjZWhvbGRlciBUaGUgcGxhY2Vob2xkZXIgZWxlbWVudFxuICAgKiBAcGFyYW0gaW1hZ2VQYXRoIFRoZSBwYXRoIHRvIHRoZSBpbWFnZVxuICAgKi9cbiAgcHJpdmF0ZSBsYXp5TG9hZEltYWdlKGltYWdlQ29udGFpbmVyOiBIVE1MRWxlbWVudCwgcGxhY2Vob2xkZXI6IEhUTUxFbGVtZW50LCBpbWFnZVBhdGg6IHN0cmluZyk6IHZvaWQge1xuICAgIExvZ2dlci5kZWJ1ZygnTGF6eSBsb2FkaW5nIGltYWdlOicsIGltYWdlUGF0aCk7XG4gICAgXG4gICAgLy8gQ3JlYXRlIHRoZSBvYnNlcnZlclxuICAgIGNvbnN0IG9ic2VydmVyID0gbmV3IEludGVyc2VjdGlvbk9ic2VydmVyKChlbnRyaWVzLCBvYnNlcnZlcikgPT4ge1xuICAgICAgZW50cmllcy5mb3JFYWNoKGVudHJ5ID0+IHtcbiAgICAgICAgaWYgKGVudHJ5LmlzSW50ZXJzZWN0aW5nKSB7XG4gICAgICAgICAgTG9nZ2VyLmRlYnVnKCdJbWFnZSBjb250YWluZXIgaXMgbm93IHZpc2libGUsIGxvYWRpbmcgaW1hZ2U6JywgaW1hZ2VQYXRoKTtcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBMb2FkIHRoZSBpbWFnZVxuICAgICAgICAgIHRoaXMubG9hZEltYWdlKGltYWdlQ29udGFpbmVyLCBwbGFjZWhvbGRlciwgaW1hZ2VQYXRoKTtcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBTdG9wIG9ic2VydmluZyBvbmNlIGxvYWRlZFxuICAgICAgICAgIG9ic2VydmVyLmRpc2Nvbm5lY3QoKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSwge1xuICAgICAgcm9vdE1hcmdpbjogJzEwMHB4JywgLy8gU3RhcnQgbG9hZGluZyB3aGVuIGltYWdlIGlzIDEwMHB4IGZyb20gdmlld3BvcnRcbiAgICAgIHRocmVzaG9sZDogMC4xIC8vIFRyaWdnZXIgd2hlbiBhdCBsZWFzdCAxMCUgb2YgdGhlIGVsZW1lbnQgaXMgdmlzaWJsZVxuICAgIH0pO1xuICAgIFxuICAgIC8vIFN0YXJ0IG9ic2VydmluZyB0aGUgaW1hZ2UgY29udGFpbmVyXG4gICAgb2JzZXJ2ZXIub2JzZXJ2ZShpbWFnZUNvbnRhaW5lcik7XG4gIH1cbiAgXG4gIC8qKlxuICAgKiBMb2FkIGFuIGltYWdlIGltbWVkaWF0ZWx5XG4gICAqIFxuICAgKiBAcGFyYW0gaW1hZ2VDb250YWluZXIgVGhlIGNvbnRhaW5lciBlbGVtZW50IGZvciB0aGUgaW1hZ2VcbiAgICogQHBhcmFtIHBsYWNlaG9sZGVyIFRoZSBwbGFjZWhvbGRlciBlbGVtZW50XG4gICAqIEBwYXJhbSBpbWFnZVBhdGggVGhlIHBhdGggdG8gdGhlIGltYWdlXG4gICAqL1xuICBwcml2YXRlIGxvYWRJbWFnZShpbWFnZUNvbnRhaW5lcjogSFRNTEVsZW1lbnQsIHBsYWNlaG9sZGVyOiBIVE1MRWxlbWVudCwgaW1hZ2VQYXRoOiBzdHJpbmcpOiB2b2lkIHtcbiAgICAvLyBDaGVjayBmb3IgbWFya2Rvd24gaW1hZ2Ugc3ludGF4OiAhW2FsdCB0ZXh0XSh1cmwpIG9yICFbfHNpemVdKHVybClcbiAgICBjb25zdCBtYXJrZG93bkltYWdlTWF0Y2ggPSBpbWFnZVBhdGgubWF0Y2goLyFcXFsoLio/KVxcXVxcKCguKj8pXFwpLyk7XG4gICAgaWYgKG1hcmtkb3duSW1hZ2VNYXRjaCkge1xuICAgICAgLy8gRXh0cmFjdCB0aGUgVVJMIGZyb20gdGhlIG1hcmtkb3duIGltYWdlIHN5bnRheFxuICAgICAgY29uc3QgaW1hZ2VVcmwgPSBtYXJrZG93bkltYWdlTWF0Y2hbMl07XG4gICAgICBMb2dnZXIuZGVidWcoJ0V4dHJhY3RlZCBVUkwgZnJvbSBtYXJrZG93biBpbWFnZSBzeW50YXg6JywgaW1hZ2VVcmwpO1xuICAgICAgXG4gICAgICAvLyBVc2UgdGhlIGV4dHJhY3RlZCBVUkwgZm9yIGxvYWRpbmdcbiAgICAgIHRoaXMubG9hZEltYWdlKGltYWdlQ29udGFpbmVyLCBwbGFjZWhvbGRlciwgaW1hZ2VVcmwpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBcbiAgICAvLyBIYW5kbGUgZGlmZmVyZW50IGltYWdlIGZvcm1hdHNcbiAgICBpZiAoaW1hZ2VQYXRoLnN0YXJ0c1dpdGgoJ2h0dHAnKSB8fCBpbWFnZVBhdGguc3RhcnRzV2l0aCgnaHR0cHMnKSkge1xuICAgICAgTG9nZ2VyLmRlYnVnKCdIYW5kbGluZyBhcyBleHRlcm5hbCBVUkw6JywgaW1hZ2VQYXRoKTtcbiAgICAgIFxuICAgICAgLy8gQ2xlYW4gdGhlIFVSTCAtIHJlbW92ZSBhbnkgdHJhaWxpbmcgcHVuY3R1YXRpb24gb3IgcXVvdGVzIHRoYXQgbWlnaHQgaGF2ZSBiZWVuIGluY2x1ZGVkXG4gICAgICBjb25zdCBjbGVhblVybCA9IGltYWdlUGF0aC5yZXBsYWNlKC9bJ1wiLC47Ol0rJC8sICcnKTtcbiAgICAgIExvZ2dlci5kZWJ1ZygnQ2xlYW5lZCBVUkw6JywgY2xlYW5VcmwpO1xuICAgICAgXG4gICAgICAvLyBUcnkgdG8gbG9hZCB0aGUgaW1hZ2Ugd2l0aCBtdWx0aXBsZSBhcHByb2FjaGVzXG4gICAgICB0aGlzLmxvYWRFeHRlcm5hbEltYWdlKGltYWdlQ29udGFpbmVyLCBwbGFjZWhvbGRlciwgY2xlYW5VcmwpO1xuICAgIH0gZWxzZSBpZiAoaW1hZ2VQYXRoLnN0YXJ0c1dpdGgoJ1tbJykgJiYgaW1hZ2VQYXRoLmVuZHNXaXRoKCddXScpKSB7XG4gICAgICBMb2dnZXIuZGVidWcoJ0hhbmRsaW5nIGFzIHdpa2kgbGluaycpO1xuICAgICAgLy8gV2lraSBsaW5rXG4gICAgICBjb25zdCBsaW5rVGV4dCA9IGltYWdlUGF0aC5zdWJzdHJpbmcoMiwgaW1hZ2VQYXRoLmxlbmd0aCAtIDIpO1xuICAgICAgXG4gICAgICAvLyBIYW5kbGUgZGlzcGxheSB0ZXh0IGlmIHByZXNlbnQgKGZvcm1hdDogW1twYXRofGRpc3BsYXlUZXh0XV0pXG4gICAgICBsZXQgcGF0aCA9IGxpbmtUZXh0O1xuICAgICAgXG4gICAgICBpZiAobGlua1RleHQuaW5jbHVkZXMoJ3wnKSkge1xuICAgICAgICBjb25zdCBwYXJ0cyA9IGxpbmtUZXh0LnNwbGl0KCd8Jyk7XG4gICAgICAgIHBhdGggPSBwYXJ0c1swXTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gVXNlIE9ic2lkaWFuJ3MgcmVzb3VyY2UgQVBJIHRvIGdldCB0aGUgY29ycmVjdCBVUkxcbiAgICAgIHRyeSB7XG4gICAgICAgIC8vIEdldCB0aGUgZmlsZSBmcm9tIHRoZSB2YXVsdFxuICAgICAgICBjb25zdCBhYnN0cmFjdEZpbGUgPSB0aGlzLmFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgocGF0aCk7XG4gICAgICAgIC8vIENoZWNrIGlmIGl0J3MgYSBURmlsZSAoaGFzIGEgc3RhdCBwcm9wZXJ0eSB3aGljaCBpcyBhIGNoYXJhY3RlcmlzdGljIG9mIFRGaWxlKVxuICAgICAgICBpZiAoYWJzdHJhY3RGaWxlICYmICdzdGF0JyBpbiBhYnN0cmFjdEZpbGUpIHtcbiAgICAgICAgICBMb2dnZXIuZGVidWcoJ0ZvdW5kIGZpbGUgaW4gdmF1bHQ6JywgYWJzdHJhY3RGaWxlKTtcbiAgICAgICAgICAvLyBDYXN0IHRvIFRGaWxlIGFuZCBnZXQgdGhlIFVSTCBmb3IgdGhlIGZpbGVcbiAgICAgICAgICBjb25zdCBmaWxlID0gYWJzdHJhY3RGaWxlIGFzIFRGaWxlO1xuICAgICAgICAgIGNvbnN0IHJlc291cmNlUGF0aCA9IHRoaXMuYXBwLnZhdWx0LmdldFJlc291cmNlUGF0aChmaWxlKTtcbiAgICAgICAgICBMb2dnZXIuZGVidWcoJ1Jlc291cmNlIHBhdGg6JywgcmVzb3VyY2VQYXRoKTtcbiAgICAgICAgICBcbiAgICAgICAgICBjb25zdCBpbWcgPSBpbWFnZUNvbnRhaW5lci5jcmVhdGVFbCgnaW1nJywge1xuICAgICAgICAgICAgY2xzOiAnZGF0YWNhcmRzLWltYWdlJyxcbiAgICAgICAgICAgIGF0dHI6IHsgc3JjOiByZXNvdXJjZVBhdGggfSxcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBSZW1vdmUgcGxhY2Vob2xkZXIgYW5kIGFkZCBsb2FkZWQgY2xhc3Mgd2hlbiBpbWFnZSBsb2Fkc1xuICAgICAgICAgIGltZy5vbmxvYWQgPSAoKSA9PiB7XG4gICAgICAgICAgICBwbGFjZWhvbGRlci5yZW1vdmUoKTtcbiAgICAgICAgICAgIGltZy5hZGRDbGFzcygnbG9hZGVkJyk7XG4gICAgICAgICAgfTtcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBTaG93IHBsYWNlaG9sZGVyIGlmIGltYWdlIGZhaWxzIHRvIGxvYWRcbiAgICAgICAgICBpbWcub25lcnJvciA9ICgpID0+IHtcbiAgICAgICAgICAgIHBsYWNlaG9sZGVyLnNldFRleHQoJ0ltYWdlIG5vdCBmb3VuZCcpO1xuICAgICAgICAgIH07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgTG9nZ2VyLmRlYnVnKCdGaWxlIG5vdCBmb3VuZCBpbiB2YXVsdCBvciBub3QgYSBmaWxlOicsIHBhdGgpO1xuICAgICAgICAgIC8vIFVwZGF0ZSBwbGFjZWhvbGRlciBmb3IgbWlzc2luZyBpbWFnZXNcbiAgICAgICAgICBwbGFjZWhvbGRlci5zZXRUZXh0KCdJbWFnZSBub3QgZm91bmQnKTtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgTG9nZ2VyLmVycm9yKCdFcnJvciBsb2FkaW5nIGltYWdlOicsIGVycm9yKTtcbiAgICAgICAgLy8gVXBkYXRlIHBsYWNlaG9sZGVyIGZvciBlcnJvclxuICAgICAgICBwbGFjZWhvbGRlci5zZXRUZXh0KCdFcnJvciBsb2FkaW5nIGltYWdlJyk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIExvZ2dlci5kZWJ1ZygnSGFuZGxpbmcgYXMgbG9jYWwgcGF0aCcpO1xuICAgICAgLy8gQXNzdW1lIGxvY2FsIHBhdGggaW4gdGhlIHZhdWx0XG4gICAgICB0cnkge1xuICAgICAgICAvLyBHZXQgdGhlIGZpbGUgZnJvbSB0aGUgdmF1bHRcbiAgICAgICAgY29uc3QgYWJzdHJhY3RGaWxlID0gdGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKGltYWdlUGF0aCk7XG4gICAgICAgIC8vIENoZWNrIGlmIGl0J3MgYSBURmlsZSAoaGFzIGEgc3RhdCBwcm9wZXJ0eSB3aGljaCBpcyBhIGNoYXJhY3RlcmlzdGljIG9mIFRGaWxlKVxuICAgICAgICBpZiAoYWJzdHJhY3RGaWxlICYmICdzdGF0JyBpbiBhYnN0cmFjdEZpbGUpIHtcbiAgICAgICAgICBMb2dnZXIuZGVidWcoJ0ZvdW5kIGZpbGUgaW4gdmF1bHQ6JywgYWJzdHJhY3RGaWxlKTtcbiAgICAgICAgICAvLyBDYXN0IHRvIFRGaWxlIGFuZCBnZXQgdGhlIFVSTCBmb3IgdGhlIGZpbGVcbiAgICAgICAgICBjb25zdCBmaWxlID0gYWJzdHJhY3RGaWxlIGFzIFRGaWxlO1xuICAgICAgICAgIGNvbnN0IHJlc291cmNlUGF0aCA9IHRoaXMuYXBwLnZhdWx0LmdldFJlc291cmNlUGF0aChmaWxlKTtcbiAgICAgICAgICBMb2dnZXIuZGVidWcoJ1Jlc291cmNlIHBhdGg6JywgcmVzb3VyY2VQYXRoKTtcbiAgICAgICAgICBcbiAgICAgICAgICBjb25zdCBpbWcgPSBpbWFnZUNvbnRhaW5lci5jcmVhdGVFbCgnaW1nJywge1xuICAgICAgICAgICAgY2xzOiAnZGF0YWNhcmRzLWltYWdlJyxcbiAgICAgICAgICAgIGF0dHI6IHsgc3JjOiByZXNvdXJjZVBhdGggfSxcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBSZW1vdmUgcGxhY2Vob2xkZXIgYW5kIGFkZCBsb2FkZWQgY2xhc3Mgd2hlbiBpbWFnZSBsb2Fkc1xuICAgICAgICAgIGltZy5vbmxvYWQgPSAoKSA9PiB7XG4gICAgICAgICAgICBwbGFjZWhvbGRlci5yZW1vdmUoKTtcbiAgICAgICAgICAgIGltZy5hZGRDbGFzcygnbG9hZGVkJyk7XG4gICAgICAgICAgfTtcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBTaG93IHBsYWNlaG9sZGVyIGlmIGltYWdlIGZhaWxzIHRvIGxvYWRcbiAgICAgICAgICBpbWcub25lcnJvciA9ICgpID0+IHtcbiAgICAgICAgICAgIHBsYWNlaG9sZGVyLnNldFRleHQoJ0ltYWdlIG5vdCBmb3VuZCcpO1xuICAgICAgICAgIH07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgTG9nZ2VyLmRlYnVnKCdGaWxlIG5vdCBmb3VuZCBpbiB2YXVsdDonLCBpbWFnZVBhdGgpO1xuICAgICAgICAgIC8vIFVwZGF0ZSBwbGFjZWhvbGRlciBmb3IgbWlzc2luZyBpbWFnZXNcbiAgICAgICAgICBwbGFjZWhvbGRlci5zZXRUZXh0KCdJbWFnZSBub3QgZm91bmQnKTtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgTG9nZ2VyLmVycm9yKCdFcnJvciBsb2FkaW5nIGltYWdlOicsIGVycm9yKTtcbiAgICAgICAgLy8gVXBkYXRlIHBsYWNlaG9sZGVyIGZvciBlcnJvclxuICAgICAgICBwbGFjZWhvbGRlci5zZXRUZXh0KCdFcnJvciBsb2FkaW5nIGltYWdlJyk7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIFxuICAvKipcbiAgICogTG9hZCBhbiBleHRlcm5hbCBpbWFnZSB3aXRoIG11bHRpcGxlIGZhbGxiYWNrIGFwcHJvYWNoZXNcbiAgICogXG4gICAqIEBwYXJhbSBpbWFnZUNvbnRhaW5lciBUaGUgY29udGFpbmVyIGVsZW1lbnQgZm9yIHRoZSBpbWFnZVxuICAgKiBAcGFyYW0gcGxhY2Vob2xkZXIgVGhlIHBsYWNlaG9sZGVyIGVsZW1lbnRcbiAgICogQHBhcmFtIHVybCBUaGUgVVJMIG9mIHRoZSBpbWFnZVxuICAgKi9cbiAgcHJpdmF0ZSBsb2FkRXh0ZXJuYWxJbWFnZShpbWFnZUNvbnRhaW5lcjogSFRNTEVsZW1lbnQsIHBsYWNlaG9sZGVyOiBIVE1MRWxlbWVudCwgdXJsOiBzdHJpbmcpOiB2b2lkIHtcbiAgICBMb2dnZXIuZGVidWcoJ0xvYWRpbmcgZXh0ZXJuYWwgaW1hZ2Ugd2l0aCBVUkw6JywgdXJsKTtcbiAgICBcbiAgICAvLyBGaXJzdCBhdHRlbXB0OiB3aXRoIGNyb3Nzb3JpZ2luIGF0dHJpYnV0ZVxuICAgIGNvbnN0IGltZyA9IGltYWdlQ29udGFpbmVyLmNyZWF0ZUVsKCdpbWcnLCB7XG4gICAgICBjbHM6ICdkYXRhY2FyZHMtaW1hZ2UnLFxuICAgICAgYXR0cjogeyBcbiAgICAgICAgc3JjOiB1cmwsXG4gICAgICAgIC8vIEFkZCBjcm9zc29yaWdpbiBhdHRyaWJ1dGUgdG8gaGVscCB3aXRoIENPUlMgaXNzdWVzXG4gICAgICAgIGNyb3Nzb3JpZ2luOiAnYW5vbnltb3VzJ1xuICAgICAgfSxcbiAgICB9KTtcbiAgICBcbiAgICAvLyBSZW1vdmUgcGxhY2Vob2xkZXIgYW5kIGFkZCBsb2FkZWQgY2xhc3Mgd2hlbiBpbWFnZSBsb2Fkc1xuICAgIGltZy5vbmxvYWQgPSAoKSA9PiB7XG4gICAgICBMb2dnZXIuZGVidWcoJ0V4dGVybmFsIGltYWdlIGxvYWRlZCBzdWNjZXNzZnVsbHk6JywgdXJsKTtcbiAgICAgIHBsYWNlaG9sZGVyLnJlbW92ZSgpO1xuICAgICAgaW1nLmFkZENsYXNzKCdsb2FkZWQnKTtcbiAgICB9O1xuICAgIFxuICAgIC8vIFNob3cgcGxhY2Vob2xkZXIgaWYgaW1hZ2UgZmFpbHMgdG8gbG9hZFxuICAgIGltZy5vbmVycm9yID0gKGVycm9yKSA9PiB7XG4gICAgICBMb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byBsb2FkIGV4dGVybmFsIGltYWdlIHdpdGggY3Jvc3NvcmlnaW4gYXR0cmlidXRlOicsIHVybCwgZXJyb3IpO1xuICAgICAgXG4gICAgICAvLyBTZWNvbmQgYXR0ZW1wdDogd2l0aG91dCBjcm9zc29yaWdpbiBhdHRyaWJ1dGVcbiAgICAgIExvZ2dlci5kZWJ1ZygnVHJ5aW5nIGFnYWluIHdpdGhvdXQgY3Jvc3NvcmlnaW4gYXR0cmlidXRlJyk7XG4gICAgICBpbWcucmVtb3ZlQXR0cmlidXRlKCdjcm9zc29yaWdpbicpO1xuICAgICAgXG4gICAgICBpbWcub25sb2FkID0gKCkgPT4ge1xuICAgICAgICBMb2dnZXIuZGVidWcoJ0V4dGVybmFsIGltYWdlIGxvYWRlZCBzdWNjZXNzZnVsbHkgd2l0aG91dCBjcm9zc29yaWdpbjonLCB1cmwpO1xuICAgICAgICBwbGFjZWhvbGRlci5yZW1vdmUoKTtcbiAgICAgICAgaW1nLmFkZENsYXNzKCdsb2FkZWQnKTtcbiAgICAgIH07XG4gICAgICBcbiAgICAgIGltZy5vbmVycm9yID0gKHNlY29uZEVycm9yKSA9PiB7XG4gICAgICAgIExvZ2dlci5lcnJvcignRmFpbGVkIHRvIGxvYWQgZXh0ZXJuYWwgaW1hZ2Ugd2l0aG91dCBjcm9zc29yaWdpbjonLCB1cmwsIHNlY29uZEVycm9yKTtcbiAgICAgICAgXG4gICAgICAgIC8vIFRoaXJkIGF0dGVtcHQ6IHVzaW5nIGEgcHJveHkgc2VydmljZSBpZiBhdmFpbGFibGVcbiAgICAgICAgLy8gVGhpcyBpcyBhIGNvbW1vbiBhcHByb2FjaCB0byBieXBhc3MgQ09SUyBpc3N1ZXNcbiAgICAgICAgY29uc3QgcHJveHlVcmwgPSBgaHR0cHM6Ly9pbWFnZXMud2VzZXJ2Lm5sLz91cmw9JHtlbmNvZGVVUklDb21wb25lbnQodXJsKX1gO1xuICAgICAgICBMb2dnZXIuZGVidWcoJ1RyeWluZyB3aXRoIGltYWdlIHByb3h5IHNlcnZpY2U6JywgcHJveHlVcmwpO1xuICAgICAgICBcbiAgICAgICAgaW1nLnNyYyA9IHByb3h5VXJsO1xuICAgICAgICBcbiAgICAgICAgaW1nLm9ubG9hZCA9ICgpID0+IHtcbiAgICAgICAgICBMb2dnZXIuZGVidWcoJ0V4dGVybmFsIGltYWdlIGxvYWRlZCBzdWNjZXNzZnVsbHkgdmlhIHByb3h5OicsIHByb3h5VXJsKTtcbiAgICAgICAgICBwbGFjZWhvbGRlci5yZW1vdmUoKTtcbiAgICAgICAgICBpbWcuYWRkQ2xhc3MoJ2xvYWRlZCcpO1xuICAgICAgICB9O1xuICAgICAgICBcbiAgICAgICAgaW1nLm9uZXJyb3IgPSAodGhpcmRFcnJvcikgPT4ge1xuICAgICAgICAgIExvZ2dlci5lcnJvcignQWxsIGF0dGVtcHRzIHRvIGxvYWQgaW1hZ2UgZmFpbGVkOicsIHVybCwgdGhpcmRFcnJvcik7XG4gICAgICAgICAgcGxhY2Vob2xkZXIuc2V0VGV4dCgnSW1hZ2Ugbm90IGZvdW5kIC0gVVJMOiAnICsgdXJsKTtcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBDcmVhdGUgYSBoaWRkZW4gaWZyYW1lIHRvIHRyeSB0byBsb2FkIHRoZSBpbWFnZVxuICAgICAgICAgIC8vIFRoaXMgY2FuIGhlbHAgZGlhZ25vc2UgaWYgdGhlIGltYWdlIGV4aXN0cyBidXQgaGFzIENPUlMgaXNzdWVzXG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHRlc3RJbWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcbiAgICAgICAgICAgIHRlc3RJbWcuc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICAgICAgICAgIHRlc3RJbWcuc3JjID0gdXJsO1xuICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0ZXN0SW1nKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gUmVtb3ZlIHRoZSB0ZXN0IGltYWdlIGFmdGVyIGEgc2hvcnQgZGVsYXlcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICBpZiAoZG9jdW1lbnQuYm9keS5jb250YWlucyh0ZXN0SW1nKSkge1xuICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQodGVzdEltZyk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIDMwMDApO1xuICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIExvZ2dlci5lcnJvcignRXJyb3IgZHVyaW5nIGZpbmFsIHRlc3Q6JywgZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgfTtcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZCBhIHByb3BlcnR5IHRvIGEgY2FyZFxuICAgKiBcbiAgICogQHBhcmFtIGNvbnRlbnRFbCBUaGUgY29udGVudCBlbGVtZW50IHRvIGFkZCB0aGUgcHJvcGVydHkgdG9cbiAgICogQHBhcmFtIHByb3BlcnR5TmFtZSBUaGUgbmFtZSBvZiB0aGUgcHJvcGVydHlcbiAgICogQHBhcmFtIHByb3BlcnR5VmFsdWUgVGhlIHZhbHVlIG9mIHRoZSBwcm9wZXJ0eVxuICAgKiBAcGFyYW0gc2V0dGluZ3MgVGhlIHNldHRpbmdzXG4gICAqL1xuICBwcml2YXRlIGFkZFByb3BlcnR5VG9DYXJkKFxuICAgIGNvbnRlbnRFbDogSFRNTEVsZW1lbnQsIFxuICAgIHByb3BlcnR5TmFtZTogc3RyaW5nLCBcbiAgICBwcm9wZXJ0eVZhbHVlOiBhbnksIFxuICAgIHNldHRpbmdzOiBEYXRhQ2FyZHNTZXR0aW5nc1xuICApOiB2b2lkIHtcbiAgICBMb2dnZXIuZGVidWcoYEFkZGluZyBwcm9wZXJ0eSB0byBjYXJkOiAke3Byb3BlcnR5TmFtZX0gPSAke3Byb3BlcnR5VmFsdWV9YCk7XG4gICAgTG9nZ2VyLmRlYnVnKGBQcm9wZXJ0eSB0eXBlOiAke3R5cGVvZiBwcm9wZXJ0eVZhbHVlfWApO1xuICAgIFxuICAgIGNvbnN0IHByb3BlcnR5RWwgPSBjb250ZW50RWwuY3JlYXRlRWwoJ2RpdicsIHtcbiAgICAgIGNsczogJ2RhdGFjYXJkcy1wcm9wZXJ0eScsXG4gICAgfSk7XG4gICAgXG4gICAgLy8gQXBwbHkgdGV4dCBhbGlnbm1lbnQgY2xhc3MgdG8gdGhlIHByb3BlcnR5IGVsZW1lbnRcbiAgICBpZiAoc2V0dGluZ3MucHJvcGVydGllc0FsaWduKSB7XG4gICAgICBwcm9wZXJ0eUVsLmFkZENsYXNzKGBkYXRhY2FyZHMtdGV4dC0ke3NldHRpbmdzLnByb3BlcnRpZXNBbGlnbn1gKTtcbiAgICB9XG4gICAgXG4gICAgLy8gR2V0IGRpc3BsYXkgbmFtZSBmcm9tIGNvbHVtbiBhbGlhc2VzIGlmIGF2YWlsYWJsZVxuICAgIGxldCBkaXNwbGF5TmFtZSA9IHByb3BlcnR5TmFtZTtcbiAgICBcbiAgICAvLyBDaGVjayBpZiB3ZSBoYXZlIGNvbHVtbiBhbGlhc2VzIGFuZCBpZiB0aGlzIHByb3BlcnR5IGhhcyBhbiBhbGlhc1xuICAgIGlmIChzZXR0aW5ncy5jb2x1bW5BbGlhc2VzKSB7XG4gICAgICBjb25zdCBhbGlhc0VudHJ5ID0gc2V0dGluZ3MuY29sdW1uQWxpYXNlcy5maW5kKChhOiB7IG9yaWdpbmFsOiBzdHJpbmcgfSkgPT4gYS5vcmlnaW5hbCA9PT0gcHJvcGVydHlOYW1lKTtcbiAgICAgIGlmIChhbGlhc0VudHJ5KSB7XG4gICAgICAgIGRpc3BsYXlOYW1lID0gYWxpYXNFbnRyeS5hbGlhcztcbiAgICAgICAgTG9nZ2VyLmRlYnVnKGBVc2luZyBhbGlhcyBcIiR7ZGlzcGxheU5hbWV9XCIgZm9yIHByb3BlcnR5IFwiJHtwcm9wZXJ0eU5hbWV9XCJgKTtcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgLy8gQWRkIGxhYmVsIGlmIGVuYWJsZWRcbiAgICBpZiAoc2V0dGluZ3Muc2hvd0xhYmVscykge1xuICAgICAgY29uc3QgbGFiZWxFbCA9IHByb3BlcnR5RWwuY3JlYXRlRWwoJ2RpdicsIHtcbiAgICAgICAgY2xzOiAnZGF0YWNhcmRzLXByb3BlcnR5LWxhYmVsJyxcbiAgICAgICAgdGV4dDogZGlzcGxheU5hbWUsXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgLy8gQXBwbHkgdGV4dCBhbGlnbm1lbnQgY2xhc3MgdG8gdGhlIGxhYmVsIGVsZW1lbnRcbiAgICAgIGlmIChzZXR0aW5ncy5wcm9wZXJ0aWVzQWxpZ24pIHtcbiAgICAgICAgbGFiZWxFbC5hZGRDbGFzcyhgZGF0YWNhcmRzLXRleHQtJHtzZXR0aW5ncy5wcm9wZXJ0aWVzQWxpZ259YCk7XG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIC8vIENoZWNrIGlmIHRoaXMgaXMgdGhlIGZpbGUgcHJvcGVydHkgKHNwZWNpYWwgaGFuZGxpbmcgZm9yIGZpbGUgbGlua3MpXG4gICAgaWYgKHByb3BlcnR5TmFtZS50b0xvd2VyQ2FzZSgpID09PSAnZmlsZScpIHtcbiAgICAgIHRoaXMuZm9ybWF0RmlsZVByb3BlcnR5KHByb3BlcnR5RWwsIHByb3BlcnR5VmFsdWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBDaGVjayBpZiB0aGVyZSdzIGEgY3VzdG9tIGZvcm1hdHRlciBmb3IgdGhpcyBwcm9wZXJ0eVxuICAgICAgY29uc3QgZm9ybWF0dGVyID0gc2V0dGluZ3MucHJvcGVydHlGb3JtYXR0ZXJzW3Byb3BlcnR5TmFtZV07XG4gICAgICBcbiAgICAgIGlmIChmb3JtYXR0ZXIpIHtcbiAgICAgICAgLy8gVXNlIGN1c3RvbSBmb3JtYXR0ZXJcbiAgICAgICAgdGhpcy5mb3JtYXRQcm9wZXJ0eVdpdGhDdXN0b21Gb3JtYXR0ZXIocHJvcGVydHlFbCwgcHJvcGVydHlWYWx1ZSwgZm9ybWF0dGVyKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIFVzZSBkZWZhdWx0IGZvcm1hdHRpbmcgYmFzZWQgb24gdmFsdWUgdHlwZVxuICAgICAgICB0aGlzLmZvcm1hdFByb3BlcnR5QnlUeXBlKHByb3BlcnR5RWwsIHByb3BlcnR5VmFsdWUpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBGb3JtYXQgYSBwcm9wZXJ0eSB2YWx1ZSB1c2luZyBhIGN1c3RvbSBmb3JtYXR0ZXJcbiAgICogXG4gICAqIEBwYXJhbSBwcm9wZXJ0eUVsIFRoZSBwcm9wZXJ0eSBlbGVtZW50XG4gICAqIEBwYXJhbSB2YWx1ZSBUaGUgcHJvcGVydHkgdmFsdWVcbiAgICogQHBhcmFtIGZvcm1hdHRlciBUaGUgZm9ybWF0dGVyIGNvbmZpZ3VyYXRpb25cbiAgICovXG4gIHByaXZhdGUgZm9ybWF0UHJvcGVydHlXaXRoQ3VzdG9tRm9ybWF0dGVyKFxuICAgIHByb3BlcnR5RWw6IEhUTUxFbGVtZW50LCBcbiAgICB2YWx1ZTogYW55LCBcbiAgICBmb3JtYXR0ZXI6IHsgdHlwZTogc3RyaW5nOyBvcHRpb25zPzogYW55IH1cbiAgKTogdm9pZCB7XG4gICAgY29uc3QgdmFsdWVFbCA9IHByb3BlcnR5RWwuY3JlYXRlRWwoJ2RpdicsIHtcbiAgICAgIGNsczogJ2RhdGFjYXJkcy1wcm9wZXJ0eS12YWx1ZScsXG4gICAgfSk7XG4gICAgXG4gICAgc3dpdGNoIChmb3JtYXR0ZXIudHlwZSkge1xuICAgICAgY2FzZSAnc3RhcnMnOlxuICAgICAgICB0aGlzLmZvcm1hdEFzU3RhcnModmFsdWVFbCwgdmFsdWUsIGZvcm1hdHRlci5vcHRpb25zKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdiYWRnZSc6XG4gICAgICAgIHRoaXMuZm9ybWF0QXNCYWRnZSh2YWx1ZUVsLCB2YWx1ZSwgZm9ybWF0dGVyLm9wdGlvbnMpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ3Byb2dyZXNzJzpcbiAgICAgICAgdGhpcy5mb3JtYXRBc1Byb2dyZXNzKHZhbHVlRWwsIHZhbHVlLCBmb3JtYXR0ZXIub3B0aW9ucyk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnZGF0ZSc6XG4gICAgICAgIHRoaXMuZm9ybWF0QXNEYXRlKHZhbHVlRWwsIHZhbHVlLCBmb3JtYXR0ZXIub3B0aW9ucyk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAndGFncyc6XG4gICAgICAgIHRoaXMuZm9ybWF0QXNUYWdzKHZhbHVlRWwsIHZhbHVlLCBmb3JtYXR0ZXIub3B0aW9ucyk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgLy8gRGVmYXVsdCB0byB0ZXh0XG4gICAgICAgIHZhbHVlRWwuc2V0VGV4dChTdHJpbmcodmFsdWUpKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRm9ybWF0IGEgcHJvcGVydHkgdmFsdWUgYmFzZWQgb24gaXRzIHR5cGVcbiAgICogXG4gICAqIEBwYXJhbSBwcm9wZXJ0eUVsIFRoZSBwcm9wZXJ0eSBlbGVtZW50XG4gICAqIEBwYXJhbSB2YWx1ZSBUaGUgcHJvcGVydHkgdmFsdWVcbiAgICovXG4gIHByaXZhdGUgZm9ybWF0UHJvcGVydHlCeVR5cGUocHJvcGVydHlFbDogSFRNTEVsZW1lbnQsIHZhbHVlOiBhbnkpOiB2b2lkIHtcbiAgICAvLyBBZGQgZGV0YWlsZWQgZGVidWcgbG9nZ2luZyB0byBzZWUgZXhhY3RseSB3aGF0IHdlJ3JlIGRlYWxpbmcgd2l0aFxuICAgIExvZ2dlci5kZWJ1ZygnZm9ybWF0UHJvcGVydHlCeVR5cGUgY2FsbGVkIHdpdGggdmFsdWU6JywgdmFsdWUpO1xuICAgIExvZ2dlci5kZWJ1ZygnVmFsdWUgdHlwZTonLCB0eXBlb2YgdmFsdWUpO1xuICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICBMb2dnZXIuZGVidWcoJ1N0cmluZyB2YWx1ZSBsZW5ndGg6JywgdmFsdWUubGVuZ3RoKTtcbiAgICAgIExvZ2dlci5kZWJ1ZygnU3RyaW5nIHZhbHVlIGV4YWN0IGNvbnRlbnQ6JywgSlNPTi5zdHJpbmdpZnkodmFsdWUpKTtcbiAgICB9XG4gICAgXG4gICAgY29uc3QgdmFsdWVFbCA9IHByb3BlcnR5RWwuY3JlYXRlRWwoJ2RpdicsIHtcbiAgICAgIGNsczogJ2RhdGFjYXJkcy1wcm9wZXJ0eS12YWx1ZScsXG4gICAgfSk7XG4gICAgXG4gICAgLy8gQXBwbHkgdGhlIHNhbWUgdGV4dCBhbGlnbm1lbnQgY2xhc3MgYXMgdGhlIHBhcmVudCBwcm9wZXJ0eSBlbGVtZW50XG4gICAgLy8gVGhpcyBlbnN1cmVzIGNvbnNpc3RlbnQgYWxpZ25tZW50IGJldHdlZW4gbGFiZWxzIGFuZCB2YWx1ZXNcbiAgICBpZiAocHJvcGVydHlFbC5oYXNDbGFzcygnZGF0YWNhcmRzLXRleHQtbGVmdCcpKSB7XG4gICAgICB2YWx1ZUVsLmFkZENsYXNzKCdkYXRhY2FyZHMtdGV4dC1sZWZ0Jyk7XG4gICAgfSBlbHNlIGlmIChwcm9wZXJ0eUVsLmhhc0NsYXNzKCdkYXRhY2FyZHMtdGV4dC1jZW50ZXInKSkge1xuICAgICAgdmFsdWVFbC5hZGRDbGFzcygnZGF0YWNhcmRzLXRleHQtY2VudGVyJyk7XG4gICAgfSBlbHNlIGlmIChwcm9wZXJ0eUVsLmhhc0NsYXNzKCdkYXRhY2FyZHMtdGV4dC1yaWdodCcpKSB7XG4gICAgICB2YWx1ZUVsLmFkZENsYXNzKCdkYXRhY2FyZHMtdGV4dC1yaWdodCcpO1xuICAgIH1cbiAgICBcbiAgICBpZiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgdmFsdWVFbC5zZXRUZXh0KCcnKTtcbiAgICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7XG4gICAgICAvLyBGb3JtYXQgYXMgY29tbWEtc2VwYXJhdGVkIGxpc3RcbiAgICAgIHZhbHVlRWwuc2V0VGV4dCh2YWx1ZS5qb2luKCcsICcpKTtcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAvLyBGb3JtYXQgYXMgY2hlY2tib3hcbiAgICAgIGNvbnN0IGNoZWNrYm94ID0gdmFsdWVFbC5jcmVhdGVFbCgnaW5wdXQnLCB7XG4gICAgICAgIGF0dHI6IHtcbiAgICAgICAgICB0eXBlOiAnY2hlY2tib3gnLFxuICAgICAgICAgIGNoZWNrZWQ6IHZhbHVlID8gJ2NoZWNrZWQnIDogJycsXG4gICAgICAgICAgZGlzYWJsZWQ6ICdkaXNhYmxlZCcsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ251bWJlcicpIHtcbiAgICAgIC8vIEZvcm1hdCBhcyBudW1iZXJcbiAgICAgIHZhbHVlRWwuc2V0VGV4dCh2YWx1ZS50b1N0cmluZygpKTtcbiAgICB9IGVsc2UgaWYgKHZhbHVlIGluc3RhbmNlb2YgRGF0ZSkge1xuICAgICAgLy8gRm9ybWF0IERhdGUgb2JqZWN0cyB1c2luZyB0aGUgZGF0ZSBmb3JtYXR0ZXJcbiAgICAgIHRoaXMuZm9ybWF0QXNEYXRlKHZhbHVlRWwsIHZhbHVlKTtcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgIC8vIENoZWNrIGlmIHRoZSBzdHJpbmcgaXMgYSBkYXRlIChJU08gZm9ybWF0KVxuICAgICAgY29uc3QgaXNJc29EYXRlID0gL15cXGR7NH0tXFxkezJ9LVxcZHsyfVRcXGR7Mn06XFxkezJ9OlxcZHsyfS5cXGR7M31bKy1dXFxkezJ9OlxcZHsyfSQvLnRlc3QodmFsdWUpIHx8IFxuICAgICAgICAgICAgICAgICAgICAgICAgL15cXGR7NH0tXFxkezJ9LVxcZHsyfSQvLnRlc3QodmFsdWUpO1xuICAgICAgXG4gICAgICBpZiAoaXNJc29EYXRlKSB7XG4gICAgICAgIC8vIEl0J3MgYSBkYXRlIHN0cmluZywgZm9ybWF0IGl0IHVzaW5nIHRoZSBkYXRlIGZvcm1hdHRlclxuICAgICAgICBjb25zdCBkYXRlID0gbmV3IERhdGUodmFsdWUpO1xuICAgICAgICBpZiAoIWlzTmFOKGRhdGUuZ2V0VGltZSgpKSkge1xuICAgICAgICAgIHRoaXMuZm9ybWF0QXNEYXRlKHZhbHVlRWwsIGRhdGUpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBDaGVjayBpZiB0aGUgc3RyaW5nIGNvbnRhaW5zIGEgd2lraSBsaW5rIG9yIFVSTCBhbmQgZXh0cmFjdCBpdFxuICAgICAgLy8gVGhpcyBoZWxwcyB3aXRoIGV4cHJlc3Npb25zIHRoYXQgcmVzdWx0IGluIHN0cmluZ3MgY29udGFpbmluZyB3aWtpIGxpbmtzIG9yIFVSTHNcbiAgICAgIGNvbnN0IGV4dHJhY3RlZFZhbHVlID0gdGhpcy5leHRyYWN0SW1hZ2VTb3VyY2UodmFsdWUpO1xuICAgICAgaWYgKGV4dHJhY3RlZFZhbHVlICE9PSB2YWx1ZSkge1xuICAgICAgICAvLyBJZiBhIHdpa2kgbGluayB3YXMgZXh0cmFjdGVkLCBmb3JtYXQgaXQgYXMgYSB3aWtpIGxpbmtcbiAgICAgICAgdGhpcy5mb3JtYXRQcm9wZXJ0eUJ5VHlwZShwcm9wZXJ0eUVsLCBleHRyYWN0ZWRWYWx1ZSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gRGlyZWN0IGFwcHJvYWNoIGZvciB3aWtpIGxpbmtzIC0ganVzdCBzZXQgdGhlIHRleHQgdG8gdGhlIGRpc3BsYXkgcGFydFxuICAgICAgLy8gVGhpcyBpcyBhIHdvcmthcm91bmQgZm9yIHdoZW4gdGhlIGxpbmsgaXMgbm90IGJlaW5nIHByb3Blcmx5IHJlbmRlcmVkXG4gICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJyAmJiB2YWx1ZS5pbmNsdWRlcygnW1snKSAmJiB2YWx1ZS5pbmNsdWRlcygnfCcpICYmIHZhbHVlLmluY2x1ZGVzKCddXScpKSB7XG4gICAgICAgIC8vIEV4dHJhY3QgdGhlIGRpc3BsYXkgdGV4dCBwYXJ0IChhZnRlciB0aGUgcGlwZSlcbiAgICAgICAgY29uc3QgbWF0Y2ggPSB2YWx1ZS5tYXRjaCgvXFxbXFxbLipcXHwoLio/KVxcXVxcXS8pO1xuICAgICAgICBpZiAobWF0Y2ggJiYgbWF0Y2hbMV0pIHtcbiAgICAgICAgICAvLyBKdXN0IHVzZSB0aGUgZGlzcGxheSB0ZXh0IGRpcmVjdGx5XG4gICAgICAgICAgdmFsdWVFbC5zZXRUZXh0KG1hdGNoWzFdKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gTW9yZSBnZW5lcmFsIGNhc2UgZm9yIHdpa2kgbGlua3NcbiAgICAgIC8vIFRoaXMgaGFuZGxlcyBjYXNlcyB3aGVyZSBEYXRhdmlldyByZXR1cm5zIHRoZSBmdWxsIHdpa2kgbGluayBzeW50YXggYXMgYSBzdHJpbmdcbiAgICAgIGlmICh2YWx1ZS5pbmNsdWRlcygnW1snKSAmJiB2YWx1ZS5pbmNsdWRlcygnXV0nKSkge1xuICAgICAgICBjb25zb2xlLmxvZygnREFUQUNBUkRTIERFQlVHOiBGb3VuZCB3aWtpIGxpbmsgaW4gcHJvcGVydHkgdmFsdWU6JywgdmFsdWUpO1xuICAgICAgICBMb2dnZXIuZGVidWcoJ0ZvdW5kIHdpa2kgbGluayBpbiBwcm9wZXJ0eSB2YWx1ZTonLCB2YWx1ZSk7XG4gICAgICAgIFxuICAgICAgICAvLyBUcnkgdG8gZXh0cmFjdCB0aGUgd2lraSBsaW5rIHdpdGggYSBtb3JlIHJvYnVzdCByZWdleCB0aGF0IGNhbiBoYW5kbGUgdmFyaW91cyBmb3JtYXRzXG4gICAgICAgIGNvbnN0IHdpa2lMaW5rUmVnZXggPSAvXFxbXFxbKFteXFxdfF0rKSg/OlxcfChbXlxcXV0rKSk/XFxdXFxdLztcbiAgICAgICAgY29uc3Qgd2lraUxpbmtNYXRjaCA9IHZhbHVlLm1hdGNoKHdpa2lMaW5rUmVnZXgpO1xuICAgICAgICBcbiAgICAgICAgaWYgKHdpa2lMaW5rTWF0Y2gpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZygnREFUQUNBUkRTIERFQlVHOiBXaWtpIGxpbmsgbWF0Y2g6Jywgd2lraUxpbmtNYXRjaCk7XG4gICAgICAgICAgTG9nZ2VyLmRlYnVnKCdXaWtpIGxpbmsgbWF0Y2g6Jywgd2lraUxpbmtNYXRjaCk7XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gRXh0cmFjdCBwYXRoIGFuZCBkaXNwbGF5IHRleHRcbiAgICAgICAgICBjb25zdCBwYXRoID0gd2lraUxpbmtNYXRjaFsxXTtcbiAgICAgICAgICAvLyBVc2UgdGhlIGRpc3BsYXkgdGV4dCBpZiBwcm92aWRlZCwgb3RoZXJ3aXNlIHVzZSB0aGUgY2xlYW4gZmlsZW5hbWVcbiAgICAgICAgICBjb25zdCBkaXNwbGF5VGV4dCA9IHdpa2lMaW5rTWF0Y2hbMl0gfHwgdGhpcy5nZXRDbGVhbkZpbGVuYW1lKHBhdGgpO1xuICAgICAgICAgIFxuICAgICAgICAgIGNvbnNvbGUubG9nKGBEQVRBQ0FSRFMgREVCVUc6IFdpa2kgbGluayBwYXRoOiBcIiR7cGF0aH1cIiwgZGlzcGxheSB0ZXh0OiBcIiR7ZGlzcGxheVRleHR9XCJgKTtcbiAgICAgICAgICBMb2dnZXIuZGVidWcoYFdpa2kgbGluayBwYXRoOiBcIiR7cGF0aH1cIiwgZGlzcGxheSB0ZXh0OiBcIiR7ZGlzcGxheVRleHR9XCJgKTtcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBDcmVhdGUgYSBwcm9wZXIgT2JzaWRpYW4gaW50ZXJuYWwgbGluayB1c2luZyB0aGUgc2FtZSBhcHByb2FjaCBhcyBmb3JtYXRGaWxlUHJvcGVydHlcbiAgICAgICAgICBjb25zb2xlLmxvZygnREFUQUNBUkRTIERFQlVHOiBDcmVhdGluZyBsaW5rIGVsZW1lbnQgZm9yIHdpa2kgbGluaycpO1xuICAgICAgICAgIGNvbnN0IGxpbmsgPSB2YWx1ZUVsLmNyZWF0ZUVsKCdhJywge1xuICAgICAgICAgICAgY2xzOiAnaW50ZXJuYWwtbGluayBkYXRhY2FyZHMtZmlsZS1saW5rJyxcbiAgICAgICAgICAgIHRleHQ6IGRpc3BsYXlUZXh0LFxuICAgICAgICAgICAgYXR0cjogeyBcbiAgICAgICAgICAgICAgaHJlZjogcGF0aCxcbiAgICAgICAgICAgICAgJ2RhdGEtaHJlZic6IHBhdGgsXG4gICAgICAgICAgICAgICdkYXRhLXR5cGUnOiAnbGluaydcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgICBjb25zb2xlLmxvZygnREFUQUNBUkRTIERFQlVHOiBMaW5rIGVsZW1lbnQgY3JlYXRlZDonLCBsaW5rKTtcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBSZWdpc3RlciB0aGUgbGluayB3aXRoIE9ic2lkaWFuJ3MgY2xpY2sgaGFuZGxlclxuICAgICAgICAgIHRoaXMuYXBwLndvcmtzcGFjZS50cmlnZ2VyKCdob3Zlci1saW5rJywge1xuICAgICAgICAgICAgZXZlbnQ6IG5ldyBNb3VzZUV2ZW50KCdtb3VzZW92ZXInKSxcbiAgICAgICAgICAgIHNvdXJjZTogJ3ByZXZpZXcnLFxuICAgICAgICAgICAgaG92ZXJFbDogbGluayxcbiAgICAgICAgICAgIHRhcmdldEVsOiBsaW5rLFxuICAgICAgICAgICAgbGlua3RleHQ6IHBhdGhcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gQ2hlY2sgZm9yIG1hcmtkb3duIGltYWdlIHN5bnRheDogIVthbHQgdGV4dF0odXJsKSBvciAhW3xzaXplXSh1cmwpXG4gICAgICBjb25zdCBtYXJrZG93bkltYWdlTWF0Y2ggPSB2YWx1ZS5tYXRjaCgvIVxcWyguKj8pXFxdXFwoKC4qPylcXCkvKTtcbiAgICAgIGlmIChtYXJrZG93bkltYWdlTWF0Y2gpIHtcbiAgICAgICAgTG9nZ2VyLmRlYnVnKCdGb3VuZCBtYXJrZG93biBpbWFnZSBpbiBwcm9wZXJ0eSB2YWx1ZScpO1xuICAgICAgICBjb25zdCBpbWFnZVVybCA9IG1hcmtkb3duSW1hZ2VNYXRjaFsyXTtcbiAgICAgICAgY29uc3QgYWx0VGV4dCA9IG1hcmtkb3duSW1hZ2VNYXRjaFsxXTtcbiAgICAgICAgXG4gICAgICAgIC8vIEFkZCBsb2FkaW5nIGNsYXNzIGluaXRpYWxseVxuICAgICAgICB2YWx1ZUVsLmFkZENsYXNzKCdsb2FkaW5nJyk7XG4gICAgICAgIFxuICAgICAgICAvLyBDcmVhdGUgYW4gaW1hZ2UgZWxlbWVudCB3aXRoIGNyb3Nzb3JpZ2luIGF0dHJpYnV0ZSBmb3IgZXh0ZXJuYWwgVVJMc1xuICAgICAgICBjb25zdCBpbWcgPSB2YWx1ZUVsLmNyZWF0ZUVsKCdpbWcnLCB7XG4gICAgICAgICAgY2xzOiAnZGF0YWNhcmRzLXByb3BlcnR5LWltYWdlIGxvYWRpbmcnLFxuICAgICAgICAgIGF0dHI6IHsgXG4gICAgICAgICAgICBzcmM6IGltYWdlVXJsLFxuICAgICAgICAgICAgYWx0OiBhbHRUZXh0IHx8ICdJbWFnZScsXG4gICAgICAgICAgICBjcm9zc29yaWdpbjogJ2Fub255bW91cycgLy8gQWRkIGNyb3Nzb3JpZ2luIGF0dHJpYnV0ZSB0byBoZWxwIHdpdGggQ09SUyBpc3N1ZXNcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgLy8gUmVtb3ZlIGxvYWRpbmcgY2xhc3Mgd2hlbiBpbWFnZSBsb2Fkc1xuICAgICAgICBpbWcub25sb2FkID0gKCkgPT4ge1xuICAgICAgICAgIExvZ2dlci5kZWJ1ZygnUHJvcGVydHkgaW1hZ2UgbG9hZGVkIHN1Y2Nlc3NmdWxseTonLCBpbWFnZVVybCk7XG4gICAgICAgICAgaW1nLnJlbW92ZUNsYXNzKCdsb2FkaW5nJyk7XG4gICAgICAgIH07XG4gICAgICAgIFxuICAgICAgICAvLyBBZGQgZXJyb3IgaGFuZGxpbmcgZm9yIHByb3BlcnR5IGltYWdlc1xuICAgICAgICBpbWcub25lcnJvciA9ICgpID0+IHtcbiAgICAgICAgICBMb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byBsb2FkIHByb3BlcnR5IGltYWdlOicsIGltYWdlVXJsKTtcbiAgICAgICAgICAvLyBSZW1vdmUgdGhlIGltYWdlXG4gICAgICAgICAgaW1nLnJlbW92ZSgpO1xuICAgICAgICAgIC8vIEFkZCBlcnJvciBjbGFzcyBhbmQgbWVzc2FnZVxuICAgICAgICAgIHZhbHVlRWwucmVtb3ZlQ2xhc3MoJ2xvYWRpbmcnKTtcbiAgICAgICAgICB2YWx1ZUVsLmFkZENsYXNzKCdpbWFnZS1lcnJvcicpO1xuICAgICAgICAgIHZhbHVlRWwuc2V0VGV4dCgnSW1hZ2Ugbm90IGZvdW5kOiAnICsgaW1hZ2VVcmwpO1xuICAgICAgICB9O1xuICAgICAgICBcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgXG4gICAgICBpZiAodmFsdWUuc3RhcnRzV2l0aCgnW1snKSAmJiB2YWx1ZS5lbmRzV2l0aCgnXV0nKSkge1xuICAgICAgICAvLyBXaWtpIGxpbmtcbiAgICAgICAgY29uc29sZS5sb2coJ0RBVEFDQVJEUyBERUJVRzogUHJvY2Vzc2luZyB3aWtpIGxpbmsgdGhhdCBzdGFydHMgYW5kIGVuZHMgd2l0aCBbW11dOicsIHZhbHVlKTtcbiAgICAgICAgTG9nZ2VyLmRlYnVnKCdQcm9jZXNzaW5nIHdpa2kgbGluayB0aGF0IHN0YXJ0cyBhbmQgZW5kcyB3aXRoIFtbXV06JywgdmFsdWUpO1xuICAgICAgICBcbiAgICAgICAgLy8gVXNlIHRoZSBzYW1lIHJvYnVzdCByZWdleCBhcyBhYm92ZVxuICAgICAgICBjb25zdCB3aWtpTGlua1JlZ2V4ID0gL1xcW1xcWyhbXlxcXXxdKykoPzpcXHwoW15cXF1dKykpP1xcXVxcXS87XG4gICAgICAgIGNvbnN0IHdpa2lMaW5rTWF0Y2ggPSB2YWx1ZS5tYXRjaCh3aWtpTGlua1JlZ2V4KTtcbiAgICAgICAgXG4gICAgICAgIGlmICh3aWtpTGlua01hdGNoKSB7XG4gICAgICAgICAgLy8gRXh0cmFjdCBwYXRoIGFuZCBkaXNwbGF5IHRleHRcbiAgICAgICAgICBjb25zdCBwYXRoID0gd2lraUxpbmtNYXRjaFsxXTtcbiAgICAgICAgICAvLyBVc2UgdGhlIGRpc3BsYXkgdGV4dCBpZiBwcm92aWRlZCwgb3RoZXJ3aXNlIHVzZSB0aGUgY2xlYW4gZmlsZW5hbWVcbiAgICAgICAgICBjb25zdCBkaXNwbGF5VGV4dCA9IHdpa2lMaW5rTWF0Y2hbMl0gfHwgdGhpcy5nZXRDbGVhbkZpbGVuYW1lKHBhdGgpO1xuICAgICAgICAgIFxuICAgICAgICAgIGNvbnNvbGUubG9nKGBEQVRBQ0FSRFMgREVCVUc6IFdpa2kgbGluayBwYXRoOiBcIiR7cGF0aH1cIiwgZGlzcGxheSB0ZXh0OiBcIiR7ZGlzcGxheVRleHR9XCJgKTtcbiAgICAgICAgICBMb2dnZXIuZGVidWcoYFdpa2kgbGluayBwYXRoOiBcIiR7cGF0aH1cIiwgZGlzcGxheSB0ZXh0OiBcIiR7ZGlzcGxheVRleHR9XCJgKTtcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBDcmVhdGUgYSBwcm9wZXIgT2JzaWRpYW4gaW50ZXJuYWwgbGluayB1c2luZyB0aGUgc2FtZSBhcHByb2FjaCBhcyBmb3JtYXRGaWxlUHJvcGVydHlcbiAgICAgICAgICBjb25zb2xlLmxvZygnREFUQUNBUkRTIERFQlVHOiBDcmVhdGluZyBsaW5rIGVsZW1lbnQgZm9yIHdpa2kgbGluayAoZGlyZWN0IG1hdGNoKScpO1xuICAgICAgICAgIGNvbnN0IGxpbmsgPSB2YWx1ZUVsLmNyZWF0ZUVsKCdhJywge1xuICAgICAgICAgICAgY2xzOiAnaW50ZXJuYWwtbGluayBkYXRhY2FyZHMtZmlsZS1saW5rJyxcbiAgICAgICAgICAgIHRleHQ6IGRpc3BsYXlUZXh0LFxuICAgICAgICAgICAgYXR0cjogeyBcbiAgICAgICAgICAgICAgaHJlZjogcGF0aCxcbiAgICAgICAgICAgICAgJ2RhdGEtaHJlZic6IHBhdGgsXG4gICAgICAgICAgICAgICdkYXRhLXR5cGUnOiAnbGluaydcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgICBjb25zb2xlLmxvZygnREFUQUNBUkRTIERFQlVHOiBMaW5rIGVsZW1lbnQgY3JlYXRlZCAoZGlyZWN0IG1hdGNoKTonLCBsaW5rKTtcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBSZWdpc3RlciB0aGUgbGluayB3aXRoIE9ic2lkaWFuJ3MgY2xpY2sgaGFuZGxlclxuICAgICAgICAgIHRoaXMuYXBwLndvcmtzcGFjZS50cmlnZ2VyKCdob3Zlci1saW5rJywge1xuICAgICAgICAgICAgZXZlbnQ6IG5ldyBNb3VzZUV2ZW50KCdtb3VzZW92ZXInKSxcbiAgICAgICAgICAgIHNvdXJjZTogJ3ByZXZpZXcnLFxuICAgICAgICAgICAgaG92ZXJFbDogbGluayxcbiAgICAgICAgICAgIHRhcmdldEVsOiBsaW5rLFxuICAgICAgICAgICAgbGlua3RleHQ6IHBhdGhcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBGYWxsYmFjayB0byB0aGUgb2xkIG1ldGhvZCBpZiB0aGUgcmVnZXggZG9lc24ndCBtYXRjaFxuICAgICAgICAgIGNvbnN0IGxpbmtUZXh0ID0gdmFsdWUuc3Vic3RyaW5nKDIsIHZhbHVlLmxlbmd0aCAtIDIpO1xuICAgICAgICAgIFxuICAgICAgICAgIC8vIEhhbmRsZSBkaXNwbGF5IHRleHQgaWYgcHJlc2VudCAoZm9ybWF0OiBbW3BhdGh8ZGlzcGxheVRleHRdXSlcbiAgICAgICAgICBsZXQgZGlzcGxheVRleHQgPSBsaW5rVGV4dDtcbiAgICAgICAgICBsZXQgcGF0aCA9IGxpbmtUZXh0O1xuICAgICAgICAgIFxuICAgICAgICAgIGlmIChsaW5rVGV4dC5pbmNsdWRlcygnfCcpKSB7XG4gICAgICAgICAgICBjb25zdCBwYXJ0cyA9IGxpbmtUZXh0LnNwbGl0KCd8Jyk7XG4gICAgICAgICAgICBwYXRoID0gcGFydHNbMF07XG4gICAgICAgICAgICBkaXNwbGF5VGV4dCA9IHBhcnRzWzFdO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBObyBkaXNwbGF5IHRleHQgcHJvdmlkZWQsIGV4dHJhY3QganVzdCB0aGUgZmlsZW5hbWUgd2l0aG91dCBleHRlbnNpb25cbiAgICAgICAgICAgIGRpc3BsYXlUZXh0ID0gdGhpcy5nZXRDbGVhbkZpbGVuYW1lKHBhdGgpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBcbiAgICAgICAgICBMb2dnZXIuZGVidWcoYEZhbGxiYWNrIHdpa2kgbGluayBwYXRoOiBcIiR7cGF0aH1cIiwgZGlzcGxheSB0ZXh0OiBcIiR7ZGlzcGxheVRleHR9XCJgKTtcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBDcmVhdGUgYSBwcm9wZXIgT2JzaWRpYW4gaW50ZXJuYWwgbGluayB1c2luZyB0aGUgc2FtZSBhcHByb2FjaCBhcyBmb3JtYXRGaWxlUHJvcGVydHlcbiAgICAgICAgICBjb25zdCBsaW5rID0gdmFsdWVFbC5jcmVhdGVFbCgnYScsIHtcbiAgICAgICAgICAgIGNsczogJ2ludGVybmFsLWxpbmsgZGF0YWNhcmRzLWZpbGUtbGluaycsXG4gICAgICAgICAgICB0ZXh0OiBkaXNwbGF5VGV4dCxcbiAgICAgICAgICAgIGF0dHI6IHsgXG4gICAgICAgICAgICAgIGhyZWY6IHBhdGgsXG4gICAgICAgICAgICAgICdkYXRhLWhyZWYnOiBwYXRoLFxuICAgICAgICAgICAgICAnZGF0YS10eXBlJzogJ2xpbmsnXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gUmVnaXN0ZXIgdGhlIGxpbmsgd2l0aCBPYnNpZGlhbidzIGNsaWNrIGhhbmRsZXJcbiAgICAgICAgICB0aGlzLmFwcC53b3Jrc3BhY2UudHJpZ2dlcignaG92ZXItbGluaycsIHtcbiAgICAgICAgICAgIGV2ZW50OiBuZXcgTW91c2VFdmVudCgnbW91c2VvdmVyJyksXG4gICAgICAgICAgICBzb3VyY2U6ICdwcmV2aWV3JyxcbiAgICAgICAgICAgIGhvdmVyRWw6IGxpbmssXG4gICAgICAgICAgICB0YXJnZXRFbDogbGluayxcbiAgICAgICAgICAgIGxpbmt0ZXh0OiBwYXRoXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAodmFsdWUuc3RhcnRzV2l0aCgnIycpKSB7XG4gICAgICAgIC8vIFRhZyAtIG1ha2UgaXQgYSBjbGlja2FibGUgbGlua1xuICAgICAgICBjb25zdCB0YWcgPSB2YWx1ZUVsLmNyZWF0ZUVsKCdhJywge1xuICAgICAgICAgIGNsczogJ2RhdGFjYXJkcy10YWcgdGFnLWxpbmsnLFxuICAgICAgICAgIHRleHQ6IHZhbHVlLFxuICAgICAgICAgIGF0dHI6IHtcbiAgICAgICAgICAgIGhyZWY6IHZhbHVlLFxuICAgICAgICAgICAgJ2RhdGEtaHJlZic6IHZhbHVlLFxuICAgICAgICAgICAgJ2RhdGEtdHlwZSc6ICd0YWcnXG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSBpZiAoLzxbdWJpYV0+fDxcXC9bdWJpYV0+fDxzcGFufDxkaXZ8PHA+fDxcXC9wPnw8YnI+fDxocj4vLnRlc3QodmFsdWUpKSB7XG4gICAgICAgIC8vIENvbnRhaW5zIEhUTUwgdGFncyAtIHJlbmRlciBhcyBIVE1MIHdpdGggc2FuaXRpemF0aW9uXG4gICAgICAgIGNvbnNvbGUubG9nKCdEQVRBQ0FSRFMgREVCVUc6IFJlbmRlcmluZyBIVE1MIGNvbnRlbnQ6JywgdmFsdWUpO1xuICAgICAgICBcbiAgICAgICAgLy8gVXNlIHNldElubmVySFRNTCBmb3IgSFRNTCBjb250ZW50XG4gICAgICAgIC8vIFRoaXMgYWxsb3dzIDx1PiwgPGI+LCA8aT4sIDxhPiwgZXRjLiB0YWdzIHRvIHJlbmRlciBwcm9wZXJseVxuICAgICAgICB2YWx1ZUVsLmlubmVySFRNTCA9IHZhbHVlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gUmVndWxhciB0ZXh0IHdpdGhvdXQgSFRNTFxuICAgICAgICB2YWx1ZUVsLnNldFRleHQodmFsdWUpO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiB2YWx1ZSAhPT0gbnVsbCkge1xuICAgICAgLy8gQ2hlY2sgaWYgaXQncyBhIERhdGF2aWV3IExpbmsgb2JqZWN0XG4gICAgICBpZiAoJ3BhdGgnIGluIHZhbHVlICYmICd0eXBlJyBpbiB2YWx1ZSAmJiB2YWx1ZS50eXBlID09PSAnZmlsZScpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ0hhbmRsaW5nIERhdGF2aWV3IExpbmsgb2JqZWN0OicsIHZhbHVlKTtcbiAgICAgICAgXG4gICAgICAgIC8vIEV4dHJhY3QgcGF0aCBhbmQgZGlzcGxheSB0ZXh0XG4gICAgICAgIGNvbnN0IHBhdGggPSB2YWx1ZS5wYXRoO1xuICAgICAgICAvLyBVc2UgZGlzcGxheSBpZiBhdmFpbGFibGUsIG90aGVyd2lzZSB1c2UgdGhlIGNsZWFuIGZpbGVuYW1lXG4gICAgICAgIGNvbnN0IGRpc3BsYXlUZXh0ID0gdmFsdWUuZGlzcGxheSB8fCB0aGlzLmdldENsZWFuRmlsZW5hbWUocGF0aCk7XG4gICAgICAgIFxuICAgICAgICBjb25zb2xlLmxvZyhgQ3JlYXRpbmcgbGluayBmcm9tIERhdGF2aWV3IExpbmsgb2JqZWN0OiBwYXRoPVwiJHtwYXRofVwiLCBkaXNwbGF5PVwiJHtkaXNwbGF5VGV4dH1cImApO1xuICAgICAgICBcbiAgICAgICAgLy8gQ3JlYXRlIGEgcHJvcGVyIE9ic2lkaWFuIGludGVybmFsIGxpbmtcbiAgICAgICAgY29uc3QgbGluayA9IHZhbHVlRWwuY3JlYXRlRWwoJ2EnLCB7XG4gICAgICAgICAgY2xzOiAnaW50ZXJuYWwtbGluaycsXG4gICAgICAgICAgdGV4dDogZGlzcGxheVRleHQsXG4gICAgICAgICAgYXR0cjogeyBcbiAgICAgICAgICAgIGhyZWY6IHBhdGgsXG4gICAgICAgICAgICAnZGF0YS1ocmVmJzogcGF0aCxcbiAgICAgICAgICAgICdkYXRhLXR5cGUnOiAnbGluaydcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgLy8gUmVnaXN0ZXIgdGhlIGxpbmsgd2l0aCBPYnNpZGlhbidzIGNsaWNrIGhhbmRsZXJcbiAgICAgICAgdGhpcy5hcHAud29ya3NwYWNlLnRyaWdnZXIoJ2hvdmVyLWxpbmsnLCB7XG4gICAgICAgICAgZXZlbnQ6IG5ldyBNb3VzZUV2ZW50KCdtb3VzZW92ZXInKSxcbiAgICAgICAgICBzb3VyY2U6ICdwcmV2aWV3JyxcbiAgICAgICAgICBob3ZlckVsOiBsaW5rLFxuICAgICAgICAgIHRhcmdldEVsOiBsaW5rLFxuICAgICAgICAgIGxpbmt0ZXh0OiBwYXRoXG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBDaGVjayBpZiBpdCdzIGEgRGF0YXZpZXcgZGF0ZSBvYmplY3QgKGhhcyBhICd0cycgcHJvcGVydHkpXG4gICAgICBpZiAoJ3RzJyBpbiB2YWx1ZSAmJiB0eXBlb2YgdmFsdWUudHMgPT09ICdudW1iZXInKSB7XG4gICAgICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZSh2YWx1ZS50cyk7XG4gICAgICAgIGlmICghaXNOYU4oZGF0ZS5nZXRUaW1lKCkpKSB7XG4gICAgICAgICAgdGhpcy5mb3JtYXRBc0RhdGUodmFsdWVFbCwgZGF0ZSk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIERlZmF1bHQgdG8gc3RyaW5nIHJlcHJlc2VudGF0aW9uIGZvciBvdGhlciBvYmplY3RzXG4gICAgICB2YWx1ZUVsLnNldFRleHQoU3RyaW5nKHZhbHVlKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIERlZmF1bHQgdG8gc3RyaW5nIHJlcHJlc2VudGF0aW9uXG4gICAgICB2YWx1ZUVsLnNldFRleHQoU3RyaW5nKHZhbHVlKSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEZvcm1hdCBhIHZhbHVlIGFzIHN0YXJzIChmb3IgcmF0aW5ncylcbiAgICogXG4gICAqIEBwYXJhbSBjb250YWluZXIgVGhlIGNvbnRhaW5lciBlbGVtZW50XG4gICAqIEBwYXJhbSB2YWx1ZSBUaGUgdmFsdWUgdG8gZm9ybWF0XG4gICAqIEBwYXJhbSBvcHRpb25zIEZvcm1hdHRpbmcgb3B0aW9uc1xuICAgKi9cbiAgcHJpdmF0ZSBmb3JtYXRBc1N0YXJzKGNvbnRhaW5lcjogSFRNTEVsZW1lbnQsIHZhbHVlOiBudW1iZXIsIG9wdGlvbnM/OiBhbnkpOiB2b2lkIHtcbiAgICBjb25zdCBtYXhTdGFycyA9IG9wdGlvbnM/Lm1heCB8fCA1O1xuICAgIGNvbnN0IHN0YXJGdWxsID0gJ1x1MjYwNSc7XG4gICAgY29uc3Qgc3RhckVtcHR5ID0gJ1x1MjYwNic7XG4gICAgXG4gICAgY29uc3Qgc3RhcnNDb250YWluZXIgPSBjb250YWluZXIuY3JlYXRlRWwoJ2RpdicsIHtcbiAgICAgIGNsczogJ2RhdGFjYXJkcy1zdGFycycsXG4gICAgfSk7XG4gICAgXG4gICAgY29uc3QgbnVtU3RhcnMgPSBNYXRoLm1pbihNYXRoLm1heCgwLCB2YWx1ZSksIG1heFN0YXJzKTtcbiAgICBcbiAgICAvLyBBZGQgZnVsbCBzdGFyc1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtU3RhcnM7IGkrKykge1xuICAgICAgc3RhcnNDb250YWluZXIuY3JlYXRlRWwoJ3NwYW4nLCB7XG4gICAgICAgIGNsczogJ2RhdGFjYXJkcy1zdGFyIGRhdGFjYXJkcy1zdGFyLWZ1bGwnLFxuICAgICAgICB0ZXh0OiBzdGFyRnVsbCxcbiAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICAvLyBBZGQgZW1wdHkgc3RhcnNcbiAgICBmb3IgKGxldCBpID0gbnVtU3RhcnM7IGkgPCBtYXhTdGFyczsgaSsrKSB7XG4gICAgICBzdGFyc0NvbnRhaW5lci5jcmVhdGVFbCgnc3BhbicsIHtcbiAgICAgICAgY2xzOiAnZGF0YWNhcmRzLXN0YXIgZGF0YWNhcmRzLXN0YXItZW1wdHknLFxuICAgICAgICB0ZXh0OiBzdGFyRW1wdHksXG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRm9ybWF0IGEgdmFsdWUgYXMgYSBiYWRnZVxuICAgKiBcbiAgICogQHBhcmFtIGNvbnRhaW5lciBUaGUgY29udGFpbmVyIGVsZW1lbnRcbiAgICogQHBhcmFtIHZhbHVlIFRoZSB2YWx1ZSB0byBmb3JtYXRcbiAgICogQHBhcmFtIG9wdGlvbnMgRm9ybWF0dGluZyBvcHRpb25zXG4gICAqL1xuICBwcml2YXRlIGZvcm1hdEFzQmFkZ2UoY29udGFpbmVyOiBIVE1MRWxlbWVudCwgdmFsdWU6IHN0cmluZywgb3B0aW9ucz86IGFueSk6IHZvaWQge1xuICAgIGNvbnN0IGJhZGdlID0gY29udGFpbmVyLmNyZWF0ZUVsKCdzcGFuJywge1xuICAgICAgY2xzOiAnZGF0YWNhcmRzLWJhZGdlJyxcbiAgICAgIHRleHQ6IHZhbHVlLFxuICAgIH0pO1xuICAgIFxuICAgIC8vIEFkZCBjb2xvciBpZiBzcGVjaWZpZWRcbiAgICBpZiAob3B0aW9ucz8uY29sb3IpIHtcbiAgICAgIGJhZGdlLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IG9wdGlvbnMuY29sb3I7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEZvcm1hdCBhIHZhbHVlIGFzIGEgcHJvZ3Jlc3MgYmFyXG4gICAqIFxuICAgKiBAcGFyYW0gY29udGFpbmVyIFRoZSBjb250YWluZXIgZWxlbWVudFxuICAgKiBAcGFyYW0gdmFsdWUgVGhlIHZhbHVlIHRvIGZvcm1hdFxuICAgKiBAcGFyYW0gb3B0aW9ucyBGb3JtYXR0aW5nIG9wdGlvbnNcbiAgICovXG4gIHByaXZhdGUgZm9ybWF0QXNQcm9ncmVzcyhjb250YWluZXI6IEhUTUxFbGVtZW50LCB2YWx1ZTogbnVtYmVyLCBvcHRpb25zPzogYW55KTogdm9pZCB7XG4gICAgY29uc3QgbWF4ID0gb3B0aW9ucz8ubWF4IHx8IDEwMDtcbiAgICBjb25zdCBwZXJjZW50YWdlID0gTWF0aC5taW4oTWF0aC5tYXgoMCwgdmFsdWUpLCBtYXgpIC8gbWF4ICogMTAwO1xuICAgIFxuICAgIGNvbnN0IHByb2dyZXNzQ29udGFpbmVyID0gY29udGFpbmVyLmNyZWF0ZUVsKCdkaXYnLCB7XG4gICAgICBjbHM6ICdkYXRhY2FyZHMtcHJvZ3Jlc3MtY29udGFpbmVyJyxcbiAgICB9KTtcbiAgICBcbiAgICBjb25zdCBwcm9ncmVzc0JhciA9IHByb2dyZXNzQ29udGFpbmVyLmNyZWF0ZUVsKCdkaXYnLCB7XG4gICAgICBjbHM6ICdkYXRhY2FyZHMtcHJvZ3Jlc3MtYmFyJyxcbiAgICB9KTtcbiAgICBcbiAgICBwcm9ncmVzc0Jhci5zdHlsZS53aWR0aCA9IGAke3BlcmNlbnRhZ2V9JWA7XG4gICAgXG4gICAgLy8gQWRkIHRleHQgaWYgc3BlY2lmaWVkXG4gICAgaWYgKG9wdGlvbnM/LnNob3dUZXh0KSB7XG4gICAgICBwcm9ncmVzc0NvbnRhaW5lci5jcmVhdGVFbCgnc3BhbicsIHtcbiAgICAgICAgY2xzOiAnZGF0YWNhcmRzLXByb2dyZXNzLXRleHQnLFxuICAgICAgICB0ZXh0OiBgJHtNYXRoLnJvdW5kKHBlcmNlbnRhZ2UpfSVgLFxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEZvcm1hdCBhIHZhbHVlIGFzIGEgZGF0ZVxuICAgKiBcbiAgICogQHBhcmFtIGNvbnRhaW5lciBUaGUgY29udGFpbmVyIGVsZW1lbnRcbiAgICogQHBhcmFtIHZhbHVlIFRoZSB2YWx1ZSB0byBmb3JtYXRcbiAgICogQHBhcmFtIG9wdGlvbnMgRm9ybWF0dGluZyBvcHRpb25zXG4gICAqL1xuICBwcml2YXRlIGZvcm1hdEFzRGF0ZShjb250YWluZXI6IEhUTUxFbGVtZW50LCB2YWx1ZTogc3RyaW5nIHwgRGF0ZSwgb3B0aW9ucz86IGFueSk6IHZvaWQge1xuICAgIGNvbnN0IGRhdGUgPSB0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnID8gbmV3IERhdGUodmFsdWUpIDogdmFsdWU7XG4gICAgXG4gICAgaWYgKGlzTmFOKGRhdGUuZ2V0VGltZSgpKSkge1xuICAgICAgY29udGFpbmVyLnNldFRleHQoU3RyaW5nKHZhbHVlKSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIFxuICAgIC8vIFVzZSB0aGUgZm9ybWF0IGZyb20gb3B0aW9ucywgb3IgZnJvbSB0aGUgY3VycmVudCBzZXR0aW5ncywgb3IgZmFsbCBiYWNrIHRvIHRoZSBkZWZhdWx0IGZvcm1hdFxuICAgIGNvbnN0IGZvcm1hdCA9IG9wdGlvbnM/LmZvcm1hdCB8fCAodGhpcy5jdXJyZW50U2V0dGluZ3MgPyB0aGlzLmN1cnJlbnRTZXR0aW5ncy5kZWZhdWx0RGF0ZUZvcm1hdCA6IERFRkFVTFRfU0VUVElOR1MuZGVmYXVsdERhdGVGb3JtYXQpO1xuICAgIFxuICAgIC8vIFNpbXBsZSBkYXRlIGZvcm1hdHRpbmdcbiAgICBjb25zdCB5ZWFyID0gZGF0ZS5nZXRGdWxsWWVhcigpO1xuICAgIGNvbnN0IG1vbnRoID0gKGRhdGUuZ2V0TW9udGgoKSArIDEpLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKTtcbiAgICBjb25zdCBkYXkgPSBkYXRlLmdldERhdGUoKS50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJyk7XG4gICAgXG4gICAgbGV0IGZvcm1hdHRlZERhdGUgPSBmb3JtYXRcbiAgICAgIC5yZXBsYWNlKCdZWVlZJywgeWVhci50b1N0cmluZygpKVxuICAgICAgLnJlcGxhY2UoJ01NJywgbW9udGgpXG4gICAgICAucmVwbGFjZSgnREQnLCBkYXkpO1xuICAgIFxuICAgIGNvbnRhaW5lci5zZXRUZXh0KGZvcm1hdHRlZERhdGUpO1xuICB9XG5cbiAgLyoqXG4gICAqIEZvcm1hdCBhIGZpbGUgcHJvcGVydHkgYXMgYSBjbGlja2FibGUgbGlua1xuICAgKiBTcGVjaWFsIGhhbmRsaW5nIGZvciB0aGUgZmlsZSBwcm9wZXJ0eSB3aGljaCBpcyBhbHdheXMgYSBsaW5rIHRvIHRoZSBub3RlXG4gICAqIFxuICAgKiBAcGFyYW0gcHJvcGVydHlFbCBUaGUgcHJvcGVydHkgZWxlbWVudFxuICAgKiBAcGFyYW0gdmFsdWUgVGhlIGZpbGUgcHJvcGVydHkgdmFsdWVcbiAgICovXG4gIHByaXZhdGUgZm9ybWF0RmlsZVByb3BlcnR5KHByb3BlcnR5RWw6IEhUTUxFbGVtZW50LCB2YWx1ZTogYW55KTogdm9pZCB7XG4gICAgY29uc3QgdmFsdWVFbCA9IHByb3BlcnR5RWwuY3JlYXRlRWwoJ2RpdicsIHtcbiAgICAgIGNsczogJ2RhdGFjYXJkcy1wcm9wZXJ0eS12YWx1ZSBkYXRhY2FyZHMtZmlsZS1wcm9wZXJ0eScsXG4gICAgfSk7XG4gICAgXG4gICAgLy8gQXBwbHkgdGl0bGUgYWxpZ25tZW50IGlmIHRoaXMgaXMgYSBmaWxlIHByb3BlcnR5ICh0aXRsZSlcbiAgICAvLyBVc2UgdGhlIHRpdGxlQWxpZ24gc2V0dGluZyBmcm9tIHRoZSBjdXJyZW50IHNldHRpbmdzXG4gICAgaWYgKHRoaXMuY3VycmVudFNldHRpbmdzPy50aXRsZUFsaWduKSB7XG4gICAgICB2YWx1ZUVsLmFkZENsYXNzKGBkYXRhY2FyZHMtdGV4dC0ke3RoaXMuY3VycmVudFNldHRpbmdzLnRpdGxlQWxpZ259YCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIEZhbGxiYWNrIHRvIHRoZSBzYW1lIGFsaWdubWVudCBhcyB0aGUgcGFyZW50IHByb3BlcnR5IGVsZW1lbnRcbiAgICAgIC8vIFRoaXMgZW5zdXJlcyBjb25zaXN0ZW50IGFsaWdubWVudCBpZiB0aXRsZUFsaWduIGlzIG5vdCBzZXRcbiAgICAgIGlmIChwcm9wZXJ0eUVsLmhhc0NsYXNzKCdkYXRhY2FyZHMtdGV4dC1sZWZ0JykpIHtcbiAgICAgICAgdmFsdWVFbC5hZGRDbGFzcygnZGF0YWNhcmRzLXRleHQtbGVmdCcpO1xuICAgICAgfSBlbHNlIGlmIChwcm9wZXJ0eUVsLmhhc0NsYXNzKCdkYXRhY2FyZHMtdGV4dC1jZW50ZXInKSkge1xuICAgICAgICB2YWx1ZUVsLmFkZENsYXNzKCdkYXRhY2FyZHMtdGV4dC1jZW50ZXInKTtcbiAgICAgIH0gZWxzZSBpZiAocHJvcGVydHlFbC5oYXNDbGFzcygnZGF0YWNhcmRzLXRleHQtcmlnaHQnKSkge1xuICAgICAgICB2YWx1ZUVsLmFkZENsYXNzKCdkYXRhY2FyZHMtdGV4dC1yaWdodCcpO1xuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICBpZiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgdmFsdWVFbC5zZXRUZXh0KCcnKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgXG4gICAgLy8gSGFuZGxlIGRpZmZlcmVudCB0eXBlcyBvZiBmaWxlIHZhbHVlc1xuICAgIGxldCBzdHJpbmdWYWx1ZTogc3RyaW5nO1xuICAgIFxuICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICE9PSBudWxsKSB7XG4gICAgICAvLyBEYXRhdmlldyByZXR1cm5zIGZpbGUgYXMgYW4gb2JqZWN0IHdpdGggYSBwYXRoIHByb3BlcnR5XG4gICAgICBpZiAoJ3BhdGgnIGluIHZhbHVlKSB7XG4gICAgICAgIHN0cmluZ1ZhbHVlID0gdmFsdWUucGF0aDtcbiAgICAgIH0gZWxzZSBpZiAoJ2xpbmsnIGluIHZhbHVlKSB7XG4gICAgICAgIC8vIE9yIHNvbWV0aW1lcyBhcyBhbiBvYmplY3Qgd2l0aCBhIGxpbmsgcHJvcGVydHlcbiAgICAgICAgc3RyaW5nVmFsdWUgPSB2YWx1ZS5saW5rO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gSWYgaXQncyBzb21lIG90aGVyIG9iamVjdCwgY29udmVydCB0byBzdHJpbmdcbiAgICAgICAgc3RyaW5nVmFsdWUgPSBTdHJpbmcodmFsdWUpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAvLyBJZiBpdCdzIGFscmVhZHkgYSBzdHJpbmcgb3Igc29tZSBvdGhlciB0eXBlLCBjb252ZXJ0IHRvIHN0cmluZ1xuICAgICAgc3RyaW5nVmFsdWUgPSBTdHJpbmcodmFsdWUpO1xuICAgIH1cbiAgICBcbiAgICAvLyBDaGVjayBpZiB0aGUgc3RyaW5nIGNvbnRhaW5zIGEgd2lraSBsaW5rIG9yIFVSTCBhbmQgZXh0cmFjdCBpdFxuICAgIC8vIFRoaXMgaGVscHMgd2l0aCBleHByZXNzaW9ucyB0aGF0IHJlc3VsdCBpbiBzdHJpbmdzIGNvbnRhaW5pbmcgd2lraSBsaW5rcyBvciBVUkxzXG4gICAgc3RyaW5nVmFsdWUgPSB0aGlzLmV4dHJhY3RJbWFnZVNvdXJjZShzdHJpbmdWYWx1ZSk7XG4gICAgTG9nZ2VyLmRlYnVnKCdGaWxlIHByb3BlcnR5IGFmdGVyIGltYWdlIHNvdXJjZSBleHRyYWN0aW9uOicsIHN0cmluZ1ZhbHVlKTtcbiAgICBcbiAgICAgIC8vIERpcmVjdCBhcHByb2FjaCBmb3Igd2lraSBsaW5rcyAtIGp1c3Qgc2V0IHRoZSB0ZXh0IHRvIHRoZSBkaXNwbGF5IHBhcnRcbiAgICAgIC8vIFRoaXMgaXMgYSB3b3JrYXJvdW5kIGZvciB3aGVuIHRoZSBsaW5rIGlzIG5vdCBiZWluZyBwcm9wZXJseSByZW5kZXJlZFxuICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycgJiYgdmFsdWUuaW5jbHVkZXMoJ1tbJykgJiYgdmFsdWUuaW5jbHVkZXMoJ3wnKSAmJiB2YWx1ZS5pbmNsdWRlcygnXV0nKSkge1xuICAgICAgICBjb25zb2xlLmxvZygnREFUQUNBUkRTIERFQlVHOiBGb3VuZCB3aWtpIGxpbmsgd2l0aCBwaXBlIGNoYXJhY3RlcjonLCB2YWx1ZSk7XG4gICAgICAgIC8vIEV4dHJhY3QgdGhlIGRpc3BsYXkgdGV4dCBwYXJ0IChhZnRlciB0aGUgcGlwZSlcbiAgICAgICAgY29uc3QgbWF0Y2ggPSB2YWx1ZS5tYXRjaCgvXFxbXFxbLipcXHwoLio/KVxcXVxcXS8pO1xuICAgICAgICBpZiAobWF0Y2ggJiYgbWF0Y2hbMV0pIHtcbiAgICAgICAgICBjb25zb2xlLmxvZygnREFUQUNBUkRTIERFQlVHOiBFeHRyYWN0ZWQgZGlzcGxheSB0ZXh0OicsIG1hdGNoWzFdKTtcbiAgICAgICAgICAvLyBJbnN0ZWFkIG9mIGp1c3Qgc2V0dGluZyB0ZXh0LCBsZXQncyB0cnkgdG8gY3JlYXRlIGEgcHJvcGVyIGxpbmtcbiAgICAgICAgICBjb25zdCBmdWxsTWF0Y2ggPSB2YWx1ZS5tYXRjaCgvXFxbXFxbKC4qPylcXHwoLio/KVxcXVxcXS8pO1xuICAgICAgICAgIGlmIChmdWxsTWF0Y2gpIHtcbiAgICAgICAgICAgIGNvbnN0IHBhdGggPSBmdWxsTWF0Y2hbMV07XG4gICAgICAgICAgICBjb25zdCBkaXNwbGF5VGV4dCA9IGZ1bGxNYXRjaFsyXTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBEQVRBQ0FSRFMgREVCVUc6IENyZWF0aW5nIGxpbmsgZnJvbSBwaXBlIHN5bnRheCAtIHBhdGg6IFwiJHtwYXRofVwiLCBkaXNwbGF5OiBcIiR7ZGlzcGxheVRleHR9XCJgKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY29uc3QgbGluayA9IHZhbHVlRWwuY3JlYXRlRWwoJ2EnLCB7XG4gICAgICAgICAgICAgIGNsczogJ2ludGVybmFsLWxpbmsgZGF0YWNhcmRzLWZpbGUtbGluaycsXG4gICAgICAgICAgICAgIHRleHQ6IGRpc3BsYXlUZXh0LFxuICAgICAgICAgICAgICBhdHRyOiB7IFxuICAgICAgICAgICAgICAgIGhyZWY6IHBhdGgsXG4gICAgICAgICAgICAgICAgJ2RhdGEtaHJlZic6IHBhdGgsXG4gICAgICAgICAgICAgICAgJ2RhdGEtdHlwZSc6ICdsaW5rJ1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdEQVRBQ0FSRFMgREVCVUc6IENyZWF0ZWQgbGluayBlbGVtZW50IGZvciBwaXBlIHN5bnRheDonLCBsaW5rKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gUmVnaXN0ZXIgdGhlIGxpbmsgd2l0aCBPYnNpZGlhbidzIGNsaWNrIGhhbmRsZXJcbiAgICAgICAgICAgIHRoaXMuYXBwLndvcmtzcGFjZS50cmlnZ2VyKCdob3Zlci1saW5rJywge1xuICAgICAgICAgICAgICBldmVudDogbmV3IE1vdXNlRXZlbnQoJ21vdXNlb3ZlcicpLFxuICAgICAgICAgICAgICBzb3VyY2U6ICdwcmV2aWV3JyxcbiAgICAgICAgICAgICAgaG92ZXJFbDogbGluayxcbiAgICAgICAgICAgICAgdGFyZ2V0RWw6IGxpbmssXG4gICAgICAgICAgICAgIGxpbmt0ZXh0OiBwYXRoXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBGYWxsYmFjayB0byBqdXN0IHRleHQgaWYgd2UgY291bGRuJ3QgcGFyc2UgcHJvcGVybHlcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdEQVRBQ0FSRFMgREVCVUc6IEZhbGxiYWNrIHRvIHRleHQgb25seSBmb3IgcGlwZSBzeW50YXgnKTtcbiAgICAgICAgICAgIHZhbHVlRWwuc2V0VGV4dChtYXRjaFsxXSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgXG4gICAgLy8gTW9yZSBnZW5lcmFsIGNhc2UgZm9yIHdpa2kgbGlua3NcbiAgICBpZiAoc3RyaW5nVmFsdWUuaW5jbHVkZXMoJ1tbJykgJiYgc3RyaW5nVmFsdWUuaW5jbHVkZXMoJ11dJykpIHtcbiAgICAgIExvZ2dlci5kZWJ1ZygnRm91bmQgd2lraSBsaW5rIGluIGZpbGUgcHJvcGVydHk6Jywgc3RyaW5nVmFsdWUpO1xuICAgICAgXG4gICAgICAvLyBFeHRyYWN0IHRoZSB3aWtpIGxpbmsgY29udGVudFxuICAgICAgY29uc3Qgd2lraUxpbmtNYXRjaCA9IHN0cmluZ1ZhbHVlLm1hdGNoKC9cXFtcXFsoW15cXF1dKylcXF1cXF0vKTtcbiAgICAgIGlmICh3aWtpTGlua01hdGNoKSB7XG4gICAgICAgIGNvbnN0IGxpbmtUZXh0ID0gd2lraUxpbmtNYXRjaFsxXTtcbiAgICAgICAgXG4gICAgICAgIC8vIEhhbmRsZSBkaXNwbGF5IHRleHQgaWYgcHJlc2VudCAoZm9ybWF0OiBbW3BhdGh8ZGlzcGxheVRleHRdXSlcbiAgICAgICAgbGV0IGRpc3BsYXlUZXh0ID0gbGlua1RleHQ7XG4gICAgICAgIGxldCBwYXRoID0gbGlua1RleHQ7XG4gICAgICAgIFxuICAgICAgICBpZiAobGlua1RleHQuaW5jbHVkZXMoJ3wnKSkge1xuICAgICAgICAgIGNvbnN0IHBhcnRzID0gbGlua1RleHQuc3BsaXQoJ3wnKTtcbiAgICAgICAgICBwYXRoID0gcGFydHNbMF07XG4gICAgICAgICAgZGlzcGxheVRleHQgPSBwYXJ0c1sxXTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBObyBkaXNwbGF5IHRleHQgcHJvdmlkZWQsIGV4dHJhY3QganVzdCB0aGUgZmlsZW5hbWUgd2l0aG91dCBleHRlbnNpb25cbiAgICAgICAgICBkaXNwbGF5VGV4dCA9IHRoaXMuZ2V0Q2xlYW5GaWxlbmFtZShwYXRoKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8gQ3JlYXRlIGEgcHJvcGVyIE9ic2lkaWFuIGludGVybmFsIGxpbmtcbiAgICAgICAgY29uc3QgbGluayA9IHZhbHVlRWwuY3JlYXRlRWwoJ2EnLCB7XG4gICAgICAgICAgY2xzOiAnaW50ZXJuYWwtbGluayBkYXRhY2FyZHMtZmlsZS1saW5rJyxcbiAgICAgICAgICB0ZXh0OiBkaXNwbGF5VGV4dCxcbiAgICAgICAgICBhdHRyOiB7IFxuICAgICAgICAgICAgaHJlZjogcGF0aCxcbiAgICAgICAgICAgICdkYXRhLWhyZWYnOiBwYXRoLFxuICAgICAgICAgICAgJ2RhdGEtdHlwZSc6ICdsaW5rJ1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICB9XG4gICAgLy8gQ2hlY2sgaWYgaXQncyBhbHJlYWR5IGEgd2lraSBsaW5rXG4gICAgZWxzZSBpZiAoc3RyaW5nVmFsdWUuc3RhcnRzV2l0aCgnW1snKSAmJiBzdHJpbmdWYWx1ZS5lbmRzV2l0aCgnXV0nKSkge1xuICAgICAgLy8gV2lraSBsaW5rXG4gICAgICBjb25zdCBsaW5rVGV4dCA9IHN0cmluZ1ZhbHVlLnN1YnN0cmluZygyLCBzdHJpbmdWYWx1ZS5sZW5ndGggLSAyKTtcbiAgICAgIFxuICAgICAgLy8gSGFuZGxlIGRpc3BsYXkgdGV4dCBpZiBwcmVzZW50IChmb3JtYXQ6IFtbcGF0aHxkaXNwbGF5VGV4dF1dKVxuICAgICAgbGV0IGRpc3BsYXlUZXh0ID0gbGlua1RleHQ7XG4gICAgICBsZXQgcGF0aCA9IGxpbmtUZXh0O1xuICAgICAgXG4gICAgICBpZiAobGlua1RleHQuaW5jbHVkZXMoJ3wnKSkge1xuICAgICAgICBjb25zdCBwYXJ0cyA9IGxpbmtUZXh0LnNwbGl0KCd8Jyk7XG4gICAgICAgIHBhdGggPSBwYXJ0c1swXTtcbiAgICAgICAgZGlzcGxheVRleHQgPSBwYXJ0c1sxXTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIE5vIGRpc3BsYXkgdGV4dCBwcm92aWRlZCwgZXh0cmFjdCBqdXN0IHRoZSBmaWxlbmFtZSB3aXRob3V0IGV4dGVuc2lvblxuICAgICAgICBkaXNwbGF5VGV4dCA9IHRoaXMuZ2V0Q2xlYW5GaWxlbmFtZShwYXRoKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gQ3JlYXRlIGEgcHJvcGVyIE9ic2lkaWFuIGludGVybmFsIGxpbmtcbiAgICAgIGNvbnN0IGxpbmsgPSB2YWx1ZUVsLmNyZWF0ZUVsKCdhJywge1xuICAgICAgICBjbHM6ICdpbnRlcm5hbC1saW5rIGRhdGFjYXJkcy1maWxlLWxpbmsnLFxuICAgICAgICB0ZXh0OiBkaXNwbGF5VGV4dCxcbiAgICAgICAgYXR0cjogeyBcbiAgICAgICAgICBocmVmOiBwYXRoLFxuICAgICAgICAgICdkYXRhLWhyZWYnOiBwYXRoLFxuICAgICAgICAgICdkYXRhLXR5cGUnOiAnbGluaydcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIE5vdCBhIHdpa2kgbGluaywgY3JlYXRlIGEgbGluayBmcm9tIHRoZSBwbGFpbiB0ZXh0XG4gICAgICAvLyBBc3N1bWUgdGhlIHZhbHVlIGlzIGEgZmlsZSBwYXRoIG9yIG5hbWVcbiAgICAgIC8vIEV4dHJhY3QganVzdCB0aGUgZmlsZW5hbWUgd2l0aG91dCBleHRlbnNpb25cbiAgICAgIGNvbnN0IGRpc3BsYXlUZXh0ID0gdGhpcy5nZXRDbGVhbkZpbGVuYW1lKHN0cmluZ1ZhbHVlKTtcbiAgICAgIFxuICAgICAgY29uc3QgbGluayA9IHZhbHVlRWwuY3JlYXRlRWwoJ2EnLCB7XG4gICAgICAgIGNsczogJ2ludGVybmFsLWxpbmsgZGF0YWNhcmRzLWZpbGUtbGluaycsXG4gICAgICAgIHRleHQ6IGRpc3BsYXlUZXh0LFxuICAgICAgICBhdHRyOiB7IFxuICAgICAgICAgIGhyZWY6IHN0cmluZ1ZhbHVlLFxuICAgICAgICAgICdkYXRhLWhyZWYnOiBzdHJpbmdWYWx1ZSxcbiAgICAgICAgICAnZGF0YS10eXBlJzogJ2xpbmsnXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBFeHRyYWN0IGp1c3QgdGhlIGZpbGVuYW1lIHdpdGhvdXQgcGF0aCBhbmQgZXh0ZW5zaW9uXG4gICAqIFxuICAgKiBAcGFyYW0gcGF0aCBUaGUgZmlsZSBwYXRoXG4gICAqIEByZXR1cm5zIFRoZSBjbGVhbiBmaWxlbmFtZVxuICAgKi9cbiAgcHJpdmF0ZSBnZXRDbGVhbkZpbGVuYW1lKHBhdGg6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgLy8gRXh0cmFjdCBqdXN0IHRoZSBmaWxlbmFtZSB3aXRob3V0IGV4dGVuc2lvblxuICAgIGxldCBmaWxlbmFtZSA9IHBhdGg7XG4gICAgXG4gICAgLy8gUmVtb3ZlIHBhdGggaWYgcHJlc2VudCAoZ2V0IGp1c3QgdGhlIGZpbGVuYW1lKVxuICAgIGlmIChmaWxlbmFtZS5pbmNsdWRlcygnLycpKSB7XG4gICAgICBmaWxlbmFtZSA9IGZpbGVuYW1lLnNwbGl0KCcvJykucG9wKCkgfHwgZmlsZW5hbWU7XG4gICAgfVxuICAgIFxuICAgIC8vIFJlbW92ZSAubWQgZXh0ZW5zaW9uIGlmIHByZXNlbnRcbiAgICBpZiAoZmlsZW5hbWUuZW5kc1dpdGgoJy5tZCcpKSB7XG4gICAgICBmaWxlbmFtZSA9IGZpbGVuYW1lLnN1YnN0cmluZygwLCBmaWxlbmFtZS5sZW5ndGggLSAzKTtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIGZpbGVuYW1lO1xuICB9XG5cbiAgLyoqXG4gICAqIEZvcm1hdCBhIHZhbHVlIGFzIHRhZ3NcbiAgICogXG4gICAqIEBwYXJhbSBjb250YWluZXIgVGhlIGNvbnRhaW5lciBlbGVtZW50XG4gICAqIEBwYXJhbSB2YWx1ZSBUaGUgdmFsdWUgdG8gZm9ybWF0XG4gICAqIEBwYXJhbSBvcHRpb25zIEZvcm1hdHRpbmcgb3B0aW9uc1xuICAgKi9cbiAgcHJpdmF0ZSBmb3JtYXRBc1RhZ3MoY29udGFpbmVyOiBIVE1MRWxlbWVudCwgdmFsdWU6IHN0cmluZyB8IHN0cmluZ1tdLCBvcHRpb25zPzogYW55KTogdm9pZCB7XG4gICAgY29uc3QgdGFnc0NvbnRhaW5lciA9IGNvbnRhaW5lci5jcmVhdGVFbCgnZGl2Jywge1xuICAgICAgY2xzOiAnZGF0YWNhcmRzLXRhZ3MtY29udGFpbmVyJyxcbiAgICB9KTtcbiAgICBcbiAgICBjb25zdCB0YWdzID0gQXJyYXkuaXNBcnJheSh2YWx1ZSkgPyB2YWx1ZSA6IFt2YWx1ZV07XG4gICAgXG4gICAgdGFncy5mb3JFYWNoKCh0YWc6IHN0cmluZykgPT4ge1xuICAgICAgLy8gRW5zdXJlIHRhZyBzdGFydHMgd2l0aCAjXG4gICAgICBjb25zdCB0YWdUZXh0ID0gdGFnLnN0YXJ0c1dpdGgoJyMnKSA/IHRhZyA6IGAjJHt0YWd9YDtcbiAgICAgIFxuICAgICAgLy8gQ3JlYXRlIGEgY2xpY2thYmxlIHRhZyBsaW5rXG4gICAgICBjb25zdCB0YWdFbCA9IHRhZ3NDb250YWluZXIuY3JlYXRlRWwoJ2EnLCB7XG4gICAgICAgIGNsczogJ2RhdGFjYXJkcy10YWcgdGFnLWxpbmsnLFxuICAgICAgICB0ZXh0OiB0YWdUZXh0LFxuICAgICAgICBhdHRyOiB7XG4gICAgICAgICAgaHJlZjogdGFnVGV4dCxcbiAgICAgICAgICAnZGF0YS1ocmVmJzogdGFnVGV4dCxcbiAgICAgICAgICAnZGF0YS10eXBlJzogJ3RhZydcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cbiAgXG4gIC8qKlxuICAgKiBEZXRlcm1pbmUgaWYgcHJvcGVydGllcyBzaG91bGQgYmUgc2Nyb2xsYWJsZSBiYXNlZCBvbiBzZXR0aW5ncyBwcmVjZWRlbmNlXG4gICAqIFxuICAgKiBAcGFyYW0gc2V0dGluZ3MgVGhlIG1lcmdlZCBzZXR0aW5nc1xuICAgKiBAcmV0dXJucyBUcnVlIGlmIHByb3BlcnRpZXMgc2hvdWxkIGJlIHNjcm9sbGFibGUsIGZhbHNlIG90aGVyd2lzZVxuICAgKi9cbiAgcHJpdmF0ZSBzaG91bGRVc2VTY3JvbGxhYmxlUHJvcGVydGllcyhzZXR0aW5nczogRGF0YUNhcmRzU2V0dGluZ3MpOiBib29sZWFuIHtcbiAgICAvLyBTdGFydCB3aXRoIHByZXNldC1zcGVjaWZpYyBkZWZhdWx0c1xuICAgIGxldCBzaG91bGRTY3JvbGwgPSBmYWxzZTtcbiAgICBcbiAgICAvLyBTcXVhcmUgYW5kIGNvbXBhY3QgcHJlc2V0cyBhcmUgc2Nyb2xsYWJsZSBieSBkZWZhdWx0XG4gICAgaWYgKHNldHRpbmdzLnByZXNldCA9PT0gJ3NxdWFyZScgfHwgc2V0dGluZ3MucHJlc2V0ID09PSAnY29tcGFjdCcpIHtcbiAgICAgIHNob3VsZFNjcm9sbCA9IHRydWU7XG4gICAgfVxuICAgIFxuICAgIC8vIEFwcGx5IGdsb2JhbCBwbHVnaW4gc2V0dGluZ3NcbiAgICBpZiAodGhpcy5wbHVnaW5TZXR0aW5ncy5zY3JvbGxhYmxlUHJvcGVydGllcyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBzaG91bGRTY3JvbGwgPSB0aGlzLnBsdWdpblNldHRpbmdzLnNjcm9sbGFibGVQcm9wZXJ0aWVzO1xuICAgIH1cbiAgICBcbiAgICAvLyBBcHBseSBtb2JpbGUgc2V0dGluZ3MgaWYgb24gbW9iaWxlXG4gICAgY29uc3QgaXNNb2JpbGUgPSB0aGlzLmlzTW9iaWxlRGV2aWNlKCk7XG4gICAgaWYgKGlzTW9iaWxlICYmIHRoaXMucGx1Z2luU2V0dGluZ3MubW9iaWxlU2Nyb2xsYWJsZVByb3BlcnRpZXMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgc2hvdWxkU2Nyb2xsID0gdGhpcy5wbHVnaW5TZXR0aW5ncy5tb2JpbGVTY3JvbGxhYmxlUHJvcGVydGllcztcbiAgICB9XG4gICAgXG4gICAgLy8gQmxvY2sgc2V0dGluZ3MgaGF2ZSBoaWdoZXN0IHByaW9yaXR5XG4gICAgaWYgKHNldHRpbmdzLnNjcm9sbGFibGVQcm9wZXJ0aWVzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHNob3VsZFNjcm9sbCA9IHNldHRpbmdzLnNjcm9sbGFibGVQcm9wZXJ0aWVzO1xuICAgIH1cbiAgICBcbiAgICByZXR1cm4gc2hvdWxkU2Nyb2xsO1xuICB9XG4gIFxuICAvKipcbiAgICogR2V0IHRoZSBjb250ZW50IGhlaWdodCBiYXNlZCBvbiBzZXR0aW5ncyBwcmVjZWRlbmNlXG4gICAqIFxuICAgKiBAcGFyYW0gc2V0dGluZ3MgVGhlIG1lcmdlZCBzZXR0aW5nc1xuICAgKiBAcmV0dXJucyBUaGUgY29udGVudCBoZWlnaHQgYXMgYSBzdHJpbmcgKGUuZy4sICcyMDBweCcpXG4gICAqL1xuICBwcml2YXRlIGdldENvbnRlbnRIZWlnaHQoc2V0dGluZ3M6IERhdGFDYXJkc1NldHRpbmdzKTogc3RyaW5nIHtcbiAgICAvLyBTdGFydCB3aXRoIGRlZmF1bHRcbiAgICBsZXQgY29udGVudEhlaWdodCA9ICcyMDBweCc7XG4gICAgXG4gICAgLy8gQXBwbHkgZ2xvYmFsIHBsdWdpbiBzZXR0aW5nc1xuICAgIGlmICh0aGlzLnBsdWdpblNldHRpbmdzLmNvbnRlbnRIZWlnaHQpIHtcbiAgICAgIGNvbnRlbnRIZWlnaHQgPSB0aGlzLnBsdWdpblNldHRpbmdzLmNvbnRlbnRIZWlnaHQ7XG4gICAgfVxuICAgIFxuICAgIC8vIEFwcGx5IG1vYmlsZSBzZXR0aW5ncyBpZiBvbiBtb2JpbGVcbiAgICBjb25zdCBpc01vYmlsZSA9IHRoaXMuaXNNb2JpbGVEZXZpY2UoKTtcbiAgICBpZiAoaXNNb2JpbGUgJiYgdGhpcy5wbHVnaW5TZXR0aW5ncy5tb2JpbGVDb250ZW50SGVpZ2h0KSB7XG4gICAgICBjb250ZW50SGVpZ2h0ID0gdGhpcy5wbHVnaW5TZXR0aW5ncy5tb2JpbGVDb250ZW50SGVpZ2h0O1xuICAgIH1cbiAgICBcbiAgICAvLyBCbG9jayBzZXR0aW5ncyBoYXZlIGhpZ2hlc3QgcHJpb3JpdHlcbiAgICBpZiAoc2V0dGluZ3MuY29udGVudEhlaWdodCkge1xuICAgICAgY29udGVudEhlaWdodCA9IHNldHRpbmdzLmNvbnRlbnRIZWlnaHQ7XG4gICAgfVxuICAgIFxuICAgIHJldHVybiBjb250ZW50SGVpZ2h0O1xuICB9XG59XG4iLCAiaW1wb3J0IHsgUGx1Z2luIH0gZnJvbSAnb2JzaWRpYW4nO1xuaW1wb3J0IHsgTG9nZ2VyIH0gZnJvbSAnLi9sb2dnZXInO1xuXG4vKipcbiAqIEludGVyZmFjZSBmb3IgdGhlIERhdGF2aWV3IEFQSVxuICogVGhpcyBpcyBhIHNpbXBsaWZpZWQgdmVyc2lvbiBiYXNlZCBvbiB0aGUgRGF0YXZpZXcgZG9jdW1lbnRhdGlvblxuICovXG5leHBvcnQgaW50ZXJmYWNlIERhdGF2aWV3QXBpIHtcbiAgcXVlcnkocXVlcnk6IHN0cmluZywgc291cmNlUGF0aDogc3RyaW5nLCBjb250YWluZXI6IEhUTUxFbGVtZW50KTogUHJvbWlzZTxhbnk+O1xuICB0cnlRdWVyeShxdWVyeTogc3RyaW5nLCBzb3VyY2VQYXRoOiBzdHJpbmcsIGNvbnRhaW5lcjogSFRNTEVsZW1lbnQpOiBQcm9taXNlPHsgc3VjY2Vzc2Z1bDogYm9vbGVhbjsgdmFsdWU6IGFueSB9PjtcbiAgcGFnZShwYXRoOiBzdHJpbmcpOiBhbnk7XG4gIHBhZ2VzKHBhdGg6IHN0cmluZyk6IGFueVtdO1xuICBpbmRleDoge1xuICAgIHBhZ2VzOiBhbnlbXTtcbiAgICB0YWdzOiBSZWNvcmQ8c3RyaW5nLCBhbnlbXT47XG4gICAgaW5pdGlhbGl6ZWQ6IGJvb2xlYW47XG4gIH07XG59XG5cbi8qKlxuICogVXRpbGl0eSBjbGFzcyBmb3IgaW50ZXJhY3Rpbmcgd2l0aCB0aGUgRGF0YXZpZXcgQVBJXG4gKi9cbmV4cG9ydCBjbGFzcyBEYXRhdmlld0FwaVV0aWwge1xuICBwcml2YXRlIHBsdWdpbjogUGx1Z2luO1xuXG4gIGNvbnN0cnVjdG9yKHBsdWdpbjogUGx1Z2luKSB7XG4gICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2sgaWYgRGF0YXZpZXcgcGx1Z2luIGlzIGluc3RhbGxlZCBhbmQgZW5hYmxlZFxuICAgKi9cbiAgcHVibGljIGlzRGF0YXZpZXdFbmFibGVkKCk6IGJvb2xlYW4ge1xuICAgIC8vIEB0cy1pZ25vcmUgLSBBY2Nlc3NpbmcgdGhlIGdsb2JhbCBhcHAgb2JqZWN0XG4gICAgcmV0dXJuIHRoaXMucGx1Z2luLmFwcC5wbHVnaW5zLnBsdWdpbnMuZGF0YXZpZXcgIT09IHVuZGVmaW5lZDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIERhdGF2aWV3IEFQSVxuICAgKiBAcmV0dXJucyBUaGUgRGF0YXZpZXcgQVBJIG9yIG51bGwgaWYgbm90IGF2YWlsYWJsZVxuICAgKi9cbiAgcHVibGljIGdldERhdGF2aWV3QXBpKCk6IERhdGF2aWV3QXBpIHwgbnVsbCB7XG4gICAgaWYgKCF0aGlzLmlzRGF0YXZpZXdFbmFibGVkKCkpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIC8vIEB0cy1pZ25vcmUgLSBBY2Nlc3NpbmcgdGhlIGdsb2JhbCBhcHAgb2JqZWN0XG4gICAgcmV0dXJuIHRoaXMucGx1Z2luLmFwcC5wbHVnaW5zLnBsdWdpbnMuZGF0YXZpZXcuYXBpO1xuICB9XG5cbiAgLyoqXG4gICAqIEV4ZWN1dGUgYSBEYXRhdmlldyBxdWVyeVxuICAgKiBAcGFyYW0gcXVlcnkgVGhlIERhdGF2aWV3IHF1ZXJ5IHN0cmluZ1xuICAgKiBAcGFyYW0gc291cmNlUGF0aCBUaGUgc291cmNlIGZpbGUgcGF0aFxuICAgKiBAcGFyYW0gY29udGFpbmVyIFRoZSBjb250YWluZXIgZWxlbWVudCBmb3IgcmVuZGVyaW5nXG4gICAqIEByZXR1cm5zIFRoZSBxdWVyeSByZXN1bHQgb3IgbnVsbCBpZiBEYXRhdmlldyBpcyBub3QgYXZhaWxhYmxlXG4gICAqL1xuICBwdWJsaWMgYXN5bmMgZXhlY3V0ZVF1ZXJ5KHF1ZXJ5OiBzdHJpbmcsIHNvdXJjZVBhdGg6IHN0cmluZywgY29udGFpbmVyOiBIVE1MRWxlbWVudCk6IFByb21pc2U8YW55IHwgbnVsbD4ge1xuICAgIGNvbnN0IGFwaSA9IHRoaXMuZ2V0RGF0YXZpZXdBcGkoKTtcbiAgICBpZiAoIWFwaSkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiBhd2FpdCBhcGkucXVlcnkocXVlcnksIHNvdXJjZVBhdGgsIGNvbnRhaW5lcik7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIExvZ2dlci5lcnJvcignRXJyb3IgZXhlY3V0aW5nIERhdGF2aWV3IHF1ZXJ5OicsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBXYWl0IGZvciBEYXRhdmlldyB0byBjb21wbGV0ZSBpbmRleGluZ1xuICAgKiBAcmV0dXJucyBBIHByb21pc2UgdGhhdCByZXNvbHZlcyB0byB0cnVlIGlmIERhdGF2aWV3IGlzIHJlYWR5LCBmYWxzZSBpZiB0aW1lZCBvdXRcbiAgICovXG4gIHB1YmxpYyBhc3luYyB3YWl0Rm9yRGF0YXZpZXdSZWFkeSgpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICBjb25zdCBhcGkgPSB0aGlzLmdldERhdGF2aWV3QXBpKCk7XG4gICAgaWYgKCFhcGkpIHJldHVybiBmYWxzZTtcbiAgICBcbiAgICAvLyBJZiBEYXRhdmlldyBpcyBhbHJlYWR5IGluZGV4ZWQsIHJldHVybiBpbW1lZGlhdGVseVxuICAgIGlmIChhcGkuaW5kZXggJiYgYXBpLmluZGV4LmluaXRpYWxpemVkKSB7XG4gICAgICBMb2dnZXIuZGVidWcoJ0RhdGF2aWV3IGluZGV4IGlzIGFscmVhZHkgaW5pdGlhbGl6ZWQnKTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBcbiAgICBMb2dnZXIuZGVidWcoJ1dhaXRpbmcgZm9yIERhdGF2aWV3IGluZGV4IHRvIGJlIHJlYWR5Li4uJyk7XG4gICAgXG4gICAgLy8gT3RoZXJ3aXNlLCB3YWl0IGZvciB0aGUgaW5kZXgtcmVhZHkgZXZlbnRcbiAgICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XG4gICAgICBjb25zdCBhcHAgPSB0aGlzLnBsdWdpbi5hcHA7XG4gICAgICBcbiAgICAgIC8vIFNldCB1cCBldmVudCBsaXN0ZW5lciBmb3IgaW5kZXgtcmVhZHlcbiAgICAgIC8vIEB0cy1pZ25vcmUgLSBBY2Nlc3NpbmcgdGhlIG1ldGFkYXRhQ2FjaGUgZXZlbnRzXG4gICAgICBjb25zdCBldmVudFJlZiA9IGFwcC5tZXRhZGF0YUNhY2hlLm9uKCdkYXRhdmlldzppbmRleC1yZWFkeScsICgpID0+IHtcbiAgICAgICAgTG9nZ2VyLmRlYnVnKCdEYXRhdmlldyBpbmRleCBpcyBub3cgcmVhZHknKTtcbiAgICAgICAgLy8gQHRzLWlnbm9yZSAtIEFjY2Vzc2luZyB0aGUgbWV0YWRhdGFDYWNoZSBldmVudHNcbiAgICAgICAgYXBwLm1ldGFkYXRhQ2FjaGUub2ZmcmVmKGV2ZW50UmVmKTtcbiAgICAgICAgcmVzb2x2ZSh0cnVlKTtcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICAvLyBTZXQgYSB0aW1lb3V0IGluIGNhc2UgdGhlIGV2ZW50IG5ldmVyIGZpcmVzXG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgTG9nZ2VyLndhcm4oJ1RpbWVkIG91dCB3YWl0aW5nIGZvciBEYXRhdmlldyBpbmRleCcpO1xuICAgICAgICAvLyBAdHMtaWdub3JlIC0gQWNjZXNzaW5nIHRoZSBtZXRhZGF0YUNhY2hlIGV2ZW50c1xuICAgICAgICBhcHAubWV0YWRhdGFDYWNoZS5vZmZyZWYoZXZlbnRSZWYpO1xuICAgICAgICByZXNvbHZlKGZhbHNlKTtcbiAgICAgIH0sIDUwMDApOyAvLyA1IHNlY29uZCB0aW1lb3V0XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogRXhlY3V0ZSBhIERhdGF2aWV3IHF1ZXJ5IHNhZmVseSwgcmV0dXJuaW5nIGFuIG9iamVjdCBpbmRpY2F0aW5nIHN1Y2Nlc3Mgb3IgZmFpbHVyZVxuICAgKiBAcGFyYW0gcXVlcnkgVGhlIERhdGF2aWV3IHF1ZXJ5IHN0cmluZ1xuICAgKiBAcGFyYW0gc291cmNlUGF0aCBUaGUgc291cmNlIGZpbGUgcGF0aFxuICAgKiBAcGFyYW0gY29udGFpbmVyIFRoZSBjb250YWluZXIgZWxlbWVudCBmb3IgcmVuZGVyaW5nXG4gICAqIEBwYXJhbSByZXRyeUNvdW50IE9wdGlvbmFsIHJldHJ5IGNvdW50IGZvciBpbnRlcm5hbCB1c2VcbiAgICogQHJldHVybnMgQW4gb2JqZWN0IHdpdGggdGhlIHF1ZXJ5IHJlc3VsdCBvciBlcnJvclxuICAgKi9cbiAgcHVibGljIGFzeW5jIGV4ZWN1dGVTYWZlUXVlcnkoXG4gICAgcXVlcnk6IHN0cmluZywgXG4gICAgc291cmNlUGF0aDogc3RyaW5nLCBcbiAgICBjb250YWluZXI6IEhUTUxFbGVtZW50LFxuICAgIHJldHJ5Q291bnQ6IG51bWJlciA9IDBcbiAgKTogUHJvbWlzZTx7IHN1Y2Nlc3NmdWw6IGJvb2xlYW47IHZhbHVlOiBhbnkgfT4ge1xuICAgIGNvbnN0IGFwaSA9IHRoaXMuZ2V0RGF0YXZpZXdBcGkoKTtcbiAgICBpZiAoIWFwaSkge1xuICAgICAgTG9nZ2VyLmVycm9yKCdEYXRhdmlldyBBUEkgbm90IGZvdW5kLiBNYWtlIHN1cmUgRGF0YXZpZXcgcGx1Z2luIGlzIGVuYWJsZWQuJyk7XG4gICAgICByZXR1cm4geyBzdWNjZXNzZnVsOiBmYWxzZSwgdmFsdWU6ICdEYXRhdmlldyBwbHVnaW4gaXMgbm90IGVuYWJsZWQnIH07XG4gICAgfVxuXG4gICAgaWYgKCFxdWVyeSB8fCBxdWVyeS50cmltKCkgPT09ICcnKSB7XG4gICAgICBMb2dnZXIuZXJyb3IoJ0VtcHR5IERhdGF2aWV3IHF1ZXJ5Jyk7XG4gICAgICByZXR1cm4geyBzdWNjZXNzZnVsOiBmYWxzZSwgdmFsdWU6ICdFbXB0eSBxdWVyeScgfTtcbiAgICB9XG5cbiAgICBMb2dnZXIuZGVidWcoJ0V4ZWN1dGluZyBEYXRhdmlldyBxdWVyeTonLCBxdWVyeSk7XG4gICAgTG9nZ2VyLmRlYnVnKCdTb3VyY2UgcGF0aDonLCBzb3VyY2VQYXRoKTtcblxuICAgIHRyeSB7XG4gICAgICAvLyBUcnkgdXNpbmcgdGhlIHJlZ3VsYXIgcXVlcnkgbWV0aG9kIGRpcmVjdGx5XG4gICAgICBpZiAodHlwZW9mIGFwaS5xdWVyeSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICBMb2dnZXIuZGVidWcoJ1VzaW5nIGFwaS5xdWVyeSBtZXRob2QnKTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBhcGkucXVlcnkocXVlcnksIHNvdXJjZVBhdGgsIGNvbnRhaW5lcik7XG4gICAgICAgICAgTG9nZ2VyLmRlYnVnKCdEaXJlY3QgcXVlcnkgcmVzdWx0IHR5cGU6JywgdHlwZW9mIHJlc3VsdCk7XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gQ2hlY2sgaWYgcmVzdWx0IGlzIHVuZGVmaW5lZCBvciBudWxsXG4gICAgICAgICAgaWYgKHJlc3VsdCA9PT0gdW5kZWZpbmVkIHx8IHJlc3VsdCA9PT0gbnVsbCkge1xuICAgICAgICAgICAgTG9nZ2VyLmVycm9yKCdEaXJlY3QgcXVlcnkgcmV0dXJuZWQgdW5kZWZpbmVkIG9yIG51bGwnKTtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3NmdWw6IGZhbHNlLCB2YWx1ZTogJ05vIHJlc3VsdHMgcmV0dXJuZWQnIH07XG4gICAgICAgICAgfVxuICAgICAgICAgIFxuICAgICAgICAgIC8vIENoZWNrIGlmIHRoZSByZXN1bHQgaGFzIHRoZSBleHBlY3RlZCBzdHJ1Y3R1cmUgZm9yIGEgdGFibGUgcXVlcnlcbiAgICAgICAgICBpZiAocmVzdWx0ICYmIHR5cGVvZiByZXN1bHQgPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICBpZiAoJ3ZhbHVlcycgaW4gcmVzdWx0ICYmIEFycmF5LmlzQXJyYXkocmVzdWx0LnZhbHVlcykpIHtcbiAgICAgICAgICAgICAgTG9nZ2VyLmRlYnVnKCdSZXN1bHQgY29udGFpbnMgYSB2YWx1ZXMgYXJyYXkgd2l0aCBsZW5ndGg6JywgcmVzdWx0LnZhbHVlcy5sZW5ndGgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiAoJ2hlYWRlcnMnIGluIHJlc3VsdCAmJiBBcnJheS5pc0FycmF5KHJlc3VsdC5oZWFkZXJzKSkge1xuICAgICAgICAgICAgICBMb2dnZXIuZGVidWcoJ1Jlc3VsdCBjb250YWlucyBoZWFkZXJzOicsIHJlc3VsdC5oZWFkZXJzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gQ2hlY2sgaWYgd2UgZ290IGFuIGVtcHR5IHJlc3VsdCBidXQgRGF0YXZpZXcgbWlnaHQgc3RpbGwgYmUgaW5kZXhpbmdcbiAgICAgICAgICBpZiAocmVzdWx0ICYmIFxuICAgICAgICAgICAgICB0eXBlb2YgcmVzdWx0ID09PSAnb2JqZWN0JyAmJiBcbiAgICAgICAgICAgICAgJ3ZhbHVlcycgaW4gcmVzdWx0ICYmIFxuICAgICAgICAgICAgICBBcnJheS5pc0FycmF5KHJlc3VsdC52YWx1ZXMpICYmIFxuICAgICAgICAgICAgICByZXN1bHQudmFsdWVzLmxlbmd0aCA9PT0gMCAmJiBcbiAgICAgICAgICAgICAgcmV0cnlDb3VudCA8IDMpIHtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gSWYgd2UgaGF2ZSBhbiBlbXB0eSByZXN1bHQgYW5kIHdlIGhhdmVuJ3QgcmV0cmllZCB0b28gbWFueSB0aW1lcyxcbiAgICAgICAgICAgIC8vIHdhaXQgYSBiaXQgYW5kIHRyeSBhZ2FpblxuICAgICAgICAgICAgTG9nZ2VyLmRlYnVnKGBFbXB0eSByZXN1bHQsIHJldHJ5aW5nIChhdHRlbXB0ICR7cmV0cnlDb3VudCArIDF9LzMpLi4uYCk7XG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XG4gICAgICAgICAgICAgIHNldFRpbWVvdXQoYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJldHJ5UmVzdWx0ID0gYXdhaXQgdGhpcy5leGVjdXRlU2FmZVF1ZXJ5KHF1ZXJ5LCBzb3VyY2VQYXRoLCBjb250YWluZXIsIHJldHJ5Q291bnQgKyAxKTtcbiAgICAgICAgICAgICAgICByZXNvbHZlKHJldHJ5UmVzdWx0KTtcbiAgICAgICAgICAgICAgfSwgNTAwKTsgLy8gV2FpdCA1MDBtcyBiZWZvcmUgcmV0cnlpbmdcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBcbiAgICAgICAgICByZXR1cm4geyBzdWNjZXNzZnVsOiB0cnVlLCB2YWx1ZTogcmVzdWx0IH07XG4gICAgICAgIH0gY2F0Y2ggKHF1ZXJ5RXJyb3IpIHtcbiAgICAgICAgICBMb2dnZXIuZXJyb3IoJ0Vycm9yIGluIGRpcmVjdCBxdWVyeTonLCBxdWVyeUVycm9yKTtcbiAgICAgICAgICByZXR1cm4geyBcbiAgICAgICAgICAgIHN1Y2Nlc3NmdWw6IGZhbHNlLCBcbiAgICAgICAgICAgIHZhbHVlOiBxdWVyeUVycm9yID8gKHF1ZXJ5RXJyb3IubWVzc2FnZSB8fCBTdHJpbmcocXVlcnlFcnJvcikpIDogJ0Vycm9yIGluIHF1ZXJ5IGV4ZWN1dGlvbicgXG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgTG9nZ2VyLmVycm9yKCdEYXRhdmlldyBBUEkgcXVlcnkgbWV0aG9kIG5vdCBmb3VuZC4nKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2Vzc2Z1bDogZmFsc2UsIHZhbHVlOiAnSW5jb21wYXRpYmxlIERhdGF2aWV3IEFQSSB2ZXJzaW9uJyB9O1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBMb2dnZXIuZXJyb3IoJ0Vycm9yIGV4ZWN1dGluZyBEYXRhdmlldyBxdWVyeTonLCBlcnJvcik7XG4gICAgICByZXR1cm4geyBcbiAgICAgICAgc3VjY2Vzc2Z1bDogZmFsc2UsIFxuICAgICAgICB2YWx1ZTogZXJyb3IgPyAoZXJyb3IubWVzc2FnZSB8fCBTdHJpbmcoZXJyb3IpKSA6ICdVbmtub3duIGVycm9yJyBcbiAgICAgIH07XG4gICAgfVxuICB9XG59XG4iXSwKICAibWFwcGluZ3MiOiAiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBa0JBLElBQUFBLG1CQUFxRjs7O0FDc0U5RSxJQUFNLG1CQUFzQztBQUFBO0FBQUEsRUFFakQsUUFBUTtBQUFBO0FBQUEsRUFHUixlQUFlO0FBQUEsRUFDZixhQUFhO0FBQUEsRUFDYixVQUFVO0FBQUE7QUFBQSxFQUdWLFlBQVk7QUFBQSxFQUNaLFNBQVMsQ0FBQztBQUFBLEVBQ1Ysc0JBQXNCO0FBQUE7QUFBQSxFQUN0QixlQUFlO0FBQUE7QUFBQTtBQUFBLEVBR2YsWUFBWTtBQUFBLEVBQ1osYUFBYTtBQUFBLEVBQ2IsZUFBZTtBQUFBLEVBQ2YsaUJBQWlCO0FBQUE7QUFBQSxFQUNqQixZQUFZO0FBQUE7QUFBQSxFQUNaLFVBQVU7QUFBQTtBQUFBO0FBQUEsRUFHVixtQkFBbUI7QUFBQSxFQUNuQixvQkFBb0IsQ0FBQztBQUFBO0FBQUEsRUFHckIsZUFBZTtBQUFBLEVBQ2YsY0FBYztBQUFBLEVBQ2QsbUJBQW1CO0FBQUEsRUFDbkIsNEJBQTRCO0FBQUE7QUFBQSxFQUM1QixxQkFBcUI7QUFBQTtBQUFBLEVBQ3JCLGlCQUFpQjtBQUFBO0FBQUE7QUFBQSxFQUdqQixtQkFBbUI7QUFBQTtBQUFBLEVBR25CLHNCQUFzQjtBQUFBO0FBQUE7QUFBQSxFQUd0QixXQUFX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QUEsTUFDM0UsQ0FBQztBQUFBLElBQ0g7QUFBQSxFQUNGO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLEVBT1Esb0JBQW9CLG1CQUE0QixNQUFNO0FBRTVELFFBQUksS0FBSyxhQUFjO0FBRXZCLFNBQUssZUFBZTtBQUVwQixVQUFNLGFBQWEsS0FBSyxJQUFJLFVBQVUsb0JBQW9CLDZCQUFZO0FBQ3RFLFFBQUksWUFBWTtBQUVkLGlCQUFXLFlBQVksU0FBUyxJQUFJO0FBR3BDLFVBQUksa0JBQWtCO0FBQ3BCLFlBQUksd0JBQU8sdUJBQXVCLEdBQUk7QUFBQSxNQUN4QztBQUdBLGlCQUFXLE1BQU07QUFDZixZQUFJLEtBQUsscUJBQXFCLFNBQVMsS0FBSyxTQUFTLEtBQUssaUJBQWlCLEdBQUc7QUFFNUUsVUFBQyxLQUFLLGtCQUFrQyxNQUFNO0FBQUEsUUFDaEQ7QUFHQSxhQUFLLGVBQWU7QUFBQSxNQUN0QixHQUFHLEVBQUU7QUFBQSxJQUNQLE9BQU87QUFDTCxVQUFJLGtCQUFrQjtBQUNwQixZQUFJLHdCQUFPLHNDQUFzQyxHQUFJO0FBQUEsTUFDdkQ7QUFDQSxXQUFLLGVBQWU7QUFBQSxJQUN0QjtBQUFBLEVBQ0Y7QUFDRjsiLAogICJuYW1lcyI6IFsiaW1wb3J0X29ic2lkaWFuIiwgImltcG9ydF9vYnNpZGlhbiIsICJvYnNlcnZlciJdCn0K
